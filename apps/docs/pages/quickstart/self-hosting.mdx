import Image from 'next/image';
import { Callout } from 'nextra/components';
import SelfhostClassroomIO from './images/selfhost-classroomio.webp';

# Self-hosting ClassroomIO.com

This comprehensive guide will help you self-host ClassroomIO with step-by-step instructions for deployment on Railway, Docker, or your own servers.

<Image src={SelfhostClassroomIO} alt="Selfhost ClassroomIO" quality="100" />

## Overview

In this page, you will be guided on how to configure supabase cloud, self host ClassroomIO, where to access environmental variables and how to deploy your application using our railway template, docker or your own custom servers

### Architecture

ClassroomIO follows a well structured monorepo file architecture but major components needed for development and deployment are:

- [apps/backend](https://github.com/rotimi-best/classroomio/tree/main/apps/backend) - Hono API server
- [apps/dashboard](https://github.com/rotimi-best/classroomio/tree/main/apps/dashboard) - SvelteKit admin dashboard + LMS
- [Supabase](https://github.com/rotimi-best/classroomio/tree/main/supabase) - PostgreSQL database + REST API

### Prerequisites

The following steps must be completed before deployment can be done

### 1. Supabase Cloud Setup (Required)

You need a fully configured Supabase Cloud project as your database. This is **mandatory** for all deployment methods.

**[Complete the Supabase Cloud Setup Guide â†’](/contributor-guides/supabase-cloud)**

After completing this guide, you'll have:

- Supabase project with all required tables
- Authentication configured
- SMTP email settings
- Environment variables ready

### 2. SMTP Configuration (Required)

Both Supabase and the backend need SMTP credentials for email functionality:

```bash
SMTP_HOST=your_smtp_host
SMTP_PORT=587
SMTP_USER=your_smtp_username
SMTP_PASSWORD=your_smtp_password
SMTP_SENDER=your_sender_email
```

<Callout type="info">
  Learn more about setting up a custom SMTP server
  [here](https://supabase.com/docs/guides/auth/auth-smtp)
</Callout>

**Popular SMTP Providers:**

- **Gmail**(recommended): Use app-specific passwords
- **SendGrid**: Free tier available
- **Mailgun**: Developer-friendly
- **Your own SMTP server**

### 3. Cloudflare R2 (Optional)

All our videos and image assets are managed and uploaded on cloudfare for secure and fast retrieval in the courses. This variables are not required for the basic functionality but are recommended for a full experience.

```bash
# Optional - Cloudflare R2 for video uploads
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_ACCESS_KEY=your_access_key
CLOUDFLARE_SECRET_ACCESS_KEY=your_secret_key
# Optional: override bucket domain; derived from ACCOUNT_ID when omitted
CLOUDFLARE_BUCKET_DOMAIN=your_bucket_domain
```

<Callout type="info">The backend uses the bucket name "videos" by default.</Callout>

---

## Development

### Choose Your Path

Decide how you want to run ClassroomIO:

- Local development with Supabase Cloud â†’ Complete [Supabase Cloud Setup](/contributor-guides/supabase-cloud), then run apps locally
- Local development with Supabase Local (CLI + Docker) â†’ Follow [Supabase Local Development](/contributor-guides/supabase-local-dev)
- Production deployment â†’ Complete [Supabase Cloud Setup](/contributor-guides/supabase-cloud) first, then choose Railway, Docker, or Manual

## Deployment

This steps will guide you on how to deploy ClassroomIO, using your preferred deployment method:

### Option 1: Railway (Recommended)

**Fastest deployment with our pre-configured template**

[Go to Railway Deployment â†’](#deploy-on-railway)

### Option 2: Docker

**Self-host with Docker containers on your own infrastructure**

[Go to Docker Deployment â†’](#using-docker)

### Option 3: Manual Deployment

**Deploy to your own servers with full control**

[Go to Manual Deployment â†’](#manual-deployment)

---

## Deploy on Railway

**Prerequisites**: Complete [Supabase Cloud Setup](/contributor-guides/supabase-cloud) first!

Railway provides the fastest and easiest way to deploy ClassroomIO with our pre-configured template.

### Quick Start

1. **Click the Deploy Button**:
   [![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/dl9RG7?referralCode=8OyIj5)

2. **Follow the Setup Wizard**:
   - Connect your GitHub account
   - Select the ClassroomIO repository
   - Configure environment variables (see below)

### Environment Variables Configuration

#### cio-backend Service

```bash
# Required - Supabase Configuration
PUBLIC_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your_anon_public_key

# Required - SMTP Configuration
SMTP_HOST=your_smtp_host
SMTP_PORT=587
SMTP_USER=your_smtp_username
SMTP_SENDER=your_sender_email
SMTP_PASSWORD=your_smtp_password

# Optional - Cloudflare R2 for Video Uploads
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_ACCESS_KEY=your_access_key
CLOUDFLARE_SECRET_ACCESS_KEY=your_secret_key
CLOUDFLARE_BUCKET_DOMAIN=your_bucket_domain

# Optional - Monitoring
SENTRY_DNS=your_sentry_dsn
```

<Callout type="info" emoji="â„¹ï¸">
  Backend service: Values here are read by the Hono API and must match your Supabase project and
  SMTP provider. Ensure URL has no trailing slash and credentials are correct.
</Callout>

#### cio-dashboard Service

```bash
# Required - Supabase Configuration
PUBLIC_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your_anon_public_key
PRIVATE_SUPABASE_SERVICE_ROLE=your_service_role_key


# Required - Backend Connection
PUBLIC_SERVER_URL=https://your-backend-service.railway.app

# Optional - AI Features
OPENAI_API_KEY=your_openai_key

# Optional - Additional Features
UNSPLASH_API_KEY=your_unsplash_key
PUBLIC_IP_REGISTRY_KEY=your_ip_registry_key
PRIVATE_APP_SUBDOMAINS=your_subdomains
```

<Callout type="info" emoji="â„¹ï¸">
  Dashboard service: Includes the service role for server-side usage and points to your backend via
  PUBLIC_SERVER_URL. Get Supabase values from your
  <a href="/contributor-guides/supabase-cloud">Supabase Cloud setup</a>. See full examples in the
  backend and dashboard <code>.env.example</code> files.
</Callout>

### Railway Deployment Steps

1. **Deploy Backend First**:

   - Wait for backend service to be healthy
   - Note the generated URL (e.g., `https://cio-backend-production.up.railway.app`)

2. **Update Dashboard Environment**:

   - Set `PUBLIC_SERVER_URL` to your backend URL
   - Redeploy dashboard service

3. **Verify Deployment**:
   - Backend: Check health endpoint
   - Dashboard: Test login/signup functionality

---

## Using Docker

**Prerequisites**: Complete [Supabase Cloud Setup](/contributor-guides/supabase-cloud) first!

Deploy ClassroomIO using Docker containers on your own infrastructure.

To enable deployment using docker, we provide a `bash docker-compose.yaml` configuration file to deploy the dashboard and backend services.

### Quick Start

1. **Clone the Repository**:

```bash
git clone https://github.com/rotimi-best/classroomio.git
cd classroomio
```

2. **Create Environment File**:
   You can manually create an .env file or use the command below to quickly create both .env files needed.

```bash
   cp apps/backend/.env.example .env
   cp apps/dashboard/.env.example .env
```

3. **Configure Environment Variables**:
   Edit both `.env` files in the dashboard and backend with your Supabase, SMTP credentials and other optional variables.

4. **Start Services**:
   ```bash
   docker compose up --build -d
   ```

### Service Configuration

The docker-compose file sets up two services:

#### Backend Service (cio-backend)

- **Port**: 3002
- **Image**: Node.js 18-alpine
- **Features**: API endpoints, file uploads, email notifications
- **Dependencies**: Supabase, SMTP, Cloudflare R2 (optional)

#### Dashboard Service (cio-dashboard)

- **Port**: 3000
- **Image**: Node.js 18-alpine
- **Features**: Web interface, course management, user dashboard
- **Dependencies**: Supabase, backend connection

### Docker Commands

If you are not really familiar with docker, here are some quick docker commands for you.

```bash
# Start services in detached mode
docker compose up -d

# View logs
docker compose logs -f

# Stop services
docker compose down

# Rebuild and restart in detached mode
docker compose up --build -d

# View running containers
docker compose ps
```

### Access Your Application

- **Dashboard**: http://localhost:3000
- **Backend API**: http://localhost:3002

---

## Manual Deployment

**Prerequisites**: Complete [Supabase Cloud Setup](/contributor-guides/supabase-cloud) first!

Deploy ClassroomIO to your own servers with full control over the infrastructure. This approach is ideal for production deployments on VPS services, cloud platforms, or dedicated servers.

<Callout type="warning">
  This section is a work in progress. Steps below are a starting point and may not be accurate for
  your use case. refer Railway or Docker unless you are comfortable managing Node processes, reverse
  proxies, and env management manually.
</Callout>

### Server Requirements

- **OS**: Linux (Ubuntu 20.04+ recommended) or any systemd-capable distro
- **CPU**: 2 vCPU recommended
- **RAM**: Minimum 2GB (4GB+ recommended for smoother builds)
- **Storage**: 20GB+ SSD available space
- **Node.js**: v18.18.0+ (matches engines); verify with `node -v`
- **pnpm**: v8+ (root `packageManager` uses pnpm@8)
- **Nginx**: Reverse proxy (optional but recommended)

### Deployment Options

Choose your preferred deployment method:

#### Option 1: VPS Services (DigitalOcean, Linode, Vultr)

- **Pros**: Full control, predictable pricing, good performance
- **Cons**: Manual setup, requires server management knowledge
- **Best for**: Developers comfortable with Linux administration

#### Option 2: Cloud Platforms (AWS, Google Cloud, Azure)

- **Pros**: Scalable, managed services, enterprise features
- **Cons**: Complex pricing, vendor lock-in, learning curve
- **Best for**: Production deployments, enterprise use cases

#### Option 3: Dedicated Servers (OVH, Hetzner, Contabo)

- **Pros**: Maximum performance, full control, no virtualization overhead
- **Cons**: Higher cost, manual maintenance, hardware management
- **Best for**: High-traffic applications, compliance requirements

### VPS Deployment (DigitalOcean, Linode, Vultr)

#### 1. Server Setup

Install all necessary software and tools to run ClassroomIO on your server.

```bash
# Update system packages
sudo apt update && sudo apt upgrade -y

# Install Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Install pnpm globally
sudo npm install -g pnpm

# Install Nginx
sudo apt install nginx -y

# Install PM2 globally
sudo npm install -g pm2

# Install Git
sudo apt install git -y
```

#### 2. Application Deployment

Clone ClassroomIO and prepare both backend and dashboard for production.

```bash
# Clone the repository
git clone https://github.com/rotimi-best/classroomio.git
cd classroomio

# Setup backend
cd apps/backend
cp .env.example .env
# Edit .env with your credentials
pnpm install
pnpm run build

# Setup dashboard
cd ../dashboard
cp .env.example .env
# Edit .env with your credentials
pnpm install
pnpm run build
```

#### 3. Process Management with PM2

Configure PM2 to keep your applications running continuously and auto-restart on errors.

```bash
# Start backend service
cd apps/backend
pm2 start dist/index.js --name "cio-backend"

# Start dashboard service
cd ../dashboard
pm2 start build --name "cio-dashboard"

# Save PM2 configuration
pm2 save
pm2 startup

# Check service status
pm2 status
pm2 logs
```

#### 4. Nginx Configuration (optional)

Set up Nginx as reverse proxy to handle web traffic and route requests to correct services.

```bash
# Create Nginx configuration
sudo nano /etc/nginx/sites-available/classroomio
```

```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    # Dashboard (Frontend)
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

}
```

```bash
# Enable the site
sudo ln -s /etc/nginx/sites-available/classroomio /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 5. SSL Certificate with Let's Encrypt

Secure your website with HTTPS using free SSL certificates from Let's Encrypt.

```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx -y

# Obtain SSL certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal setup
sudo crontab -e
# Add this line: 0 12 * * * /usr/bin/certbot renew --quiet
```

### Cloud Platform Deployment (AWS, Google Cloud, Azure)

#### AWS EC2 Deployment

Deploy on Amazon's cloud infrastructure with additional AWS-specific services.

```bash
# Connect to your EC2 instance
ssh -i your-key.pem ubuntu@your-ec2-ip

# Follow VPS deployment steps above
# Additional AWS-specific considerations:

# Security Groups: Open ports 80, 443, 22
# Elastic IP: Assign static IP for your domain
# Load Balancer: Use ALB for high availability
# Auto Scaling: Configure for traffic spikes
```

#### Google Cloud Platform

Use Google's cloud infrastructure with strong integration and competitive pricing.

```bash
# Connect to your Compute Engine instance
gcloud compute ssh your-instance-name --zone=your-zone

# Follow VPS deployment steps above
# Additional GCP-specific considerations:

# Firewall rules: Allow HTTP/HTTPS traffic
# Load balancer: Use Cloud Load Balancing
# Managed instance groups: For auto-scaling
```

#### Azure Virtual Machines

Deploy on Microsoft's cloud platform with enterprise integration features.

```bash
# Connect to your Azure VM
ssh azureuser@your-vm-ip

# Follow VPS deployment steps above
# Additional Azure-specific considerations:

# Network Security Groups: Configure inbound rules
# Application Gateway: For load balancing
# Virtual Machine Scale Sets: For auto-scaling
```

### Production Considerations

#### 1. Environment Variables

Set up production-specific configuration for your applications. You'll need to create environment files with production settings and your actual credentials.

```bash
# Production environment file
# apps/backend/.env
NODE_ENV=production
PORT=3002
# Add your Supabase, SMTP, and other credentials

# apps/dashboard/.env
NODE_ENV=production
PORT=3000
# Add your Supabase, backend URL, and other credentials
```

#### 2. Monitoring and Logging

Set up tools to monitor your application's health and performance in real-time. This helps you detect and diagnose issues quickly when they occur.

```bash
# PM2 monitoring
pm2 monit

# Log rotation
pm2 install pm2-logrotate

# Health checks
curl http://localhost:3002/health
curl http://localhost:3000
```

#### 3. Backup Strategy

Create a plan to protect your application and data from loss. Regular backups ensure you can recover quickly from hardware failures or other disasters.

```bash
# Database backups (Supabase handles this)
# Application backups
tar -czf classroomio-backup-$(date +%Y%m%d).tar.gz classroomio/

# Environment files backup
cp apps/backend/.env apps/backend/.env.backup
cp apps/dashboard/.env apps/dashboard/.env.backup
```

#### 4. Performance Optimization

Implement techniques to make your application faster and more efficient under load. These optimizations help handle multiple users simultaneously without slowing down.

```bash
# Enable PM2 clustering
pm2 start dist/index.js --name "cio-backend" -i max
pm2 start build --name "cio-dashboard" -i max

# Nginx caching
# Add to Nginx config for static assets
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### Deployment Verification

Test that everything is working correctly after deployment. These checks confirm your application is accessible, healthy, and properly configured before users start using it.

```bash
# Check services are running
pm2 status
pm2 logs --lines 50

# Test endpoints
curl -I http://localhost:3000
curl -I http://localhost:3002/health

# Check Nginx status
sudo systemctl status nginx
sudo nginx -t

# Verify SSL certificate
sudo certbot certificates
```

### Troubleshooting Commands

Use these tools to diagnose and fix common problems in production. When things go wrong, these commands help you quickly identify the issue and get your application running again.

```bash
# View PM2 logs
pm2 logs cio-backend
pm2 logs cio-dashboard

# Restart services
pm2 restart cio-backend
pm2 restart cio-dashboard

# Check Nginx logs
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# Check system resources
htop
df -h
free -h
```

### Maintenance and Updates

Establish a routine to keep your application secure, up-to-date, and running smoothly. Regular maintenance ensures your app stays secure, performs well, and benefits from new features and bug fixes.

```bash
# Update application
cd classroomio
git pull origin main
cd apps/backend && pnpm install && pnpm run build
cd ../dashboard && pnpm install && pnpm run build

# Restart services
pm2 restart all

# Update system packages
sudo apt update && sudo apt upgrade -y

# Renew SSL certificate
sudo certbot renew
```

---

## Post-Deployment Setup

### 1. Create Admin Account

1. **Access Dashboard**: Navigate to your deployed dashboard
2. **Sign Up**: Create your account (this becomes the admin)
3. **Verify Email**: Check your email for verification
4. **Login**: Access your admin dashboard

### 2. Configure Organization

1. **Organization Setup**: Complete your organization profile
2. **Domain Configuration**: Set your custom domain if applicable
3. **SMTP Verification**: Test email functionality

### 3. Test Core Features

- User registration and authentication
- Course and lesson creation
- File uploads and storage
- Email notifications
- Student dashboard access

---

## Troubleshooting

### Common Issues

**"Supabase Connection Failed"**

- Verify environment variables are correct
- Check Supabase project is active
- Ensure IP allowlist includes your server

**"SMTP Authentication Failed"**

- Verify SMTP credentials
- Check port and security settings
- Test SMTP configuration in Supabase

**"Dashboard Can't Connect to Backend"**

- Verify `PUBLIC_SERVER_URL` is correct
- Check backend service is running

**"Database Schema Errors"**

- Ensure Supabase schema is deployed
- Check migration status
- Verify table permissions

### Getting Help

1. **Check Logs**: Review service logs for error details
2. **Verify Configuration**: Double-check all environment variables
3. **Community Support**: Join our [Discord](https://dub.sh/ciodiscord)
4. **GitHub Issues**: Open an [issue](https://github.com/rotimi-best/classroomio/issues)

---

## Additional Resources

- **[Supabase Cloud Setup](/contributor-guides/supabase-cloud)** - Required first step
- **[ClassroomIO GitHub](https://github.com/rotimi-best/classroomio)** - Source code
- **[Railway Documentation](https://docs.railway.app)** - Deployment platform
- **[Docker Documentation](https://docs.docker.com)** - Container platform
- **[Discord Community](https://dub.sh/ciodiscord)** - Get help and connect

---

<Callout type="info" emoji="ðŸ’¡">
  **Pro Tip**: Start with Railway for quick testing, then migrate to Docker or manual deployment for
  production use.
</Callout>
