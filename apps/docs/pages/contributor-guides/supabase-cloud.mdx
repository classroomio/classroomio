import Image from 'next/image';
import { Callout, Steps } from 'nextra/components';
import AuthSettings from './images/auth-settings.webp';
import DBPushResult from './images/db-push-result.webp';
import DBUrl from './images/db-url.webp';
import MatchEnvVariables from './images/match-env.webp';
import NewProject from './images/new-project.webp';
import SmtpSettings from './images/smtp-settings.webp';

# Supabase Cloud Setup for ClassroomIO

This comprehensive guide will walk you through setting up Supabase Cloud as your database for self-hosting ClassroomIO. This setup is **required** before you can deploy ClassroomIO on Railway or Docker.

<Callout type="info">
  <strong>When to use this guide</strong>
  <br />- Use this for <strong>production deployments</strong> (Railway, Docker, or manual). You'll
  need your Project URL, anon key, and service role key. Schema setup is handled during app setup,
  not in this guide.
  <br />- You can also use this for [**local development backed by Supabase
  Cloud**](/contributor-guides/supabase-local-dev#cloud-backed-local-development-using-supabase-cloud-as-db)
  <br />- For fully local development (no Supabase Cloud), follow our [**Supabase Local
  Development**](/contributor-guides/supabase-local-dev) guide.
</Callout>

## What You'll Accomplish

By the end of this guide, you'll have:

- A Supabase Cloud project created
- Authentication settings updated (Site URL)
- Required environment variables copied for deployment

## Prerequisites

Before starting, ensure you have:

- A Supabase account ([sign up here](https://supabase.com))

## Step-by-Step Setup

<Steps>

### 1. Create a New Supabase Project

1. **Sign in to Supabase**: Go to [supabase.com](https://supabase.com) and sign in to your account
2. **Create New Project**: Click "New Project" on your dashboard
3. **Fill Project Details**:
   - **Name**: `classroomio-selfhost` (or your preferred name)
   - **Database Password**: Create a strong password and **save it securely** - you won't be able to retrieve it later
   - **Region**: Choose the region closest to your deployment location
   - **Pricing Plan**: Start with the free tier (you can upgrade later)

<Image src={NewProject} alt="New project in supabase" quality="100" />

<Callout type="warning" emoji="‚ö†Ô∏è">
  **IMPORTANT**: Save your database password immediately! Supabase cannot recover it for security
  reasons.
</Callout>

### 2. Get Your Project Credentials

1. **Navigate to Settings**: In your project dashboard, click the gear icon (‚öôÔ∏è) in the left sidebar
2. **Go to API Section**: Click "API" in the settings menu
3. **Copy Required Values**:
   - **Project URL**: Copy the `Project URL`
   - **Anon Public Key**: Copy the `anon public` key
   - **Service Role Key**: Copy the `service_role` key (keep this secret!)

<Image src={MatchEnvVariables} alt="Source of supabase environment variables" quality="100" />

### 3. Configure Authentication Settings

1. **Go to Authentication**: In the left sidebar, click "Authentication"
2. **Click Settings**: Click the "Settings" tab
3. **Update Site URL**: Change the Site URL to your deployment domain (e.g., `https://yourdomain.com`)
4. **Disable Email Confirmations**: Set "Enable email confirmations" to **OFF** (ClassroomIO handles this internally)
5. **Save Changes**: Click "Save" to apply your changes

<Image src={AuthSettings} alt="Authentication configuration" quality="100" />

### 4. Supabase Email (Optional)

Supabase can send auth emails using its built-in email service (not recommended for production). Custom
SMTP is only needed if you want Supabase itself to send emails. Our app sends emails via its own
backend service, so configuring Supabase SMTP is optional.

1. **Go to Authentication ‚Üí Email**
2. (Optional) Configure a custom SMTP provider for Supabase emails
3. Save changes

<Image src={SmtpSettings} alt="SMTP Settings" quality="100" />

<Callout type="info" emoji="‚ÑπÔ∏è">
  Our application sends emails through the backend (SMTP or Zoho). Supabase SMTP settings affect
  only emails sent by Supabase itself. Learn more: https://supabase.com/docs/guides/auth/auth-smtp
</Callout>

### 5. Prepare Environment Variables

Copy these values for your deployment:

```bash
# Supabase Configuration
PUBLIC_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
PUBLIC_SUPABASE_ANON_KEY=your_anon_public_key_here
PRIVATE_SUPABASE_SERVICE_ROLE=your_service_role_key_here
```

<Callout type="warning" emoji="üîí">
  **Security**: Keep these credentials secure and never commit them to version control.
</Callout>

## Setup Complete!

Congratulations! Your Supabase Cloud project is now fully configured for ClassroomIO.

## Next Steps

Now that you have Supabase configured, you can proceed to:

1. **[Deploy on Railway](/quickstart/self-hosting#deploy-on-railway)** - Quick deployment using our template
2. **[Use Docker](/quickstart/self-hosting#using-docker)** - Self-host with Docker containers
3. **[Manual Deployment](/quickstart/self-hosting#manual-deployment)** - Deploy to your own servers

## Troubleshooting

### Common Issues

**"Invalid JWT" Error**

- Verify your environment variables are correct
- Check that your Supabase URL doesn't have trailing slashes

**"SMTP Authentication Failed"** (Supabase emails)

- Check optional Supabase SMTP settings under Authentication ‚Üí Email

**"Database Connection Failed"**

- Ensure your Supabase project is active
- Verify your project reference in the URL

**"Schema Push Failed"**

- Make sure you're using Supabase CLI version 1.51.0
- Check that you're logged in and linked to the correct project

### Getting Help

If you encounter issues:

1. Check the [Supabase documentation](https://supabase.com/docs)
2. Join our [Discord community](https://dub.sh/ciodiscord)
3. Open an [issue on GitHub](https://github.com/rotimi-best/classroomio/issues)

## Additional Resources

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase SMTP Guide](https://supabase.com/docs/guides/auth/auth-smtp)
- [ClassroomIO GitHub Repository](https://github.com/rotimi-best/classroomio)
- [ClassroomIO Discord](https://dub.sh/ciodiscord)

---

<Callout type="info" emoji="üí°">
  **Pro Tip**: Consider setting up a staging environment with a separate Supabase project for
  testing before deploying to production.
</Callout>
</Steps>
