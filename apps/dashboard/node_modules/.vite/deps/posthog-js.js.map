{
  "version": 3,
  "sources": ["../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/config.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/type-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/globals.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/logger.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/index.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/autocapture-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/rageclick.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/constants.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/autocapture.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/posthog-featureflags.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/uuidv7.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/storage.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/request-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/event-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/posthog-persistence.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/replay/sessionrecording-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/node_modules/@rrweb/types/dist/types.js", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/replay/config.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/replay/sessionrecording.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/decide.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/cloud.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/toolbar.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/gdpr-utils.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/base-request-queue.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/request-queue.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/node_modules/fflate/esm/browser.js", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/types.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/send-request.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/retry-queue.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/sessionid.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/sentry-integration.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/extensions/segment-integration.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/page-view.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/posthog-surveys.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/posthog-core.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/rate-limiter.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/session-props.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/utils/blocked-uas.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/compression.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/posthog-surveys-types.ts", "../../../../../node_modules/.pnpm/posthog-js@1.96.0/node_modules/posthog-js/src/loader-module.ts"],
  "sourcesContent": ["import { version } from '../package.json'\n\n// overriden in posthog-core,\n// e.g.     Config.DEBUG = Config.DEBUG || instance.config.debug\nconst Config = {\n    DEBUG: false,\n    LIB_VERSION: version,\n}\n\nexport default Config\n", "// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const _isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\nexport const _isUint8Array = function (x: unknown): x is Uint8Array {\n    return toString.call(x) === '[object Uint8Array]'\n}\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const _isFunction = function (f: any): f is (...args: any[]) => any {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof f === 'function'\n}\n// Underscore Addons\nexport const _isObject = function (x: unknown): x is Record<string, any> {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !_isArray(x)\n}\nexport const _isEmptyObject = function (x: unknown): x is Record<string, any> {\n    if (_isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const _isUndefined = function (x: unknown): x is undefined {\n    return x === void 0\n}\nexport const _isString = function (x: unknown): x is string {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const _isNull = function (x: unknown): x is null {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\nexport const _isDate = function (x: unknown): x is Date {\n    // eslint-disable-next-line posthog-js/no-direct-date-check\n    return toString.call(x) == '[object Date]'\n}\nexport const _isNumber = function (x: unknown): x is number {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const _isBoolean = function (x: unknown): x is boolean {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n", "/*\n * Saved references to long variable names, so that bundling can minimize file size.\n */\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n// eslint-disable-next-line no-restricted-globals\nexport const win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\nconst navigator = win?.navigator\nexport const document = win?.document\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: Window & typeof globalThis & Record<string, any> = win ?? ({} as any)\n\nexport { win as window }\n", "import Config from '../config'\nimport { _isUndefined } from './type-utils'\nimport { assignableWindow, window } from './globals'\n\nconst LOGGER_PREFIX = '[PostHog.js]'\nexport const logger = {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n        if (\n            window &&\n            (Config.DEBUG || assignableWindow.POSTHOG_DEBUG) &&\n            !_isUndefined(window.console) &&\n            window.console\n        ) {\n            const consoleLog =\n                '__rrweb_original__' in window.console[level]\n                    ? (window.console[level] as any)['__rrweb_original__']\n                    : window.console[level]\n\n            // eslint-disable-next-line no-console\n            consoleLog(LOGGER_PREFIX, ...args)\n        }\n    },\n\n    info: (...args: any[]) => {\n        logger._log('log', ...args)\n    },\n\n    warn: (...args: any[]) => {\n        logger._log('warn', ...args)\n    },\n\n    error: (...args: any[]) => {\n        logger._log('error', ...args)\n    },\n\n    critical: (...args: any[]) => {\n        // Critical errors are always logged to the console\n        // eslint-disable-next-line no-console\n        console.error(LOGGER_PREFIX, ...args)\n    },\n\n    uninitializedWarning: (methodName: string) => {\n        logger.error(`You must initialize PostHog before calling ${methodName}`)\n    },\n}\n", "import { Breaker, EventHandler, Properties } from '../types'\nimport {\n    _isArray,\n    _isDate,\n    _isFunction,\n    _isNull,\n    _isObject,\n    _isString,\n    _isUndefined,\n    hasOwnProperty,\n} from './type-utils'\nimport { logger } from './logger'\nimport { window, document, nativeForEach, nativeIndexOf } from './globals'\n\nconst breaker: Breaker = {}\n\n// UNDERSCORE\n// Embed part of the Underscore Library\nexport const _trim = function (str: string): string {\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\n\nexport const _bind_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = obj[func].bind(obj)\n        }\n    }\n}\n\nexport function _eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (_isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function _each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (_isNull(obj) || _isUndefined(obj)) {\n        return\n    }\n    if (_isArray(obj)) {\n        return _eachArray(obj, iterator, thisArg)\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const _extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    _eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const _include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (_isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    _each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\nexport function _includes<T = any>(str: T[] | string, needle: T): boolean {\n    return (str as any).indexOf(needle) !== -1\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function _entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const _isValidRegex = function (str: string): boolean {\n    try {\n        new RegExp(str)\n    } catch (error) {\n        return false\n    }\n    return true\n}\n\nexport const _encodeDates = function (obj: Properties): Properties {\n    _each(obj, function (v, k) {\n        if (_isDate(v)) {\n            obj[k] = _formatDate(v)\n        } else if (_isObject(v)) {\n            obj[k] = _encodeDates(v) // recurse\n        }\n    })\n    return obj\n}\n\nexport const _timestamp = function (): number {\n    Date.now =\n        Date.now ||\n        function () {\n            return +new Date()\n        }\n    return Date.now()\n}\n\nexport const _formatDate = function (d: Date): string {\n    // YYYY-MM-DDTHH:MM:SS in UTC\n    function pad(n: number) {\n        return n < 10 ? '0' + n : n\n    }\n    return (\n        d.getUTCFullYear() +\n        '-' +\n        pad(d.getUTCMonth() + 1) +\n        '-' +\n        pad(d.getUTCDate()) +\n        'T' +\n        pad(d.getUTCHours()) +\n        ':' +\n        pad(d.getUTCMinutes()) +\n        ':' +\n        pad(d.getUTCSeconds())\n    )\n}\n\nexport const _try = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch (e) {\n        return undefined\n    }\n}\n\nexport const _safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const _safewrap_class = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = _safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const _safewrap_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = _safewrap(obj[func])\n        }\n    }\n}\n\nexport const _strip_empty_properties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    _each(p, function (v, k) {\n        if (_isString(v) && v.length > 0) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (_isArray(value)) {\n            result = [] as any as T\n            _eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            _each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nconst LONG_STRINGS_ALLOW_LIST = ['$performance_raw']\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any, key) => {\n        if (key && LONG_STRINGS_ALLOW_LIST.indexOf(key as string) > -1) {\n            return value\n        }\n        if (_isString(value) && !_isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\nexport function _base64Encode(data: null): null\nexport function _base64Encode(data: undefined): undefined\nexport function _base64Encode(data: string): string\nexport function _base64Encode(data: string | null | undefined): string | null | undefined {\n    const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n    let o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = ''\n    const tmp_arr: string[] = []\n\n    if (!data) {\n        return data\n    }\n\n    data = _utf8Encode(data)\n\n    do {\n        // pack three octets into four hexets\n        o1 = data.charCodeAt(i++)\n        o2 = data.charCodeAt(i++)\n        o3 = data.charCodeAt(i++)\n\n        bits = (o1 << 16) | (o2 << 8) | o3\n\n        h1 = (bits >> 18) & 0x3f\n        h2 = (bits >> 12) & 0x3f\n        h3 = (bits >> 6) & 0x3f\n        h4 = bits & 0x3f\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4)\n    } while (i < data.length)\n\n    enc = tmp_arr.join('')\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '=='\n            break\n        case 2:\n            enc = enc.slice(0, -1) + '='\n            break\n    }\n\n    return enc\n}\n\nexport const _utf8Encode = function (string: string): string {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n\n    let utftext = '',\n        start,\n        end\n    let stringl = 0,\n        n\n\n    start = end = 0\n    stringl = string.length\n\n    for (n = 0; n < stringl; n++) {\n        const c1 = string.charCodeAt(n)\n        let enc = null\n\n        if (c1 < 128) {\n            end++\n        } else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128)\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128)\n        }\n        if (!_isNull(enc)) {\n            if (end > start) {\n                utftext += string.substring(start, end)\n            }\n            utftext += enc\n            start = end = n + 1\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length)\n    }\n\n    return utftext\n}\n\nexport const _register_event = (function () {\n    // written by Dean Edwards, 2005\n    // with input from Tino Zijdel - crisp@xs4all.nl\n    // with input from Carl Sverre - mail@carlsverre.com\n    // with input from PostHog\n    // http://dean.edwards.name/weblog/2005/10/add-event/\n    // https://gist.github.com/1930440\n\n    /**\n     * @param {Object} element\n     * @param {string} type\n     * @param {function(...*)} handler\n     * @param {boolean=} oldSchool\n     * @param {boolean=} useCapture\n     */\n    const register_event = function (\n        element: Element | Window | Document | Node,\n        type: string,\n        handler: EventHandler,\n        oldSchool?: boolean,\n        useCapture?: boolean\n    ) {\n        if (!element) {\n            logger.error('No valid element provided to register_event')\n            return\n        }\n\n        if (element.addEventListener && !oldSchool) {\n            element.addEventListener(type, handler, !!useCapture)\n        } else {\n            const ontype = 'on' + type\n            const old_handler = (element as any)[ontype] // can be undefined\n            ;(element as any)[ontype] = makeHandler(element, handler, old_handler)\n        }\n    }\n\n    function makeHandler(\n        element: Element | Window | Document | Node,\n        new_handler: EventHandler,\n        old_handlers: EventHandler\n    ) {\n        return function (event: Event): boolean | void {\n            event = event || fixEvent(window?.event)\n\n            // this basically happens in firefox whenever another script\n            // overwrites the onload callback and doesn't pass the event\n            // object to previously defined callbacks.  All the browsers\n            // that don't define window.event implement addEventListener\n            // so the dom_loaded handler will still be fired as usual.\n            if (!event) {\n                return undefined\n            }\n\n            let ret = true\n            let old_result: any\n\n            if (_isFunction(old_handlers)) {\n                old_result = old_handlers(event)\n            }\n            const new_result = new_handler.call(element, event)\n\n            if (false === old_result || false === new_result) {\n                ret = false\n            }\n\n            return ret\n        }\n    }\n\n    function fixEvent(event: Event | undefined): Event | undefined {\n        if (event) {\n            event.preventDefault = fixEvent.preventDefault\n            event.stopPropagation = fixEvent.stopPropagation\n        }\n        return event\n    }\n    fixEvent.preventDefault = function () {\n        ;(this as any as Event).returnValue = false\n    }\n    fixEvent.stopPropagation = function () {\n        ;(this as any as Event).cancelBubble = true\n    }\n\n    return register_event\n})()\n\nexport function loadScript(scriptUrlToLoad: string, callback: (error?: string | Event, event?: Event) => void): void {\n    const addScript = () => {\n        if (!document) {\n            return callback('document not found')\n        }\n        const scriptTag = document.createElement('script')\n        scriptTag.type = 'text/javascript'\n        scriptTag.src = scriptUrlToLoad\n        scriptTag.onload = (event) => callback(undefined, event)\n        scriptTag.onerror = (error) => callback(error)\n\n        const scripts = document.querySelectorAll('body > script')\n        if (scripts.length > 0) {\n            scripts[0].parentNode?.insertBefore(scriptTag, scripts[0])\n        } else {\n            // In exceptional situations this call might load before the DOM is fully ready.\n            document.body.appendChild(scriptTag)\n        }\n    }\n\n    if (document?.body) {\n        addScript()\n    } else {\n        document?.addEventListener('DOMContentLoaded', addScript)\n    }\n}\n\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!_isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    return hostname.split('.').slice(-2).join('.') !== 'herokuapp.com'\n}\n\nexport function isDistinctIdStringLike(value: string): boolean {\n    return ['distinct_id', 'distinctid'].includes(value.toLowerCase())\n}\n", "import { AutocaptureConfig, Properties } from 'types'\nimport { _each, _entries, _includes, _trim } from './utils'\n\nimport { _isArray, _isNull, _isString, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window } from './utils/globals'\n\nexport function splitClassString(s: string): string[] {\n    return s ? _trim(s).split(/\\s+/) : []\n}\n\n/*\n * Get the className of an element, accounting for edge cases where element.className is an object\n *\n * Because this is a string it can contain unexpected characters\n * So, this method safely splits the className and returns that array.\n */\nexport function getClassNames(el: Element): string[] {\n    let className = ''\n    switch (typeof el.className) {\n        case 'string':\n            className = el.className\n            break\n        // TODO: when is this ever used?\n        case 'object': // handle cases where className might be SVGAnimatedString or some other type\n            className =\n                ('baseVal' in el.className ? (el.className as any).baseVal : null) || el.getAttribute('class') || ''\n            break\n        default:\n            className = ''\n    }\n\n    return splitClassString(className)\n}\n\n/*\n * Get the direct text content of an element, protecting against sensitive data collection.\n * Concats textContent of each of the element's text node children; this avoids potential\n * collection of sensitive data that could happen if we used element.textContent and the\n * element had sensitive child elements, since element.textContent includes child content.\n * Scrubs values that look like they could be sensitive (i.e. cc or ssn number).\n * @param {Element} el - element to get the text of\n * @returns {string} the element's direct text content\n */\nexport function getSafeText(el: Element): string {\n    let elText = ''\n\n    if (shouldCaptureElement(el) && !isSensitiveElement(el) && el.childNodes && el.childNodes.length) {\n        _each(el.childNodes, function (child) {\n            if (isTextNode(child) && child.textContent) {\n                elText += _trim(child.textContent)\n                    // scrub potentially sensitive values\n                    .split(/(\\s+)/)\n                    .filter(shouldCaptureValue)\n                    .join('')\n                    // normalize whitespace\n                    .replace(/[\\r\\n]/g, ' ')\n                    .replace(/[ ]+/g, ' ')\n                    // truncate\n                    .substring(0, 255)\n            }\n        })\n    }\n\n    return _trim(elText)\n}\n\n/*\n * Check whether an element has nodeType Node.ELEMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isElementNode(el: Element | undefined | null): el is HTMLElement {\n    return !!el && el.nodeType === 1 // Node.ELEMENT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element is of a given tag type.\n * Due to potential reference discrepancies (such as the webcomponents.js polyfill),\n * we want to match tagNames instead of specific references because something like\n * element === document.body won't always work because element might not be a native\n * element.\n * @param {Element} el - element to check\n * @param {string} tag - tag name (e.g., \"div\")\n * @returns {boolean} whether el is of the given tag type\n */\nexport function isTag(el: Element | undefined | null, tag: string): el is HTMLElement {\n    return !!el && !!el.tagName && el.tagName.toLowerCase() === tag.toLowerCase()\n}\n\n/*\n * Check whether an element has nodeType Node.TEXT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isTextNode(el: Element | undefined | null): el is HTMLElement {\n    return !!el && el.nodeType === 3 // Node.TEXT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element has nodeType Node.DOCUMENT_FRAGMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isDocumentFragment(el: Element | ParentNode | undefined | null): el is DocumentFragment {\n    return !!el && el.nodeType === 11 // Node.DOCUMENT_FRAGMENT_NODE - use integer constant for browser portability\n}\n\nexport const autocaptureCompatibleElements = ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n/*\n * Check whether a DOM event should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @param {Event} event - event to check\n * @param {Object} autocaptureConfig - autocapture config\n * @returns {boolean} whether the event should be captured\n */\nexport function shouldCaptureDomEvent(\n    el: Element,\n    event: Event,\n    autocaptureConfig: AutocaptureConfig | undefined = undefined\n): boolean {\n    if (!window || !el || isTag(el, 'html') || !isElementNode(el)) {\n        return false\n    }\n\n    if (autocaptureConfig?.url_allowlist) {\n        const url = window.location.href\n        const allowlist = autocaptureConfig.url_allowlist\n        if (allowlist && !allowlist.some((regex) => url.match(regex))) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.dom_event_allowlist) {\n        const allowlist = autocaptureConfig.dom_event_allowlist\n        if (allowlist && !allowlist.some((eventType) => event.type === eventType)) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.element_allowlist) {\n        const allowlist = autocaptureConfig.element_allowlist\n        if (allowlist && !allowlist.some((elementType) => el.tagName.toLowerCase() === elementType)) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.css_selector_allowlist) {\n        const allowlist = autocaptureConfig.css_selector_allowlist\n        if (allowlist && !allowlist.some((selector) => el.matches(selector))) {\n            return false\n        }\n    }\n\n    let parentIsUsefulElement = false\n    const targetElementList: Element[] = [el] // TODO: remove this var, it's never queried\n    let parentNode: Element | boolean = true\n    let curEl: Element = el\n    while (curEl.parentNode && !isTag(curEl, 'body')) {\n        // If element is a shadow root, we skip it\n        if (isDocumentFragment(curEl.parentNode)) {\n            targetElementList.push((curEl.parentNode as any).host)\n            curEl = (curEl.parentNode as any).host\n            continue\n        }\n        parentNode = (curEl.parentNode as Element) || false\n        if (!parentNode) break\n        if (autocaptureCompatibleElements.indexOf(parentNode.tagName.toLowerCase()) > -1) {\n            parentIsUsefulElement = true\n        } else {\n            const compStyles = window.getComputedStyle(parentNode)\n            if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer') {\n                parentIsUsefulElement = true\n            }\n        }\n\n        targetElementList.push(parentNode)\n        curEl = parentNode\n    }\n\n    const compStyles = window.getComputedStyle(el)\n    if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer' && event.type === 'click') {\n        return true\n    }\n\n    const tag = el.tagName.toLowerCase()\n    switch (tag) {\n        case 'html':\n            return false\n        case 'form':\n            return event.type === 'submit'\n        case 'input':\n            return event.type === 'change' || event.type === 'click'\n        case 'select':\n        case 'textarea':\n            return event.type === 'change' || event.type === 'click'\n        default:\n            if (parentIsUsefulElement) return event.type === 'click'\n            return (\n                event.type === 'click' &&\n                (autocaptureCompatibleElements.indexOf(tag) > -1 || el.getAttribute('contenteditable') === 'true')\n            )\n    }\n}\n\n/*\n * Check whether a DOM element should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureElement(el: Element): boolean {\n    for (let curEl = el; curEl.parentNode && !isTag(curEl, 'body'); curEl = curEl.parentNode as Element) {\n        const classes = getClassNames(curEl)\n        if (_includes(classes, 'ph-sensitive') || _includes(classes, 'ph-no-capture')) {\n            return false\n        }\n    }\n\n    if (_includes(getClassNames(el), 'ph-include')) {\n        return true\n    }\n\n    // don't include hidden or password fields\n    const type = (el as HTMLInputElement).type || ''\n    if (_isString(type)) {\n        // it's possible for el.type to be a DOM element if el is a form with a child input[name=\"type\"]\n        switch (type.toLowerCase()) {\n            case 'hidden':\n                return false\n            case 'password':\n                return false\n        }\n    }\n\n    // filter out data from fields that look like sensitive fields\n    const name = (el as HTMLInputElement).name || el.id || ''\n    // See https://github.com/posthog/posthog-js/issues/165\n    // Under specific circumstances a bug caused .replace to be called on a DOM element\n    // instead of a string, removing the element from the page. Ensure this issue is mitigated.\n    if (_isString(name)) {\n        // it's possible for el.name or el.id to be a DOM element if el is a form with a child input[name=\"name\"]\n        const sensitiveNameRegex =\n            /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i\n        if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ''))) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether a DOM element is 'sensitive' and we should only capture limited data\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function isSensitiveElement(el: Element): boolean {\n    // don't send data from inputs or similar elements since there will always be\n    // a risk of clientside javascript placing sensitive data in attributes\n    const allowedInputTypes = ['button', 'checkbox', 'submit', 'reset']\n    if (\n        (isTag(el, 'input') && !allowedInputTypes.includes((el as HTMLInputElement).type)) ||\n        isTag(el, 'select') ||\n        isTag(el, 'textarea') ||\n        el.getAttribute('contenteditable') === 'true'\n    ) {\n        return true\n    }\n    return false\n}\n\n/*\n * Check whether a string value should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {string} value - string value to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureValue(value: string): boolean {\n    if (_isNull(value) || _isUndefined(value)) {\n        return false\n    }\n\n    if (_isString(value)) {\n        value = _trim(value)\n\n        // check to see if input value looks like a credit card number\n        // see: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s20.html\n        const ccRegex =\n            /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/\n        if (ccRegex.test((value || '').replace(/[- ]/g, ''))) {\n            return false\n        }\n\n        // check to see if input value looks like a social security number\n        const ssnRegex = /(^\\d{3}-?\\d{2}-?\\d{4}$)/\n        if (ssnRegex.test(value)) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether an attribute name is an Angular style attr (either _ngcontent or _nghost)\n * These update on each build and lead to noise in the element chain\n * More details on the attributes here: https://angular.io/guide/view-encapsulation\n * @param {string} attributeName - string value to check\n * @returns {boolean} whether the element is an angular tag\n */\nexport function isAngularStyleAttr(attributeName: string): boolean {\n    if (_isString(attributeName)) {\n        return attributeName.substring(0, 10) === '_ngcontent' || attributeName.substring(0, 7) === '_nghost'\n    }\n    return false\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces,\n * along with the direct text content of the target element\n * @param {Element} target - element to check\n * @returns {string} text content of the target element and its child span tags\n */\nexport function getDirectAndNestedSpanText(target: Element): string {\n    let text = getSafeText(target)\n    text = `${text} ${getNestedSpanText(target)}`.trim()\n    return shouldCaptureValue(text) ? text : ''\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces\n * @param {Element} target - element to check\n * @returns {string} text content of span tags\n */\nexport function getNestedSpanText(target: Element): string {\n    let text = ''\n    if (target && target.childNodes && target.childNodes.length) {\n        _each(target.childNodes, function (child) {\n            if (child && child.tagName?.toLowerCase() === 'span') {\n                try {\n                    const spanText = getSafeText(child)\n                    text = `${text} ${spanText}`.trim()\n\n                    if (child.childNodes && child.childNodes.length) {\n                        text = `${text} ${getNestedSpanText(child)}`.trim()\n                    }\n                } catch (e) {\n                    logger.error(e)\n                }\n            }\n        })\n    }\n    return text\n}\n\n/*\nBack in the day storing events in Postgres we use Elements for autocapture events.\nNow we're using elements_chain. We used to do this parsing/processing during ingestion.\nThis code is just copied over from ingestion, but we should optimize it\nto create elements_chain string directly.\n*/\nexport function getElementsChainString(elements: Properties[]): string {\n    return elementsToString(extractElements(elements))\n}\n\n// This interface is called 'Element' in plugin-scaffold https://github.com/PostHog/plugin-scaffold/blob/b07d3b879796ecc7e22deb71bf627694ba05386b/src/types.ts#L200\n// However 'Element' is a DOM Element when run in the browser, so we have to rename it\ninterface PHElement {\n    text?: string\n    tag_name?: string\n    href?: string\n    attr_id?: string\n    attr_class?: string[]\n    nth_child?: number\n    nth_of_type?: number\n    attributes?: Record<string, any>\n    event_id?: number\n    order?: number\n    group_id?: number\n}\n\nfunction escapeQuotes(input: string): string {\n    return input.replace(/\"|\\\\\"/g, '\\\\\"')\n}\n\nfunction elementsToString(elements: PHElement[]): string {\n    const ret = elements.map((element) => {\n        let el_string = ''\n        if (element.tag_name) {\n            el_string += element.tag_name\n        }\n        if (element.attr_class) {\n            element.attr_class.sort()\n            for (const single_class of element.attr_class) {\n                el_string += `.${single_class.replace(/\"/g, '')}`\n            }\n        }\n        const attributes: Record<string, any> = {\n            ...(element.text ? { text: element.text } : {}),\n            'nth-child': element.nth_child ?? 0,\n            'nth-of-type': element.nth_of_type ?? 0,\n            ...(element.href ? { href: element.href } : {}),\n            ...(element.attr_id ? { attr_id: element.attr_id } : {}),\n            ...element.attributes,\n        }\n        const sortedAttributes: Record<string, any> = {}\n        _entries(attributes)\n            .sort(([a], [b]) => a.localeCompare(b))\n            .forEach(\n                ([key, value]) => (sortedAttributes[escapeQuotes(key.toString())] = escapeQuotes(value.toString()))\n            )\n        el_string += ':'\n        el_string += _entries(attributes)\n            .map(([key, value]) => `${key}=\"${value}\"`)\n            .join('')\n        return el_string\n    })\n    return ret.join(';')\n}\n\nfunction extractElements(elements: Properties[]): PHElement[] {\n    return elements.map((el) => {\n        const response = {\n            text: el['$el_text']?.slice(0, 400),\n            tag_name: el['tag_name'],\n            href: el['attr__href']?.slice(0, 2048),\n            attr_class: extractAttrClass(el),\n            attr_id: el['attr__id'],\n            nth_child: el['nth_child'],\n            nth_of_type: el['nth_of_type'],\n            attributes: {} as { [id: string]: any },\n        }\n        _entries(el)\n            .filter(([key]) => key.indexOf('attr__') === 0)\n            .forEach(([key, value]) => (response.attributes[key] = value))\n        return response\n    })\n}\n\nfunction extractAttrClass(el: Properties): PHElement['attr_class'] {\n    const attr_class = el['attr__class']\n    if (!attr_class) {\n        return undefined\n    } else if (_isArray(attr_class)) {\n        return attr_class\n    } else {\n        return splitClassString(attr_class)\n    }\n}\n", "// Naive rage click implementation: If mouse has not moved than RAGE_CLICK_THRESHOLD_PX\n// over RAGE_CLICK_CLICK_COUNT clicks with max RAGE_CLICK_TIMEOUT_MS between clicks, it's\n// counted as a rage click\n\nconst RAGE_CLICK_THRESHOLD_PX = 30\nconst RAGE_CLICK_TIMEOUT_MS = 1000\nconst RAGE_CLICK_CLICK_COUNT = 3\n\nexport default class RageClick {\n    clicks: { x: number; y: number; timestamp: number }[]\n    enabled: boolean\n\n    constructor(enabled: boolean) {\n        this.clicks = []\n        this.enabled = enabled\n    }\n\n    isRageClick(x: number, y: number, timestamp: number): boolean {\n        if (!this.enabled) {\n            return false\n        }\n\n        const lastClick = this.clicks[this.clicks.length - 1]\n        if (\n            lastClick &&\n            Math.abs(x - lastClick.x) + Math.abs(y - lastClick.y) < RAGE_CLICK_THRESHOLD_PX &&\n            timestamp - lastClick.timestamp < RAGE_CLICK_TIMEOUT_MS\n        ) {\n            this.clicks.push({ x, y, timestamp })\n\n            if (this.clicks.length === RAGE_CLICK_CLICK_COUNT) {\n                return true\n            }\n        } else {\n            this.clicks = [{ x, y, timestamp }]\n        }\n\n        return false\n    }\n}\n", "/*\n * Constants\n */\n\n/* PROPERTY KEYS */\n\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\nexport const PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id'\nexport const DISTINCT_ID = 'distinct_id'\nexport const ALIAS_ID_KEY = '__alias'\nexport const CAMPAIGN_IDS_KEY = '__cmpns'\nexport const EVENT_TIMERS_KEY = '__timers'\nexport const AUTOCAPTURE_DISABLED_SERVER_SIDE = '$autocapture_disabled_server_side'\nexport const SESSION_RECORDING_ENABLED_SERVER_SIDE = '$session_recording_enabled_server_side'\nexport const CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE = '$console_log_recording_enabled_server_side'\nexport const SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE = '$session_recording_recorder_version_server_side' // follows rrweb versioning\nexport const SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE = '$session_recording_network_payload_capture'\nexport const SESSION_ID = '$sesid'\nexport const SESSION_RECORDING_IS_SAMPLED = '$session_is_sampled'\nexport const ENABLED_FEATURE_FLAGS = '$enabled_feature_flags'\nexport const PERSISTENCE_EARLY_ACCESS_FEATURES = '$early_access_features'\nexport const STORED_PERSON_PROPERTIES_KEY = '$stored_person_properties'\nexport const STORED_GROUP_PROPERTIES_KEY = '$stored_group_properties'\nexport const SURVEYS = '$surveys'\nexport const FLAG_CALL_REPORTED = '$flag_call_reported'\nexport const USER_STATE = '$user_state'\nexport const POSTHOG_QUOTA_LIMITED = '$posthog_quota_limited'\nexport const CLIENT_SESSION_PROPS = '$client_session_props'\n\n// These are properties that are reserved and will not be automatically included in events\nexport const PERSISTENCE_RESERVED_PROPERTIES = [\n    PEOPLE_DISTINCT_ID_KEY,\n    ALIAS_ID_KEY,\n    CAMPAIGN_IDS_KEY,\n    EVENT_TIMERS_KEY,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_ID,\n    ENABLED_FEATURE_FLAGS,\n    USER_STATE,\n    POSTHOG_QUOTA_LIMITED,\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    SURVEYS,\n    FLAG_CALL_REPORTED,\n    CLIENT_SESSION_PROPS,\n]\n", "import { _bind_instance_methods, _each, _extend, _includes, _register_event, _safewrap_instance_methods } from './utils'\nimport {\n    getClassNames,\n    getSafeText,\n    isElementNode,\n    isSensitiveElement,\n    isTag,\n    isTextNode,\n    shouldCaptureDomEvent,\n    shouldCaptureElement,\n    shouldCaptureValue,\n    autocaptureCompatibleElements,\n    isAngularStyleAttr,\n    isDocumentFragment,\n    getDirectAndNestedSpanText,\n    getElementsChainString,\n    splitClassString,\n} from './autocapture-utils'\nimport RageClick from './extensions/rageclick'\nimport { AutocaptureConfig, AutoCaptureCustomProperty, DecideResponse, Properties } from './types'\nimport { PostHog } from './posthog-core'\nimport { AUTOCAPTURE_DISABLED_SERVER_SIDE } from './constants'\n\nimport { _isBoolean, _isFunction, _isNull, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window, document } from './utils/globals'\n\nfunction limitText(length: number, text: string): string {\n    if (text.length > length) {\n        return text.slice(0, length) + '...'\n    }\n    return text\n}\n\nconst autocapture = {\n    _initializedTokens: [] as string[],\n    _isDisabledServerSide: null as boolean | null,\n    _isAutocaptureEnabled: false as boolean,\n\n    _setIsAutocaptureEnabled: function (instance: PostHog): void {\n        const disabled_server_side = _isNull(this._isDisabledServerSide)\n            ? !!instance.persistence?.props[AUTOCAPTURE_DISABLED_SERVER_SIDE]\n            : this._isDisabledServerSide\n        const enabled_client_side = !!instance.config.autocapture\n        this._isAutocaptureEnabled = enabled_client_side && !disabled_server_side\n    },\n\n    _previousElementSibling: function (el: Element): Element | null {\n        if (el.previousElementSibling) {\n            return el.previousElementSibling\n        } else {\n            let _el: Element | null = el\n            do {\n                _el = _el.previousSibling as Element | null // resolves to ChildNode->Node, which is Element's parent class\n            } while (_el && !isElementNode(_el))\n            return _el\n        }\n    },\n\n    _getAugmentPropertiesFromElement: function (elem: Element): Properties {\n        const shouldCaptureEl = shouldCaptureElement(elem)\n        if (!shouldCaptureEl) {\n            return {}\n        }\n\n        const props: Properties = {}\n\n        _each(elem.attributes, function (attr: Attr) {\n            if (attr.name.indexOf('data-ph-capture-attribute') === 0) {\n                const propertyKey = attr.name.replace('data-ph-capture-attribute-', '')\n                const propertyValue = attr.value\n                if (propertyKey && propertyValue && shouldCaptureValue(propertyValue)) {\n                    props[propertyKey] = propertyValue\n                }\n            }\n        })\n        return props\n    },\n\n    _getPropertiesFromElement: function (elem: Element, maskInputs: boolean, maskText: boolean): Properties {\n        const tag_name = elem.tagName.toLowerCase()\n        const props: Properties = {\n            tag_name: tag_name,\n        }\n        if (autocaptureCompatibleElements.indexOf(tag_name) > -1 && !maskText) {\n            if (tag_name.toLowerCase() === 'a' || tag_name.toLowerCase() === 'button') {\n                props['$el_text'] = limitText(1024, getDirectAndNestedSpanText(elem))\n            } else {\n                props['$el_text'] = limitText(1024, getSafeText(elem))\n            }\n        }\n\n        const classes = getClassNames(elem)\n        if (classes.length > 0)\n            props['classes'] = classes.filter(function (c) {\n                return c !== ''\n            })\n\n        // capture the deny list here because this not-a-class class makes it tricky to use this.config in the function below\n        const elementAttributeIgnorelist = this.config?.element_attribute_ignorelist\n        _each(elem.attributes, function (attr: Attr) {\n            // Only capture attributes we know are safe\n            if (isSensitiveElement(elem) && ['name', 'id', 'class'].indexOf(attr.name) === -1) return\n\n            if (elementAttributeIgnorelist?.includes(attr.name)) return\n\n            if (!maskInputs && shouldCaptureValue(attr.value) && !isAngularStyleAttr(attr.name)) {\n                let value = attr.value\n                if (attr.name === 'class') {\n                    // html attributes can _technically_ contain linebreaks,\n                    // but we're very intolerant of them in the class string,\n                    // so we strip them.\n                    value = splitClassString(value).join(' ')\n                }\n                props['attr__' + attr.name] = limitText(1024, value)\n            }\n        })\n\n        let nthChild = 1\n        let nthOfType = 1\n        let currentElem: Element | null = elem\n        while ((currentElem = this._previousElementSibling(currentElem))) {\n            // eslint-disable-line no-cond-assign\n            nthChild++\n            if (currentElem.tagName === elem.tagName) {\n                nthOfType++\n            }\n        }\n        props['nth_child'] = nthChild\n        props['nth_of_type'] = nthOfType\n\n        return props\n    },\n\n    _getDefaultProperties: function (eventType: string): Properties {\n        return {\n            $event_type: eventType,\n            $ce_version: 1,\n        }\n    },\n\n    _extractCustomPropertyValue: function (customProperty: AutoCaptureCustomProperty): string {\n        const propValues: string[] = []\n        _each(document?.querySelectorAll(customProperty['css_selector']), function (matchedElem) {\n            let value\n\n            if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n                value = matchedElem['value']\n            } else if (matchedElem['textContent']) {\n                value = matchedElem['textContent']\n            }\n\n            if (shouldCaptureValue(value)) {\n                propValues.push(value)\n            }\n        })\n        return propValues.join(', ')\n    },\n\n    // TODO: delete custom_properties after changeless typescript refactor\n    _getCustomProperties: function (targetElementList: Element[]): Properties {\n        const props: Properties = {} // will be deleted\n        _each(this._customProperties, (customProperty) => {\n            _each(customProperty['event_selectors'], (eventSelector) => {\n                const eventElements = document?.querySelectorAll(eventSelector)\n                _each(eventElements, (eventElement) => {\n                    if (_includes(targetElementList, eventElement) && shouldCaptureElement(eventElement)) {\n                        props[customProperty['name']] = this._extractCustomPropertyValue(customProperty)\n                    }\n                })\n            })\n        })\n        return props\n    },\n\n    _getEventTarget: function (e: Event): Element | null {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n        if (_isUndefined(e.target)) {\n            return (e.srcElement as Element) || null\n        } else {\n            if ((e.target as HTMLElement)?.shadowRoot) {\n                return (e.composedPath()[0] as Element) || null\n            }\n            return (e.target as Element) || null\n        }\n    },\n\n    _captureEvent: function (e: Event, instance: PostHog, eventName = '$autocapture'): boolean | void {\n        /*** Don't mess with this code without running IE8 tests on it ***/\n        let target = this._getEventTarget(e)\n        if (isTextNode(target)) {\n            // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n            target = (target.parentNode || null) as Element | null\n        }\n\n        if (eventName === '$autocapture' && e.type === 'click' && e instanceof MouseEvent) {\n            if (this.rageclicks?.isRageClick(e.clientX, e.clientY, new Date().getTime())) {\n                this._captureEvent(e, instance, '$rageclick')\n            }\n        }\n\n        if (target && shouldCaptureDomEvent(target, e, this.config)) {\n            const targetElementList = [target]\n            let curEl = target\n            while (curEl.parentNode && !isTag(curEl, 'body')) {\n                if (isDocumentFragment(curEl.parentNode)) {\n                    targetElementList.push((curEl.parentNode as any).host)\n                    curEl = (curEl.parentNode as any).host\n                    continue\n                }\n                targetElementList.push(curEl.parentNode as Element)\n                curEl = curEl.parentNode as Element\n            }\n\n            const elementsJson: Properties[] = []\n            const autocaptureAugmentProperties: Properties = {}\n            let href,\n                explicitNoCapture = false\n            _each(targetElementList, (el) => {\n                const shouldCaptureEl = shouldCaptureElement(el)\n\n                // if the element or a parent element is an anchor tag\n                // include the href as a property\n                if (el.tagName.toLowerCase() === 'a') {\n                    href = el.getAttribute('href')\n                    href = shouldCaptureEl && shouldCaptureValue(href) && href\n                }\n\n                // allow users to programmatically prevent capturing of elements by adding class 'ph-no-capture'\n                const classes = getClassNames(el)\n                if (_includes(classes, 'ph-no-capture')) {\n                    explicitNoCapture = true\n                }\n\n                elementsJson.push(\n                    this._getPropertiesFromElement(\n                        el,\n                        instance.config.mask_all_element_attributes,\n                        instance.config.mask_all_text\n                    )\n                )\n\n                const augmentProperties = this._getAugmentPropertiesFromElement(el)\n                _extend(autocaptureAugmentProperties, augmentProperties)\n            })\n\n            if (!instance.config.mask_all_text) {\n                // if the element is a button or anchor tag get the span text from any\n                // children and include it as/with the text property on the parent element\n                if (target.tagName.toLowerCase() === 'a' || target.tagName.toLowerCase() === 'button') {\n                    elementsJson[0]['$el_text'] = getDirectAndNestedSpanText(target)\n                } else {\n                    elementsJson[0]['$el_text'] = getSafeText(target)\n                }\n            }\n\n            if (href) {\n                elementsJson[0]['attr__href'] = href\n            }\n\n            if (explicitNoCapture) {\n                return false\n            }\n\n            const props = _extend(\n                this._getDefaultProperties(e.type),\n                instance.elementsChainAsString\n                    ? {\n                          $elements_chain: getElementsChainString(elementsJson),\n                      }\n                    : {\n                          $elements: elementsJson,\n                      },\n                elementsJson[0]?.['$el_text'] ? { $el_text: elementsJson[0]?.['$el_text'] } : {},\n                this._getCustomProperties(targetElementList),\n                autocaptureAugmentProperties\n            )\n\n            instance.capture(eventName, props)\n            return true\n        }\n    },\n\n    // only reason is to stub for unit tests\n    // since you can't override window.location props\n    _navigate: function (href: string): void {\n        if (!window) {\n            return\n        }\n        window.location.href = href\n    },\n\n    _addDomEventHandlers: function (instance: PostHog): void {\n        if (!window || !document) {\n            return\n        }\n        const handler = (e: Event) => {\n            e = e || window?.event\n            this._captureEvent(e, instance)\n        }\n        _register_event(document, 'submit', handler, false, true)\n        _register_event(document, 'change', handler, false, true)\n        _register_event(document, 'click', handler, false, true)\n    },\n\n    _customProperties: [] as AutoCaptureCustomProperty[],\n    rageclicks: null as RageClick | null,\n    config: undefined as AutocaptureConfig | undefined,\n\n    init: function (instance: PostHog): void {\n        if (!_isBoolean(instance.__autocapture)) {\n            this.config = instance.__autocapture\n        }\n\n        // precompile the regex\n        if (this.config?.url_allowlist) {\n            this.config.url_allowlist = this.config.url_allowlist.map((url) => new RegExp(url))\n        }\n\n        this.rageclicks = new RageClick(instance.config.rageclick)\n    },\n\n    afterDecideResponse: function (response: DecideResponse, instance: PostHog): void {\n        const token = instance.config.token\n        if (this._initializedTokens.indexOf(token) > -1) {\n            logger.info('autocapture already initialized for token \"' + token + '\"')\n            return\n        }\n\n        if (instance.persistence) {\n            instance.persistence.register({\n                [AUTOCAPTURE_DISABLED_SERVER_SIDE]: !!response['autocapture_opt_out'],\n            })\n        }\n        // store this in-memory incase persistence is disabled\n        this._isDisabledServerSide = !!response['autocapture_opt_out']\n\n        this._setIsAutocaptureEnabled(instance)\n\n        this._initializedTokens.push(token)\n\n        if (\n            response &&\n            response['config'] &&\n            response['config']['enable_collect_everything'] &&\n            this._isAutocaptureEnabled\n        ) {\n            // TODO: delete custom_properties after changeless typescript refactor\n            if (response['custom_properties']) {\n                this._customProperties = response['custom_properties']\n            }\n            this._addDomEventHandlers(instance)\n        } else {\n            instance['__autocapture'] = false\n        }\n    },\n\n    // this is a mechanism to ramp up CE with no server-side interaction.\n    // when CE is active, every page load results in a decide request. we\n    // need to gently ramp this up, so we don't overload decide. this decides\n    // deterministically if CE is enabled for this project by modding the char\n    // value of the project token.\n    enabledForProject: function (\n        token: string | null | undefined,\n        numBuckets: number,\n        numEnabledBuckets: number\n    ): boolean {\n        if (!token) {\n            return true\n        }\n        numBuckets = !_isUndefined(numBuckets) ? numBuckets : 10\n        numEnabledBuckets = !_isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10\n        let charCodeSum = 0\n        for (let i = 0; i < token.length; i++) {\n            charCodeSum += token.charCodeAt(i)\n        }\n        return charCodeSum % numBuckets < numEnabledBuckets\n    },\n\n    isBrowserSupported: function (): boolean {\n        return _isFunction(document?.querySelectorAll)\n    },\n}\n\n_bind_instance_methods(autocapture)\n_safewrap_instance_methods(autocapture)\n\nexport { autocapture }\n", "import { _base64Encode, _entries, _extend } from './utils'\nimport { PostHog } from './posthog-core'\nimport {\n    DecideResponse,\n    FeatureFlagsCallback,\n    EarlyAccessFeatureCallback,\n    EarlyAccessFeatureResponse,\n    Properties,\n    JsonType,\n    RequestCallback,\n} from './types'\nimport { PostHogPersistence } from './posthog-persistence'\n\nimport {\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    ENABLED_FEATURE_FLAGS,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    FLAG_CALL_REPORTED,\n} from './constants'\n\nimport { _isArray } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\nconst PERSISTENCE_ACTIVE_FEATURE_FLAGS = '$active_feature_flags'\nconst PERSISTENCE_OVERRIDE_FEATURE_FLAGS = '$override_feature_flags'\nconst PERSISTENCE_FEATURE_FLAG_PAYLOADS = '$feature_flag_payloads'\n\nexport const filterActiveFeatureFlags = (featureFlags?: Record<string, string | boolean>) => {\n    const activeFeatureFlags: Record<string, string | boolean> = {}\n    for (const [key, value] of _entries(featureFlags || {})) {\n        if (value) {\n            activeFeatureFlags[key] = value\n        }\n    }\n    return activeFeatureFlags\n}\n\nexport const parseFeatureFlagDecideResponse = (\n    response: Partial<DecideResponse>,\n    persistence: PostHogPersistence,\n    currentFlags: Record<string, string | boolean> = {},\n    currentFlagPayloads: Record<string, JsonType> = {}\n) => {\n    const flags = response['featureFlags']\n    const flagPayloads = response['featureFlagPayloads']\n    if (flags) {\n        // using the v1 api\n        if (_isArray(flags)) {\n            const $enabled_feature_flags: Record<string, boolean> = {}\n            if (flags) {\n                for (let i = 0; i < flags.length; i++) {\n                    $enabled_feature_flags[flags[i]] = true\n                }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: flags,\n                    [ENABLED_FEATURE_FLAGS]: $enabled_feature_flags,\n                })\n        } else {\n            // using the v2+ api\n            let newFeatureFlags = flags\n            let newFeatureFlagPayloads = flagPayloads\n            if (response.errorsWhileComputingFlags) {\n                // if not all flags were computed, we upsert flags instead of replacing them\n                newFeatureFlags = { ...currentFlags, ...newFeatureFlags }\n                newFeatureFlagPayloads = { ...currentFlagPayloads, ...newFeatureFlagPayloads }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFeatureFlags)),\n                    [ENABLED_FEATURE_FLAGS]: newFeatureFlags || {},\n                    [PERSISTENCE_FEATURE_FLAG_PAYLOADS]: newFeatureFlagPayloads || {},\n                })\n        }\n    }\n}\n\nexport class PostHogFeatureFlags {\n    instance: PostHog\n    _override_warning: boolean\n    featureFlagEventHandlers: FeatureFlagsCallback[]\n    reloadFeatureFlagsQueued: boolean\n    reloadFeatureFlagsInAction: boolean\n    $anon_distinct_id: string | undefined\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this._override_warning = false\n        this.featureFlagEventHandlers = []\n\n        this.reloadFeatureFlagsQueued = false\n        this.reloadFeatureFlagsInAction = false\n    }\n\n    getFlags(): string[] {\n        return Object.keys(this.getFlagVariants())\n    }\n\n    getFlagVariants(): Record<string, string | boolean> {\n        const enabledFlags = this.instance.get_property(ENABLED_FEATURE_FLAGS)\n        const overriddenFlags = this.instance.get_property(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        if (!overriddenFlags) {\n            return enabledFlags || {}\n        }\n\n        const finalFlags = _extend({}, enabledFlags)\n        const overriddenKeys = Object.keys(overriddenFlags)\n        for (let i = 0; i < overriddenKeys.length; i++) {\n            if (overriddenFlags[overriddenKeys[i]] === false) {\n                delete finalFlags[overriddenKeys[i]]\n            } else {\n                finalFlags[overriddenKeys[i]] = overriddenFlags[overriddenKeys[i]]\n            }\n        }\n        if (!this._override_warning) {\n            logger.warn(' Overriding feature flags!', {\n                enabledFlags,\n                overriddenFlags,\n                finalFlags,\n            })\n            this._override_warning = true\n        }\n        return finalFlags\n    }\n\n    getFlagPayloads(): Record<string, JsonType> {\n        const flagPayloads = this.instance.get_property(PERSISTENCE_FEATURE_FLAG_PAYLOADS)\n        return flagPayloads || {}\n    }\n\n    /**\n     * Reloads feature flags asynchronously.\n     *\n     * Constraints:\n     *\n     * 1. Avoid parallel requests\n     * 2. Delay a few milliseconds after each reloadFeatureFlags call to batch subsequent changes together\n     * 3. Don't call this during initial load (as /decide will be called instead), see posthog-core.js\n     */\n    reloadFeatureFlags(): void {\n        if (!this.reloadFeatureFlagsQueued) {\n            this.reloadFeatureFlagsQueued = true\n            this._startReloadTimer()\n        }\n    }\n\n    setAnonymousDistinctId(anon_distinct_id: string): void {\n        this.$anon_distinct_id = anon_distinct_id\n    }\n\n    setReloadingPaused(isPaused: boolean): void {\n        this.reloadFeatureFlagsInAction = isPaused\n    }\n\n    resetRequestQueue(): void {\n        this.reloadFeatureFlagsQueued = false\n    }\n\n    _startReloadTimer(): void {\n        if (this.reloadFeatureFlagsQueued && !this.reloadFeatureFlagsInAction) {\n            setTimeout(() => {\n                if (!this.reloadFeatureFlagsInAction && this.reloadFeatureFlagsQueued) {\n                    this.reloadFeatureFlagsQueued = false\n                    this._reloadFeatureFlagsRequest()\n                }\n            }, 5)\n        }\n    }\n\n    _reloadFeatureFlagsRequest(): void {\n        if (this.instance.config.advanced_disable_feature_flags) {\n            return\n        }\n\n        this.setReloadingPaused(true)\n        const token = this.instance.config.token\n        const personProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY)\n        const groupProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY)\n        const json_data = JSON.stringify({\n            token: token,\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            $anon_distinct_id: this.$anon_distinct_id,\n            person_properties: personProperties,\n            group_properties: groupProperties,\n            disable_flags: this.instance.config.advanced_disable_feature_flags || undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            this.instance.config.api_host + '/decide/?v=3',\n            { data: encoded_data },\n            { method: 'POST' },\n            this.instance._prepare_callback((response) => {\n                // reset anon_distinct_id after at least a single request with it\n                // makes it through\n                this.$anon_distinct_id = undefined\n                this.receivedFeatureFlags(response as DecideResponse)\n\n                // :TRICKY: Reload - start another request if queued!\n                this.setReloadingPaused(false)\n                this._startReloadTimer()\n            }) as RequestCallback\n        )\n    }\n\n    /*\n     * Get feature flag's value for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('my-flag') === 'some-variant') { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options: { send_event?: boolean } = {}): boolean | string | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            logger.warn('getFeatureFlag for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        const flagValue = this.getFlagVariants()[key]\n        const flagReportValue = `${flagValue}`\n        const flagCallReported: Record<string, string[]> = this.instance.get_property(FLAG_CALL_REPORTED) || {}\n\n        if (options.send_event || !('send_event' in options)) {\n            if (!(key in flagCallReported) || !flagCallReported[key].includes(flagReportValue)) {\n                if (_isArray(flagCallReported[key])) {\n                    flagCallReported[key].push(flagReportValue)\n                } else {\n                    flagCallReported[key] = [flagReportValue]\n                }\n                this.instance.persistence?.register({ [FLAG_CALL_REPORTED]: flagCallReported })\n\n                this.instance.capture('$feature_flag_called', { $feature_flag: key, $feature_flag_response: flagValue })\n            }\n        }\n        return flagValue\n    }\n\n    getFeatureFlagPayload(key: string): JsonType {\n        const payloads = this.getFlagPayloads()\n        return payloads[key]\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options: { send_event?: boolean } = {}): boolean | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            logger.warn('isFeatureEnabled for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        return !!this.getFeatureFlag(key, options)\n    }\n\n    addFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers.push(handler)\n    }\n\n    removeFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers = this.featureFlagEventHandlers.filter((h) => h !== handler)\n    }\n\n    receivedFeatureFlags(response: Partial<DecideResponse>): void {\n        if (!this.instance.persistence) {\n            return\n        }\n        this.instance.decideEndpointWasHit = true\n        const currentFlags = this.getFlagVariants()\n        const currentFlagPayloads = this.getFlagPayloads()\n        parseFeatureFlagDecideResponse(response, this.instance.persistence, currentFlags, currentFlagPayloads)\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    /*\n     * Override feature flags for debugging.\n     *\n     * ### Usage:\n     *\n     *     - posthog.feature_flags.override(false)\n     *     - posthog.feature_flags.override(['beta-feature'])\n     *     - posthog.feature_flags.override({'beta-feature': 'variant', 'other-feature': True})\n     *\n     * @param {Object|Array|String} flags Flags to override with.\n     */\n    override(flags: boolean | string[] | Record<string, string | boolean>): void {\n        if (!this.instance.__loaded || !this.instance.persistence) {\n            return logger.uninitializedWarning('posthog.feature_flags.override')\n        }\n\n        this._override_warning = false\n\n        if (flags === false) {\n            this.instance.persistence.unregister(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        } else if (_isArray(flags)) {\n            const flagsObj: Record<string, string | boolean> = {}\n            for (let i = 0; i < flags.length; i++) {\n                flagsObj[flags[i]] = true\n            }\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flagsObj })\n        } else {\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flags })\n        }\n    }\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: FeatureFlagsCallback): () => void {\n        this.addFeatureFlagsHandler(callback)\n        if (this.instance.decideEndpointWasHit) {\n            const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n            callback(flags, flagVariants)\n        }\n        return () => this.removeFeatureFlagsHandler(callback)\n    }\n\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        const enrollmentPersonProp = {\n            [`$feature_enrollment/${key}`]: isEnrolled,\n        }\n        this.instance.capture('$feature_enrollment_update', {\n            $feature_flag: key,\n            $feature_enrollment: isEnrolled,\n            $set: enrollmentPersonProp,\n        })\n        this.setPersonPropertiesForFlags(enrollmentPersonProp, false)\n\n        const newFlags = { ...this.getFlagVariants(), [key]: isEnrolled }\n        this.instance.persistence?.register({\n            [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFlags)),\n            [ENABLED_FEATURE_FLAGS]: newFlags,\n        })\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        const existing_early_access_features = this.instance.get_property(PERSISTENCE_EARLY_ACCESS_FEATURES)\n\n        if (!existing_early_access_features || force_reload) {\n            this.instance._send_request(\n                `${this.instance.config.api_host}/api/early_access_features/?token=${this.instance.config.token}`,\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const earlyAccessFeatures = (response as EarlyAccessFeatureResponse).earlyAccessFeatures\n                    this.instance.persistence?.register({ [PERSISTENCE_EARLY_ACCESS_FEATURES]: earlyAccessFeatures })\n                    return callback(earlyAccessFeatures)\n                }\n            )\n        } else {\n            return callback(existing_early_access_features)\n        }\n    }\n\n    _prepareFeatureFlagsForCallbacks(): { flags: string[]; flagVariants: Record<string, string | boolean> } {\n        const flags = this.getFlags()\n        const flagVariants = this.getFlagVariants()\n\n        // Return truthy\n        const truthyFlags = flags.filter((flag) => flagVariants[flag])\n        const truthyFlagVariants = Object.keys(flagVariants)\n            .filter((variantKey) => flagVariants[variantKey])\n            .reduce((res: Record<string, string | boolean>, key) => {\n                res[key] = flagVariants[key]\n                return res\n            }, {})\n\n        return {\n            flags: truthyFlags,\n            flagVariants: truthyFlagVariants,\n        }\n    }\n\n    _fireFeatureFlagsCallbacks(): void {\n        const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n        this.featureFlagEventHandlers.forEach((handler) => handler(flags, flagVariants))\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        // Get persisted person properties\n        const existingProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY) || {}\n\n        this.instance.register({\n            [STORED_PERSON_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.instance.unregister(STORED_PERSON_PROPERTIES_KEY)\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        // Get persisted group properties\n        const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n\n        if (Object.keys(existingProperties).length !== 0) {\n            Object.keys(existingProperties).forEach((groupType) => {\n                existingProperties[groupType] = {\n                    ...existingProperties[groupType],\n                    ...properties[groupType],\n                }\n                delete properties[groupType]\n            })\n        }\n\n        this.instance.register({\n            [STORED_GROUP_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        if (group_type) {\n            const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n            this.instance.register({\n                [STORED_GROUP_PROPERTIES_KEY]: { ...existingProperties, [group_type]: {} },\n            })\n        } else {\n            this.instance.unregister(STORED_GROUP_PROPERTIES_KEY)\n        }\n    }\n}\n", "/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nimport { window } from './utils/globals'\n\nimport { _isNumber, _isUndefined } from './utils/type-utils'\n\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return _isNumber(value) && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private timestamp = 0\n    private counter = 0\n    private readonly random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (!_isUndefined(value)) {\n            return value\n        } else {\n            // reset state and resume\n            this.timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (_isUndefined(valueAfterReset)) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this.timestamp) {\n            this.timestamp = ts\n            this.resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this.timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this.counter++\n            if (this.counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this.timestamp++\n                this.resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this.timestamp,\n            Math.trunc(this.counter / 2 ** 30),\n            this.counter & (2 ** 30 - 1),\n            this.random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private resetCounter(): void {\n        this.counter = this.random.nextUint32() * 0x400 + (this.random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    // TRICKY: don't use the _isUndefined method here as can't pass the reference\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (window && !_isUndefined(window.crypto) && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly buffer = new Uint32Array(8)\n    private cursor = Infinity\n    nextUint32(): number {\n        if (this.cursor >= this.buffer.length) {\n            getRandomValues(this.buffer)\n            this.cursor = 0\n        }\n        return this.buffer[this.cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n", "import { _extend } from './utils'\nimport { PersistentStore, Properties } from './types'\nimport { DISTINCT_ID, SESSION_ID, SESSION_RECORDING_IS_SAMPLED } from './constants'\n\nimport { _isNull, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window, document } from './utils/globals'\nimport { uuidv7 } from './uuidv7'\n\nconst Y1970 = 'Thu, 01 Jan 1970 00:00:00 GMT'\n// we store the discovered subdomain in memory because it might be read multiple times\nlet firstNonPublicSubDomain = ''\n\n// helper to allow tests to clear this \"cache\"\nexport const resetSubDomainCache = () => {\n    firstNonPublicSubDomain = ''\n}\n\n/**\n * Browsers don't offer a way to check if something is a public suffix\n * e.g. `.com.au`, `.io`, `.org.uk`\n *\n * But they do reject cookies set on public suffixes\n * Setting a cookie on `.co.uk` would mean it was sent for every `.co.uk` site visited\n *\n * So, we can use this to check if a domain is a public suffix\n * by trying to set a cookie on a subdomain of the provided hostname\n * until the browser accepts it\n *\n * inspired by https://github.com/AngusFu/browser-root-domain\n */\nexport function seekFirstNonPublicSubDomain(hostname: string, cookieJar = document): string {\n    if (firstNonPublicSubDomain) {\n        return firstNonPublicSubDomain\n    }\n\n    if (!cookieJar) {\n        return ''\n    }\n    if (['localhost', '127.0.0.1'].includes(hostname)) return ''\n\n    const list = hostname.split('.')\n    let len = Math.min(list.length, 8) // paranoia - we know this number should be small\n    const key = 'dmn_chk_' + uuidv7()\n    const R = new RegExp('(^|;)\\\\s*' + key + '=1')\n\n    while (!firstNonPublicSubDomain && len--) {\n        const candidate = list.slice(len).join('.')\n        const candidateCookieValue = key + '=1;domain=.' + candidate\n\n        // try to set cookie\n        cookieJar.cookie = candidateCookieValue\n\n        if (R.test(cookieJar.cookie)) {\n            // the cookie was accepted by the browser, remove the test cookie\n            cookieJar.cookie = candidateCookieValue + ';expires=' + Y1970\n            firstNonPublicSubDomain = candidate\n        }\n    }\n\n    return firstNonPublicSubDomain\n}\n\nconst DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z]{2,}$/i\nconst originalCookieDomainFn = (hostname: string): string => {\n    const matches = hostname.match(DOMAIN_MATCH_REGEX)\n    return matches ? matches[0] : ''\n}\n\nexport function chooseCookieDomain(hostname: string, cross_subdomain: boolean | undefined): string {\n    if (cross_subdomain) {\n        // NOTE: Could we use this for cross domain tracking?\n        let matchedSubDomain = seekFirstNonPublicSubDomain(hostname)\n\n        if (!matchedSubDomain) {\n            const originalMatch = originalCookieDomainFn(hostname)\n            if (originalMatch !== matchedSubDomain) {\n                logger.info('Warning: cookie subdomain discovery mismatch', originalMatch, matchedSubDomain)\n            }\n            matchedSubDomain = originalMatch\n        }\n\n        return matchedSubDomain ? '; domain=.' + matchedSubDomain : ''\n    }\n    return ''\n}\n\n// Methods partially borrowed from quirksmode.org/js/cookies.html\nexport const cookieStore: PersistentStore = {\n    is_supported: () => !!document,\n\n    error: function (msg) {\n        logger.error('cookieStore error: ' + msg)\n    },\n\n    get: function (name) {\n        if (!document) {\n            return\n        }\n\n        try {\n            const nameEQ = name + '='\n            const ca = document.cookie.split(';').filter((x) => x.length)\n            for (let i = 0; i < ca.length; i++) {\n                let c = ca[i]\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length)\n                }\n                if (c.indexOf(nameEQ) === 0) {\n                    return decodeURIComponent(c.substring(nameEQ.length, c.length))\n                }\n            }\n        } catch (err) {}\n        return null\n    },\n\n    parse: function (name) {\n        let cookie\n        try {\n            cookie = JSON.parse(cookieStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return cookie\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        if (!document) {\n            return\n        }\n        try {\n            let expires = '',\n                secure = ''\n\n            const cdomain = chooseCookieDomain(document.location.hostname, cross_subdomain)\n\n            if (days) {\n                const date = new Date()\n                date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)\n                expires = '; expires=' + date.toUTCString()\n            }\n\n            if (is_secure) {\n                secure = '; secure'\n            }\n\n            const new_cookie_val =\n                name +\n                '=' +\n                encodeURIComponent(JSON.stringify(value)) +\n                expires +\n                '; SameSite=Lax; path=/' +\n                cdomain +\n                secure\n\n            // 4096 bytes is the size at which some browsers (e.g. firefox) will not store a cookie, warn slightly before that\n            if (new_cookie_val.length > 4096 * 0.9) {\n                logger.warn('cookieStore warning: large cookie, len=' + new_cookie_val.length)\n            }\n\n            document.cookie = new_cookie_val\n            return new_cookie_val\n        } catch (err) {\n            return\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            cookieStore.set(name, '', -1, cross_subdomain)\n        } catch (err) {\n            return\n        }\n    },\n}\n\nlet _localStorage_supported: boolean | null = null\n\nexport const localStore: PersistentStore = {\n    is_supported: function () {\n        if (!_isNull(_localStorage_supported)) {\n            return _localStorage_supported\n        }\n\n        let supported = true\n        if (!_isUndefined(window)) {\n            try {\n                const key = '__mplssupport__',\n                    val = 'xyz'\n                localStore.set(key, val)\n                if (localStore.get(key) !== '\"xyz\"') {\n                    supported = false\n                }\n                localStore.remove(key)\n            } catch (err) {\n                supported = false\n            }\n        } else {\n            supported = false\n        }\n        if (!supported) {\n            logger.error('localStorage unsupported; falling back to cookie store')\n        }\n\n        _localStorage_supported = supported\n        return supported\n    },\n\n    error: function (msg) {\n        logger.error('localStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        try {\n            return window?.localStorage.getItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(localStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window?.localStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window?.localStorage.removeItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\n// Use localstorage for most data but still use cookie for COOKIE_PERSISTED_PROPERTIES\n// This solves issues with cookies having too much data in them causing headers too large\n// Also makes sure we don't have to send a ton of data to the server\nconst COOKIE_PERSISTED_PROPERTIES = [DISTINCT_ID, SESSION_ID, SESSION_RECORDING_IS_SAMPLED]\n\nexport const localPlusCookieStore: PersistentStore = {\n    ...localStore,\n    parse: function (name) {\n        try {\n            let extend: Properties = {}\n            try {\n                // See if there's a cookie stored with data.\n                extend = cookieStore.parse(name) || {}\n            } catch (err) {}\n            const value = _extend(extend, JSON.parse(localStore.get(name) || '{}'))\n            localStore.set(name, value)\n            return value\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        try {\n            localStore.set(name, value)\n            const cookiePersistedProperties: Record<string, any> = {}\n            COOKIE_PERSISTED_PROPERTIES.forEach((key) => {\n                if (value[key]) {\n                    cookiePersistedProperties[key] = value[key]\n                }\n            })\n\n            if (Object.keys(cookiePersistedProperties).length) {\n                cookieStore.set(name, cookiePersistedProperties, days, cross_subdomain, is_secure)\n            }\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            window?.localStorage.removeItem(name)\n            cookieStore.remove(name, cross_subdomain)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\nconst memoryStorage: Properties = {}\n\n// Storage that only lasts the length of the pageview if we don't want to use cookies\nexport const memoryStore: PersistentStore = {\n    is_supported: function () {\n        return true\n    },\n\n    error: function (msg) {\n        logger.error('memoryStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    parse: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    set: function (name, value) {\n        memoryStorage[name] = value\n    },\n\n    remove: function (name) {\n        delete memoryStorage[name]\n    },\n}\n\nlet sessionStorageSupported: boolean | null = null\nexport const resetSessionStorageSupported = () => {\n    sessionStorageSupported = null\n}\n// Storage that only lasts the length of a tab/window. Survives page refreshes\nexport const sessionStore: PersistentStore = {\n    is_supported: function () {\n        if (!_isNull(sessionStorageSupported)) {\n            return sessionStorageSupported\n        }\n        sessionStorageSupported = true\n        if (!_isUndefined(window)) {\n            try {\n                const key = '__support__',\n                    val = 'xyz'\n                sessionStore.set(key, val)\n                if (sessionStore.get(key) !== '\"xyz\"') {\n                    sessionStorageSupported = false\n                }\n                sessionStore.remove(key)\n            } catch (err) {\n                sessionStorageSupported = false\n            }\n        } else {\n            sessionStorageSupported = false\n        }\n        return sessionStorageSupported\n    },\n\n    error: function (msg) {\n        logger.error('sessionStorage error: ', msg)\n    },\n\n    get: function (name) {\n        try {\n            return window?.sessionStorage.getItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(sessionStore.get(name)) || null\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window?.sessionStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window?.sessionStorage.removeItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n}\n", "import { _each, _isValidRegex } from './'\n\nimport { _isArray, _isUndefined } from './type-utils'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (_isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const _isUrlMatchingRegex = function (url: string, pattern: string): boolean {\n    if (!_isValidRegex(pattern)) return false\n    return new RegExp(pattern).test(url)\n}\n\nexport const _HTTPBuildQuery = function (formdata: Record<string, any>, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    _each(formdata, function (val, key) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (_isUndefined(val) || _isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\nexport const _getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n    const queryParams: string = withoutHash.split('?')[1] || ''\n\n    const queryParts = queryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!_isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch (err) {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n", "import { _getQueryParam, convertToURL } from './request-utils'\nimport { _isNull, _isUndefined } from './type-utils'\nimport { Properties } from '../types'\nimport Config from '../config'\nimport { _each, _extend, _includes, _strip_empty_properties, _timestamp } from './index'\nimport { document, window, userAgent, assignableWindow } from './globals'\n\n/**\n * Safari detection turns out to be complicted. For e.g. https://stackoverflow.com/a/29696509\n * We can be slightly loose because some options have been ruled out (e.g. firefox on iOS)\n * before this check is made\n */\nfunction isSafari(userAgent: string): boolean {\n    return _includes(userAgent, 'Safari') && !_includes(userAgent, 'Chrome') && !_includes(userAgent, 'Android')\n}\n\nexport const _info = {\n    campaignParams: function (customParams?: string[]): Record<string, any> {\n        // Should be kept in sync with https://github.com/PostHog/posthog/blob/master/plugin-server/src/utils/db/utils.ts#L60\n        const campaign_keywords = [\n            'utm_source',\n            'utm_medium',\n            'utm_campaign',\n            'utm_content',\n            'utm_term',\n            'gclid',\n            'gbraid',\n            'wbraid',\n            'fbclid',\n            'msclkid',\n        ].concat(customParams || [])\n\n        const params: Record<string, any> = {}\n        _each(campaign_keywords, function (kwkey) {\n            const kw = document ? _getQueryParam(document.URL, kwkey) : ''\n            if (kw.length) {\n                params[kwkey] = kw\n            }\n        })\n\n        return params\n    },\n\n    searchEngine: function (): string | null {\n        const referrer = document?.referrer\n        if (!referrer) {\n            return null\n        } else if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n            return 'google'\n        } else if (referrer.search('https?://(.*)bing.com') === 0) {\n            return 'bing'\n        } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n            return 'yahoo'\n        } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n            return 'duckduckgo'\n        } else {\n            return null\n        }\n    },\n\n    searchInfo: function (): Record<string, any> {\n        const search = _info.searchEngine(),\n            param = search != 'yahoo' ? 'q' : 'p',\n            ret: Record<string, any> = {}\n\n        if (!_isNull(search)) {\n            ret['$search_engine'] = search\n\n            const keyword = document ? _getQueryParam(document.referrer, param) : ''\n            if (keyword.length) {\n                ret['ph_keyword'] = keyword\n            }\n        }\n\n        return ret\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include key words used in later checks.\n     */\n    browser: function (user_agent: string, vendor: string | undefined, opera?: any): string {\n        vendor = vendor || '' // vendor is undefined for at least IE9\n        if (opera || _includes(user_agent, ' OPR/')) {\n            if (_includes(user_agent, 'Mini')) {\n                return 'Opera Mini'\n            }\n            return 'Opera'\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry'\n        } else if (_includes(user_agent, 'IEMobile') || _includes(user_agent, 'WPDesktop')) {\n            return 'Internet Explorer Mobile'\n        } else if (_includes(user_agent, 'SamsungBrowser/')) {\n            // https://developer.samsung.com/internet/user-agent-string-format\n            return 'Samsung Internet'\n        } else if (_includes(user_agent, 'Edge') || _includes(user_agent, 'Edg/')) {\n            return 'Microsoft Edge'\n        } else if (_includes(user_agent, 'FBIOS')) {\n            return 'Facebook Mobile'\n        } else if (_includes(user_agent, 'Chrome')) {\n            return 'Chrome'\n        } else if (_includes(user_agent, 'CriOS')) {\n            return 'Chrome iOS'\n        } else if (_includes(user_agent, 'UCWEB') || _includes(user_agent, 'UCBrowser')) {\n            return 'UC Browser'\n        } else if (_includes(user_agent, 'FxiOS')) {\n            return 'Firefox iOS'\n        } else if (_includes(vendor, 'Apple') || isSafari(user_agent)) {\n            if (_includes(user_agent, 'Mobile')) {\n                return 'Mobile Safari'\n            }\n            return 'Safari'\n        } else if (_includes(user_agent, 'Android')) {\n            return 'Android Mobile'\n        } else if (_includes(user_agent, 'Konqueror') || _includes(user_agent, 'konqueror')) {\n            return 'Konqueror'\n        } else if (_includes(user_agent, 'Firefox')) {\n            return 'Firefox'\n        } else if (_includes(user_agent, 'MSIE') || _includes(user_agent, 'Trident/')) {\n            return 'Internet Explorer'\n        } else if (_includes(user_agent, 'Gecko')) {\n            return 'Mozilla'\n        } else {\n            return ''\n        }\n    },\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     *\n     * `navigator.vendor` is passed in and used to help with detecting certain browsers\n     * NB `navigator.vendor` is deprecated and not present in every browser\n     */\n    browserVersion: function (userAgent: string, vendor: string | undefined, opera: string): number | null {\n        const browser = _info.browser(userAgent, vendor, opera)\n        const versionRegexes: Record<string, RegExp[]> = {\n            'Internet Explorer Mobile': [/rv:(\\d+(\\.\\d+)?)/],\n            'Microsoft Edge': [/Edge?\\/(\\d+(\\.\\d+)?)/],\n            Chrome: [/Chrome\\/(\\d+(\\.\\d+)?)/],\n            'Chrome iOS': [/CriOS\\/(\\d+(\\.\\d+)?)/],\n            'UC Browser': [/(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/],\n            Safari: [/Version\\/(\\d+(\\.\\d+)?)/],\n            'Mobile Safari': [/Version\\/(\\d+(\\.\\d+)?)/],\n            Opera: [/(Opera|OPR)\\/(\\d+(\\.\\d+)?)/],\n            Firefox: [/Firefox\\/(\\d+(\\.\\d+)?)/],\n            'Firefox iOS': [/FxiOS\\/(\\d+(\\.\\d+)?)/],\n            Konqueror: [/Konqueror[:/]?(\\d+(\\.\\d+)?)/i],\n            // not every blackberry user agent has the version after the name\n            BlackBerry: [/BlackBerry (\\d+(\\.\\d+)?)/, /Version\\/(\\d+(\\.\\d+)?)/],\n            'Android Mobile': [/android\\s(\\d+(\\.\\d+)?)/],\n            'Samsung Internet': [/SamsungBrowser\\/(\\d+(\\.\\d+)?)/],\n            'Internet Explorer': [/(rv:|MSIE )(\\d+(\\.\\d+)?)/],\n            Mozilla: [/rv:(\\d+(\\.\\d+)?)/],\n        }\n        const regexes: RegExp[] | undefined = versionRegexes[browser as keyof typeof versionRegexes]\n        if (_isUndefined(regexes)) {\n            return null\n        }\n\n        for (let i = 0; i < regexes.length; i++) {\n            const regex = regexes[i]\n            const matches = userAgent.match(regex)\n            if (matches) {\n                return parseFloat(matches[matches.length - 2])\n            }\n        }\n        return null\n    },\n\n    browserLanguage: function (): string {\n        return (\n            navigator.language || // Any modern browser\n            (navigator as Record<string, any>).userLanguage // IE11\n        )\n    },\n\n    os: function (user_agent: string): { os_name: string; os_version: string } {\n        if (/Windows/i.test(user_agent)) {\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) {\n                return { os_name: 'Windows Phone', os_version: '' }\n            }\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent)\n            if (match && match[1]) {\n                const version = match[1]\n                return { os_name: 'Windows', os_version: version }\n            }\n            return { os_name: 'Windows', os_version: '' }\n        } else if (/(iPhone|iPad|iPod)/.test(user_agent)) {\n            const match = /OS (\\d+)_(\\d+)_?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'iOS', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'iOS', os_version: '' }\n        } else if (/Android/.test(user_agent)) {\n            const match = /Android (\\d+)\\.(\\d+)\\.?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'Android', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'Android', os_version: '' }\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return { os_name: 'BlackBerry', os_version: '' }\n        } else if (/Mac/i.test(user_agent)) {\n            const match = /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i.exec(user_agent)\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                return { os_name: 'Mac OS X', os_version: versionParts.join('.') }\n            }\n            return { os_name: 'Mac OS X', os_version: '' }\n        } else if (/Linux/.test(user_agent)) {\n            return { os_name: 'Linux', os_version: '' }\n        } else if (/CrOS/.test(user_agent)) {\n            return { os_name: 'Chrome OS', os_version: '' }\n        } else {\n            return { os_name: '', os_version: '' }\n        }\n    },\n\n    device: function (user_agent: string): string {\n        if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n            return 'Windows Phone'\n        } else if (/iPad/.test(user_agent)) {\n            return 'iPad'\n        } else if (/iPod/.test(user_agent)) {\n            return 'iPod Touch'\n        } else if (/iPhone/.test(user_agent)) {\n            return 'iPhone'\n        } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n            return 'BlackBerry'\n        } else if (/Android/.test(user_agent) && !/Mobile/.test(user_agent)) {\n            return 'Android Tablet'\n        } else if (/Android/.test(user_agent)) {\n            return 'Android'\n        } else {\n            return ''\n        }\n    },\n\n    deviceType: function (user_agent: string): string {\n        const device = this.device(user_agent)\n        if (device === 'iPad' || device === 'Android Tablet') {\n            return 'Tablet'\n        } else if (device) {\n            return 'Mobile'\n        } else {\n            return 'Desktop'\n        }\n    },\n\n    referrer: function (): string {\n        return document?.referrer || '$direct'\n    },\n\n    referringDomain: function (): string {\n        if (!document?.referrer) {\n            return '$direct'\n        }\n        return convertToURL(document.referrer)?.host || '$direct'\n    },\n\n    properties: function (): Properties {\n        if (!userAgent) {\n            return {}\n        }\n        const { os_name, os_version } = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, assignableWindow.opera),\n                $device: _info.device(userAgent),\n                $device_type: _info.deviceType(userAgent),\n            }),\n            {\n                $current_url: window?.location.href,\n                $host: window?.location.host,\n                $pathname: window?.location.pathname,\n                $raw_user_agent: userAgent.length > 1000 ? userAgent.substring(0, 997) + '...' : userAgent,\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, assignableWindow.opera),\n                $browser_language: _info.browserLanguage(),\n                $screen_height: window?.screen.height,\n                $screen_width: window?.screen.width,\n                $viewport_height: window?.innerHeight,\n                $viewport_width: window?.innerWidth,\n                $lib: 'web',\n                $lib_version: Config.LIB_VERSION,\n                $insert_id: Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n                $time: _timestamp() / 1000, // epoch time in seconds\n            }\n        )\n    },\n\n    people_properties: function (): Properties {\n        if (!userAgent) {\n            return {}\n        }\n\n        const { os_name, os_version } = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, assignableWindow.opera),\n            }),\n            {\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, assignableWindow.opera),\n            }\n        )\n    },\n}\n", "/* eslint camelcase: \"off\" */\n\nimport { _each, _extend, _include, _strip_empty_properties } from './utils'\nimport { cookieStore, localStore, localPlusCookieStore, memoryStore, sessionStore } from './storage'\nimport { PersistentStore, PostHogConfig, Properties } from './types'\nimport {\n    PERSISTENCE_RESERVED_PROPERTIES,\n    EVENT_TIMERS_KEY,\n    ENABLED_FEATURE_FLAGS,\n    POSTHOG_QUOTA_LIMITED,\n    USER_STATE,\n} from './constants'\n\nimport { _isObject, _isUndefined } from './utils/type-utils'\nimport { _info } from './utils/event-utils'\nimport { logger } from './utils/logger'\n\nconst CASE_INSENSITIVE_PERSISTENCE_TYPES: readonly Lowercase<PostHogConfig['persistence']>[] = [\n    'cookie',\n    'localstorage',\n    'localstorage+cookie',\n    'sessionstorage',\n    'memory',\n]\n\n/**\n * PostHog Persistence Object\n * @constructor\n */\nexport class PostHogPersistence {\n    props: Properties\n    storage: PersistentStore\n    campaign_params_saved: boolean\n    custom_campaign_params: string[]\n    name: string\n    disabled: boolean | undefined\n    secure: boolean | undefined\n    expire_days: number | undefined\n    default_expiry: number | undefined\n    cross_subdomain: boolean | undefined\n    user_state: 'anonymous' | 'identified'\n\n    constructor(config: PostHogConfig) {\n        // clean chars that aren't accepted by the http spec for cookie values\n        // https://datatracker.ietf.org/doc/html/rfc2616#section-2.2\n        let token = ''\n\n        if (config['token']) {\n            token = config['token'].replace(/\\+/g, 'PL').replace(/\\//g, 'SL').replace(/=/g, 'EQ')\n        }\n\n        this.props = {}\n        this.campaign_params_saved = false\n        this.custom_campaign_params = config['custom_campaign_params'] || []\n\n        if (config['persistence_name']) {\n            this.name = 'ph_' + config['persistence_name']\n        } else {\n            this.name = 'ph_' + token + '_posthog'\n        }\n\n        if (\n            CASE_INSENSITIVE_PERSISTENCE_TYPES.indexOf(\n                config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n            ) === -1\n        ) {\n            logger.critical(\n                'Unknown persistence type ' + config['persistence'] + '; falling back to localStorage+cookie'\n            )\n            config['persistence'] = 'localStorage+cookie'\n        }\n        // We handle storage type in a case-insensitive way for backwards compatibility\n        const storage_type = config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n        if (storage_type === 'localstorage' && localStore.is_supported()) {\n            this.storage = localStore\n        } else if (storage_type === 'localstorage+cookie' && localPlusCookieStore.is_supported()) {\n            this.storage = localPlusCookieStore\n        } else if (storage_type === 'sessionstorage' && sessionStore.is_supported()) {\n            this.storage = sessionStore\n        } else if (storage_type === 'memory') {\n            this.storage = memoryStore\n        } else if (storage_type === 'cookie') {\n            this.storage = cookieStore\n        } else {\n            // selected storage type wasn't supported, fallback to 'localstorage+cookie' if possible\n            if (localPlusCookieStore.is_supported()) {\n                this.storage = localPlusCookieStore\n            } else {\n                this.storage = cookieStore\n            }\n        }\n\n        this.user_state = 'anonymous'\n\n        this.load()\n        this.update_config(config)\n        this.save()\n    }\n\n    properties(): Properties {\n        const p: Properties = {}\n        // Filter out reserved properties\n        _each(this.props, function (v, k) {\n            if (k === ENABLED_FEATURE_FLAGS && _isObject(v)) {\n                const keys = Object.keys(v)\n                for (let i = 0; i < keys.length; i++) {\n                    p[`$feature/${keys[i]}`] = v[keys[i]]\n                }\n            } else if (!_include(PERSISTENCE_RESERVED_PROPERTIES, k)) {\n                p[k] = v\n            }\n        })\n        return p\n    }\n\n    load(): void {\n        if (this.disabled) {\n            return\n        }\n\n        const entry = this.storage.parse(this.name)\n\n        if (entry) {\n            this.props = _extend({}, entry)\n        }\n    }\n\n    /**\n     * NOTE: Saving frequently causes issues with Recordings and Consent Management Platform (CMP) tools which\n     * observe cookie changes, and modify their UI, often causing infinite loops.\n     * As such callers of this should ideally check that the data has changed beforehand\n     */\n    save(): void {\n        if (this.disabled) {\n            return\n        }\n        this.storage.set(this.name, this.props, this.expire_days, this.cross_subdomain, this.secure)\n    }\n\n    remove(): void {\n        // remove both domain and subdomain cookies\n        this.storage.remove(this.name, false)\n        this.storage.remove(this.name, true)\n    }\n\n    // removes the storage entry and deletes all loaded data\n    // forced name for tests\n\n    clear(): void {\n        this.remove()\n        this.props = {}\n    }\n\n    /**\n     * @param {Object} props\n     * @param {*=} default_value\n     * @param {number=} days\n     */\n\n    register_once(props: Properties, default_value: any, days?: number): boolean {\n        if (_isObject(props)) {\n            if (_isUndefined(default_value)) {\n                default_value = 'None'\n            }\n            this.expire_days = _isUndefined(days) ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (!this.props.hasOwnProperty(prop) || this.props[prop] === default_value) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    /**\n     * @param {Object} props\n     * @param {number=} days\n     */\n\n    register(props: Properties, days?: number): boolean {\n        if (_isObject(props)) {\n            this.expire_days = _isUndefined(days) ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (props.hasOwnProperty(prop) && this.props[prop] !== val) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    unregister(prop: string): void {\n        if (prop in this.props) {\n            delete this.props[prop]\n            this.save()\n        }\n    }\n\n    update_campaign_params(): void {\n        if (!this.campaign_params_saved) {\n            this.register(_info.campaignParams(this.custom_campaign_params))\n            this.campaign_params_saved = true\n        }\n    }\n\n    update_search_keyword(): void {\n        this.register(_info.searchInfo())\n    }\n\n    update_referrer_info(): void {\n        this.register({\n            $referrer: this.props['$referrer'] || _info.referrer(),\n            $referring_domain: this.props['$referring_domain'] || _info.referringDomain(),\n        })\n    }\n\n    get_referrer_info(): Properties {\n        return _strip_empty_properties({\n            $referrer: this['props']['$referrer'],\n            $referring_domain: this['props']['$referring_domain'],\n        })\n    }\n\n    // safely fills the passed in object with stored properties,\n    // does not override any properties defined in both\n    // returns the passed in object\n\n    safe_merge(props: Properties): Properties {\n        _each(this.props, function (val, prop) {\n            if (!(prop in props)) {\n                props[prop] = val\n            }\n        })\n\n        return props\n    }\n\n    update_config(config: PostHogConfig): void {\n        this.default_expiry = this.expire_days = config['cookie_expiration']\n        this.set_disabled(config['disable_persistence'])\n        this.set_cross_subdomain(config['cross_subdomain_cookie'])\n        this.set_secure(config['secure_cookie'])\n    }\n\n    set_disabled(disabled: boolean): void {\n        this.disabled = disabled\n        if (this.disabled) {\n            this.remove()\n        } else {\n            this.save()\n        }\n    }\n\n    set_cross_subdomain(cross_subdomain: boolean): void {\n        if (cross_subdomain !== this.cross_subdomain) {\n            this.cross_subdomain = cross_subdomain\n            this.remove()\n            this.save()\n        }\n    }\n\n    get_cross_subdomain(): boolean {\n        return !!this.cross_subdomain\n    }\n\n    set_secure(secure: boolean): void {\n        if (secure !== this.secure) {\n            this.secure = secure\n            this.remove()\n            this.save()\n        }\n    }\n\n    set_event_timer(event_name: string, timestamp: number): void {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        timers[event_name] = timestamp\n        this.props[EVENT_TIMERS_KEY] = timers\n        this.save()\n    }\n\n    remove_event_timer(event_name: string): number {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        const timestamp = timers[event_name]\n        if (!_isUndefined(timestamp)) {\n            delete this.props[EVENT_TIMERS_KEY][event_name]\n            this.save()\n        }\n        return timestamp\n    }\n\n    get_user_state(): 'anonymous' | 'identified' {\n        return this.props[USER_STATE] || 'anonymous'\n    }\n\n    set_user_state(state: 'anonymous' | 'identified'): void {\n        this.props[USER_STATE] = state\n        this.save()\n    }\n\n    get_quota_limits(): Record<string, number> {\n        return this.props[POSTHOG_QUOTA_LIMITED] || {}\n    }\n\n    set_quota_limits(state: Record<string, number>): void {\n        this.props[POSTHOG_QUOTA_LIMITED] = state\n        this.save()\n    }\n}\n", "import type {\n    KeepIframeSrcFn,\n    RecordPlugin,\n    SamplingStrategy,\n    blockClass,\n    eventWithTime,\n    hooksParam,\n    listenerHandler,\n    maskTextClass,\n    pluginEvent,\n    mutationCallbackParam,\n} from '@rrweb/types'\nimport type { Mirror, MaskInputOptions, MaskInputFn, MaskTextFn, SlimDOMOptions, DataURLOptions } from 'rrweb-snapshot'\n\nimport { _isObject } from '../../utils/type-utils'\n\nexport const replacementImageURI =\n    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNOCAwSDE2TDAgMTZWOEw4IDBaIiBmaWxsPSIjMkQyRDJEIi8+CjxwYXRoIGQ9Ik0xNiA4VjE2SDhMMTYgOFoiIGZpbGw9IiMyRDJEMkQiLz4KPC9zdmc+Cg=='\n\nexport const FULL_SNAPSHOT_EVENT_TYPE = 2\nexport const META_EVENT_TYPE = 4\nexport const INCREMENTAL_SNAPSHOT_EVENT_TYPE = 3\nexport const PLUGIN_EVENT_TYPE = 6\nexport const MUTATION_SOURCE_TYPE = 0\n\nexport const MAX_MESSAGE_SIZE = 5000000 // ~5mb\n\nexport type rrwebRecord = {\n    (options: recordOptions<eventWithTime>): listenerHandler\n    addCustomEvent: (tag: string, payload: any) => void\n    takeFullSnapshot: () => void\n    mirror: Mirror\n}\n\nexport declare type recordOptions<T> = {\n    emit?: (e: T, isCheckout?: boolean) => void\n    checkoutEveryNth?: number\n    checkoutEveryNms?: number\n    blockClass?: blockClass\n    blockSelector?: string\n    ignoreClass?: string\n    maskTextClass?: maskTextClass\n    maskTextSelector?: string\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: MaskInputFn\n    maskTextFn?: MaskTextFn\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    ignoreCSSAttributes?: Set<string>\n    inlineStylesheet?: boolean\n    hooks?: hooksParam\n    // packFn?: PackFn\n    sampling?: SamplingStrategy\n    dataURLOptions?: DataURLOptions\n    recordCanvas?: boolean\n    recordCrossOriginIframes?: boolean\n    recordAfter?: 'DOMContentLoaded' | 'load'\n    userTriggeredOnInput?: boolean\n    collectFonts?: boolean\n    inlineImages?: boolean\n    plugins?: RecordPlugin[]\n    mousemoveWait?: number\n    keepIframeSrcFn?: KeepIframeSrcFn\n    // errorHandler?: ErrorHandler\n}\n\n/*\n * Check whether a data payload is nearing 5mb. If it is, it checks the data for\n * data URIs (the likely culprit for large payloads). If it finds data URIs, it either replaces\n * it with a generic image (if it's an image) or removes it.\n * @data {object} the rr-web data object\n * @returns {object} the rr-web data object with data uris filtered out\n */\nexport function ensureMaxMessageSize(data: eventWithTime): { event: eventWithTime; size: number } {\n    let stringifiedData = JSON.stringify(data)\n    // Note: with compression, this limit may be able to be increased\n    // but we're assuming most of the size is from a data uri which\n    // is unlikely to be compressed further\n\n    if (stringifiedData.length > MAX_MESSAGE_SIZE) {\n        // Regex that matches the pattern for a dataURI with the shape 'data:{mime type};{encoding},{data}'. It:\n        // 1) Checks if the pattern starts with 'data:' (potentially, not at the start of the string)\n        // 2) Extracts the mime type of the data uri in the first group\n        // 3) Determines when the data URI ends.Depending on if it's used in the src tag or css, it can end with a ) or \"\n        const dataURIRegex = /data:([\\w/\\-.]+);(\\w+),([^)\"]*)/gim\n        const matches = stringifiedData.matchAll(dataURIRegex)\n        for (const match of matches) {\n            if (match[1].toLocaleLowerCase().slice(0, 6) === 'image/') {\n                stringifiedData = stringifiedData.replace(match[0], replacementImageURI)\n            } else {\n                stringifiedData = stringifiedData.replace(match[0], '')\n            }\n        }\n    }\n    return { event: JSON.parse(stringifiedData), size: stringifiedData.length }\n}\n\nexport const CONSOLE_LOG_PLUGIN_NAME = 'rrweb/console@1' // The name of the rr-web plugin that emits console logs\n\n// Console logs can be really large. This function truncates large logs\n// It's a simple function that just truncates long strings.\n// TODO: Ideally this function would have better handling of objects + lists,\n// so they could still be rendered in a pretty way after truncation.\nexport function truncateLargeConsoleLogs(_event: eventWithTime) {\n    const event = _event as pluginEvent<{ payload: string[] }>\n\n    const MAX_STRING_SIZE = 2000 // Maximum number of characters allowed in a string\n    const MAX_STRINGS_PER_LOG = 10 // A log can consist of multiple strings (e.g. consol.log('string1', 'string2'))\n\n    if (\n        event &&\n        _isObject(event) &&\n        event.type === PLUGIN_EVENT_TYPE &&\n        _isObject(event.data) &&\n        event.data.plugin === CONSOLE_LOG_PLUGIN_NAME\n    ) {\n        // Note: event.data.payload.payload comes from rr-web, and is an array of strings\n        if (event.data.payload.payload.length > MAX_STRINGS_PER_LOG) {\n            event.data.payload.payload = event.data.payload.payload.slice(0, MAX_STRINGS_PER_LOG)\n            event.data.payload.payload.push('...[truncated]')\n        }\n        const updatedPayload = []\n        for (let i = 0; i < event.data.payload.payload.length; i++) {\n            if (\n                event.data.payload.payload[i] && // Value can be null\n                event.data.payload.payload[i].length > MAX_STRING_SIZE\n            ) {\n                updatedPayload.push(event.data.payload.payload[i].slice(0, MAX_STRING_SIZE) + '...[truncated]')\n            } else {\n                updatedPayload.push(event.data.payload.payload[i])\n            }\n        }\n        event.data.payload.payload = updatedPayload\n        // Return original type\n        return _event\n    }\n    return _event\n}\n\nexport class MutationRateLimiter {\n    private bucketSize = 100\n    private refillRate = 10\n    private mutationBuckets: Record<string, number> = {}\n    private loggedTracker: Record<string, boolean> = {}\n\n    constructor(\n        private readonly rrweb: rrwebRecord,\n        private readonly options: {\n            bucketSize?: number\n            refillRate?: number\n            onBlockedNode?: (id: number, node: Node | null) => void\n        } = {}\n    ) {\n        this.refillRate = this.options.refillRate ?? this.refillRate\n        this.bucketSize = this.options.bucketSize ?? this.bucketSize\n        setInterval(() => {\n            this.refillBuckets()\n        }, 1000)\n    }\n\n    private refillBuckets = () => {\n        Object.keys(this.mutationBuckets).forEach((key) => {\n            this.mutationBuckets[key] = this.mutationBuckets[key] + this.refillRate\n\n            if (this.mutationBuckets[key] >= this.bucketSize) {\n                delete this.mutationBuckets[key]\n            }\n        })\n    }\n\n    private getNodeOrRelevantParent = (id: number): [number, Node | null] => {\n        // For some nodes we know they are part of a larger tree such as an SVG.\n        // For those we want to block the entire node, not just the specific attribute\n\n        const node = this.rrweb.mirror.getNode(id)\n\n        // Check if the node is an Element and then find the closest parent that is an SVG\n        if (node?.nodeName !== 'svg' && node instanceof Element) {\n            const closestSVG = node.closest('svg')\n\n            if (closestSVG) {\n                return [this.rrweb.mirror.getId(closestSVG), closestSVG]\n            }\n        }\n\n        return [id, node]\n    }\n\n    private numberOfChanges = (data: Partial<mutationCallbackParam>) => {\n        return (\n            (data.removes?.length ?? 0) +\n            (data.attributes?.length ?? 0) +\n            (data.texts?.length ?? 0) +\n            (data.adds?.length ?? 0)\n        )\n    }\n\n    public throttleMutations = (event: eventWithTime) => {\n        if (event.type !== INCREMENTAL_SNAPSHOT_EVENT_TYPE || event.data.source !== MUTATION_SOURCE_TYPE) {\n            return event\n        }\n\n        const data = event.data as Partial<mutationCallbackParam>\n        const initialMutationCount = this.numberOfChanges(data)\n\n        if (data.attributes) {\n            // Most problematic mutations come from attrs where the style or minor properties are changed rapidly\n            data.attributes = data.attributes.filter((attr) => {\n                const [nodeId, node] = this.getNodeOrRelevantParent(attr.id)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    return false\n                }\n\n                this.mutationBuckets[nodeId] = this.mutationBuckets[nodeId] ?? this.bucketSize\n                this.mutationBuckets[nodeId] = Math.max(this.mutationBuckets[nodeId] - 1, 0)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    if (!this.loggedTracker[nodeId]) {\n                        this.loggedTracker[nodeId] = true\n                        this.options.onBlockedNode?.(nodeId, node)\n                    }\n                }\n\n                return attr\n            })\n        }\n\n        // Check if every part of the mutation is empty in which case there is nothing to do\n        const mutationCount = this.numberOfChanges(data)\n\n        if (mutationCount === 0 && initialMutationCount !== mutationCount) {\n            // If we have modified the mutation count and the remaining count is 0, then we don't need the event.\n            return\n        }\n        return event\n    }\n}\n", "var EventType = /* @__PURE__ */ ((EventType2) => {\n  EventType2[EventType2[\"DomContentLoaded\"] = 0] = \"DomContentLoaded\";\n  EventType2[EventType2[\"Load\"] = 1] = \"Load\";\n  EventType2[EventType2[\"FullSnapshot\"] = 2] = \"FullSnapshot\";\n  EventType2[EventType2[\"IncrementalSnapshot\"] = 3] = \"IncrementalSnapshot\";\n  EventType2[EventType2[\"Meta\"] = 4] = \"Meta\";\n  EventType2[EventType2[\"Custom\"] = 5] = \"Custom\";\n  EventType2[EventType2[\"Plugin\"] = 6] = \"Plugin\";\n  return EventType2;\n})(EventType || {});\nvar IncrementalSource = /* @__PURE__ */ ((IncrementalSource2) => {\n  IncrementalSource2[IncrementalSource2[\"Mutation\"] = 0] = \"Mutation\";\n  IncrementalSource2[IncrementalSource2[\"MouseMove\"] = 1] = \"MouseMove\";\n  IncrementalSource2[IncrementalSource2[\"MouseInteraction\"] = 2] = \"MouseInteraction\";\n  IncrementalSource2[IncrementalSource2[\"Scroll\"] = 3] = \"Scroll\";\n  IncrementalSource2[IncrementalSource2[\"ViewportResize\"] = 4] = \"ViewportResize\";\n  IncrementalSource2[IncrementalSource2[\"Input\"] = 5] = \"Input\";\n  IncrementalSource2[IncrementalSource2[\"TouchMove\"] = 6] = \"TouchMove\";\n  IncrementalSource2[IncrementalSource2[\"MediaInteraction\"] = 7] = \"MediaInteraction\";\n  IncrementalSource2[IncrementalSource2[\"StyleSheetRule\"] = 8] = \"StyleSheetRule\";\n  IncrementalSource2[IncrementalSource2[\"CanvasMutation\"] = 9] = \"CanvasMutation\";\n  IncrementalSource2[IncrementalSource2[\"Font\"] = 10] = \"Font\";\n  IncrementalSource2[IncrementalSource2[\"Log\"] = 11] = \"Log\";\n  IncrementalSource2[IncrementalSource2[\"Drag\"] = 12] = \"Drag\";\n  IncrementalSource2[IncrementalSource2[\"StyleDeclaration\"] = 13] = \"StyleDeclaration\";\n  IncrementalSource2[IncrementalSource2[\"Selection\"] = 14] = \"Selection\";\n  IncrementalSource2[IncrementalSource2[\"AdoptedStyleSheet\"] = 15] = \"AdoptedStyleSheet\";\n  return IncrementalSource2;\n})(IncrementalSource || {});\nvar MouseInteractions = /* @__PURE__ */ ((MouseInteractions2) => {\n  MouseInteractions2[MouseInteractions2[\"MouseUp\"] = 0] = \"MouseUp\";\n  MouseInteractions2[MouseInteractions2[\"MouseDown\"] = 1] = \"MouseDown\";\n  MouseInteractions2[MouseInteractions2[\"Click\"] = 2] = \"Click\";\n  MouseInteractions2[MouseInteractions2[\"ContextMenu\"] = 3] = \"ContextMenu\";\n  MouseInteractions2[MouseInteractions2[\"DblClick\"] = 4] = \"DblClick\";\n  MouseInteractions2[MouseInteractions2[\"Focus\"] = 5] = \"Focus\";\n  MouseInteractions2[MouseInteractions2[\"Blur\"] = 6] = \"Blur\";\n  MouseInteractions2[MouseInteractions2[\"TouchStart\"] = 7] = \"TouchStart\";\n  MouseInteractions2[MouseInteractions2[\"TouchMove_Departed\"] = 8] = \"TouchMove_Departed\";\n  MouseInteractions2[MouseInteractions2[\"TouchEnd\"] = 9] = \"TouchEnd\";\n  MouseInteractions2[MouseInteractions2[\"TouchCancel\"] = 10] = \"TouchCancel\";\n  return MouseInteractions2;\n})(MouseInteractions || {});\nvar PointerTypes = /* @__PURE__ */ ((PointerTypes2) => {\n  PointerTypes2[PointerTypes2[\"Mouse\"] = 0] = \"Mouse\";\n  PointerTypes2[PointerTypes2[\"Pen\"] = 1] = \"Pen\";\n  PointerTypes2[PointerTypes2[\"Touch\"] = 2] = \"Touch\";\n  return PointerTypes2;\n})(PointerTypes || {});\nvar CanvasContext = /* @__PURE__ */ ((CanvasContext2) => {\n  CanvasContext2[CanvasContext2[\"2D\"] = 0] = \"2D\";\n  CanvasContext2[CanvasContext2[\"WebGL\"] = 1] = \"WebGL\";\n  CanvasContext2[CanvasContext2[\"WebGL2\"] = 2] = \"WebGL2\";\n  return CanvasContext2;\n})(CanvasContext || {});\nvar MediaInteractions = /* @__PURE__ */ ((MediaInteractions2) => {\n  MediaInteractions2[MediaInteractions2[\"Play\"] = 0] = \"Play\";\n  MediaInteractions2[MediaInteractions2[\"Pause\"] = 1] = \"Pause\";\n  MediaInteractions2[MediaInteractions2[\"Seeked\"] = 2] = \"Seeked\";\n  MediaInteractions2[MediaInteractions2[\"VolumeChange\"] = 3] = \"VolumeChange\";\n  MediaInteractions2[MediaInteractions2[\"RateChange\"] = 4] = \"RateChange\";\n  return MediaInteractions2;\n})(MediaInteractions || {});\nvar ReplayerEvents = /* @__PURE__ */ ((ReplayerEvents2) => {\n  ReplayerEvents2[\"Start\"] = \"start\";\n  ReplayerEvents2[\"Pause\"] = \"pause\";\n  ReplayerEvents2[\"Resume\"] = \"resume\";\n  ReplayerEvents2[\"Resize\"] = \"resize\";\n  ReplayerEvents2[\"Finish\"] = \"finish\";\n  ReplayerEvents2[\"FullsnapshotRebuilded\"] = \"fullsnapshot-rebuilded\";\n  ReplayerEvents2[\"LoadStylesheetStart\"] = \"load-stylesheet-start\";\n  ReplayerEvents2[\"LoadStylesheetEnd\"] = \"load-stylesheet-end\";\n  ReplayerEvents2[\"SkipStart\"] = \"skip-start\";\n  ReplayerEvents2[\"SkipEnd\"] = \"skip-end\";\n  ReplayerEvents2[\"MouseInteraction\"] = \"mouse-interaction\";\n  ReplayerEvents2[\"EventCast\"] = \"event-cast\";\n  ReplayerEvents2[\"CustomEvent\"] = \"custom-event\";\n  ReplayerEvents2[\"Flush\"] = \"flush\";\n  ReplayerEvents2[\"StateChange\"] = \"state-change\";\n  ReplayerEvents2[\"PlayBack\"] = \"play-back\";\n  ReplayerEvents2[\"Destroy\"] = \"destroy\";\n  return ReplayerEvents2;\n})(ReplayerEvents || {});\nexport {\n  CanvasContext,\n  EventType,\n  IncrementalSource,\n  MediaInteractions,\n  MouseInteractions,\n  PointerTypes,\n  ReplayerEvents\n};\n//# sourceMappingURL=types.js.map\n", "import { CapturedNetworkRequest, NetworkRecordOptions, PostHogConfig, Body } from '../../types'\nimport { _isFunction } from '../../utils/type-utils'\nimport { convertToURL } from '../../utils/request-utils'\nimport { logger } from '../../utils/logger'\n\nexport const defaultNetworkOptions: NetworkRecordOptions = {\n    initiatorTypes: [\n        'audio',\n        'beacon',\n        'body',\n        'css',\n        'early-hint',\n        'embed',\n        'fetch',\n        'frame',\n        'iframe',\n        'icon',\n        'image',\n        'img',\n        'input',\n        'link',\n        'navigation',\n        'object',\n        'ping',\n        'script',\n        'track',\n        'video',\n        'xmlhttprequest',\n    ],\n    maskRequestFn: (data: CapturedNetworkRequest) => data,\n    recordHeaders: false,\n    recordBody: false,\n    recordInitialRequests: false,\n    recordPerformance: false,\n    performanceEntryTypeToObserve: [\n        // 'event', // This is too noisy as it covers all browser events\n        'first-input',\n        // 'mark', // Mark is used too liberally. We would need to filter for specific marks\n        // 'measure', // Measure is used too liberally. We would need to filter for specific measures\n        'navigation',\n        'paint',\n        'resource',\n    ],\n    payloadSizeLimitBytes: 1000000,\n}\n\nconst HEADER_DENYLIST = [\n    'authorization',\n    'x-forwarded-for',\n    'authorization',\n    'cookie',\n    'set-cookie',\n    'x-api-key',\n    'x-real-ip',\n    'remote-addr',\n    'forwarded',\n    'proxy-authorization',\n    'x-csrf-token',\n    'x-csrftoken',\n    'x-xsrf-token',\n]\n\n// we always remove headers on the deny list because we never want to capture this sensitive data\nconst removeAuthorizationHeader = (data: CapturedNetworkRequest): CapturedNetworkRequest => {\n    Object.keys(data.requestHeaders ?? {}).forEach((header) => {\n        if (HEADER_DENYLIST.includes(header.toLowerCase())) delete data.requestHeaders?.[header]\n    })\n    return data\n}\n\nconst POSTHOG_PATHS_TO_IGNORE = ['/s/', '/e/', '/i/vo/e/']\n// want to ignore posthog paths when capturing requests, or we can get trapped in a loop\n// because calls to PostHog would be reported using a call to PostHog which would be reported....\nconst ignorePostHogPaths = (data: CapturedNetworkRequest): CapturedNetworkRequest | undefined => {\n    const url = convertToURL(data.name)\n    if (url && url.pathname && POSTHOG_PATHS_TO_IGNORE.includes(url.pathname)) {\n        return undefined\n    }\n    return data\n}\n\nfunction redactPayload(\n    payload: Body,\n    headers: Record<string, any> | undefined,\n    limit: number,\n    description: string\n): Body {\n    const requestContentLength = headers?.['content-length']\n    // in the interests of bundle size and the complexity of estimating payload size\n    // we only check the content-length header if it's present\n    // this might mean we can't always limit the payload, but that's better than\n    // having lots of code shipped to every browser that will rarely run\n    if (requestContentLength && parseInt(requestContentLength) > limit) {\n        return `${description} body too large to record`\n    }\n    return payload\n}\n\n// people can have arbitrarily large payloads on their site, but we don't want to ingest them\nconst limitPayloadSize = (\n    options: NetworkRecordOptions\n): ((data: CapturedNetworkRequest | undefined) => CapturedNetworkRequest | undefined) => {\n    // the smallest of 1MB or the specified limit if there is one\n    const limit = Math.min(1000000, options.payloadSizeLimitBytes ?? 1000000)\n\n    return (data) => {\n        if (data?.requestBody) {\n            data.requestBody = redactPayload(data.requestBody, data.requestHeaders, limit, 'Request')\n        }\n\n        if (data?.responseBody) {\n            data.responseBody = redactPayload(data.responseBody, data.responseHeaders, limit, 'Response')\n        }\n\n        return data\n    }\n}\n\n/**\n *  whether a maskRequestFn is provided or not,\n *  we ensure that we remove the denied header from requests\n *  we _never_ want to record that header by accident\n *  if someone complains then we'll add an opt-in to let them override it\n */\nexport const buildNetworkRequestOptions = (\n    instanceConfig: PostHogConfig,\n    remoteNetworkOptions: Pick<NetworkRecordOptions, 'recordHeaders' | 'recordBody' | 'recordPerformance'>\n): NetworkRecordOptions => {\n    const config = instanceConfig.session_recording as NetworkRecordOptions\n    // client can always disable despite remote options\n    const canRecordHeaders = config.recordHeaders === false ? false : remoteNetworkOptions.recordHeaders\n    const canRecordBody = config.recordBody === false ? false : remoteNetworkOptions.recordBody\n    const canRecordPerformance = config.recordPerformance === false ? false : remoteNetworkOptions.recordPerformance\n\n    const payloadLimiter = limitPayloadSize(config)\n\n    const enforcedCleaningFn: NetworkRecordOptions['maskRequestFn'] = (d: CapturedNetworkRequest) =>\n        payloadLimiter(ignorePostHogPaths(removeAuthorizationHeader(d)))\n\n    const hasDeprecatedMaskFunction = _isFunction(instanceConfig.session_recording.maskNetworkRequestFn)\n\n    if (hasDeprecatedMaskFunction && _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)) {\n        logger.warn(\n            'Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored.'\n        )\n    }\n\n    if (hasDeprecatedMaskFunction) {\n        instanceConfig.session_recording.maskCapturedNetworkRequestFn = (data: CapturedNetworkRequest) => {\n            const cleanedURL = instanceConfig.session_recording.maskNetworkRequestFn!({ url: data.name })\n            return {\n                ...data,\n                name: cleanedURL?.url,\n            } as CapturedNetworkRequest\n        }\n    }\n\n    config.maskRequestFn = _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)\n        ? (data) => {\n              const cleanedRequest = enforcedCleaningFn(data)\n              return cleanedRequest\n                  ? instanceConfig.session_recording.maskCapturedNetworkRequestFn?.(cleanedRequest) ?? undefined\n                  : undefined\n          }\n        : undefined\n\n    if (!config.maskRequestFn) {\n        config.maskRequestFn = enforcedCleaningFn\n    }\n\n    return {\n        ...defaultNetworkOptions,\n        ...config,\n        recordHeaders: canRecordHeaders,\n        recordBody: canRecordBody,\n        recordPerformance: canRecordPerformance,\n        recordInitialRequests: canRecordPerformance,\n    }\n}\n", "import {\n    CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_IS_SAMPLED,\n    SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE,\n    SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE,\n} from '../../constants'\nimport {\n    FULL_SNAPSHOT_EVENT_TYPE,\n    INCREMENTAL_SNAPSHOT_EVENT_TYPE,\n    META_EVENT_TYPE,\n    MutationRateLimiter,\n    recordOptions,\n    rrwebRecord,\n    truncateLargeConsoleLogs,\n} from './sessionrecording-utils'\nimport { PostHog } from '../../posthog-core'\nimport { DecideResponse, NetworkRecordOptions, NetworkRequest, Properties } from '../../types'\nimport { EventType, type eventWithTime, type listenerHandler, RecordPlugin } from '@rrweb/types'\nimport Config from '../../config'\nimport { _timestamp, loadScript } from '../../utils'\n\nimport { _isBoolean, _isFunction, _isNull, _isNumber, _isObject, _isString, _isUndefined } from '../../utils/type-utils'\nimport { logger } from '../../utils/logger'\nimport { assignableWindow, window } from '../../utils/globals'\nimport { buildNetworkRequestOptions } from './config'\nimport { isLocalhost } from '../../utils/request-utils'\n\nconst BASE_ENDPOINT = '/s/'\n\nexport const RECORDING_IDLE_ACTIVITY_TIMEOUT_MS = 5 * 60 * 1000 // 5 minutes\nexport const RECORDING_MAX_EVENT_SIZE = 1024 * 1024 * 0.9 // ~1mb (with some wiggle room)\nexport const RECORDING_BUFFER_TIMEOUT = 2000 // 2 seconds\nexport const SESSION_RECORDING_BATCH_KEY = 'recordings'\n\n// NOTE: Importing this type is problematic as we can't safely bundle it to a TS definition so, instead we redefine.\n// import type { record } from 'rrweb2/typings'\n// import type { recordOptions } from 'rrweb/typings/types'\n\n// Copied from rrweb typings to avoid import\nenum IncrementalSource {\n    Mutation = 0,\n    MouseMove = 1,\n    MouseInteraction = 2,\n    Scroll = 3,\n    ViewportResize = 4,\n    Input = 5,\n    TouchMove = 6,\n    MediaInteraction = 7,\n    StyleSheetRule = 8,\n    CanvasMutation = 9,\n    Font = 10,\n    Log = 11,\n    Drag = 12,\n    StyleDeclaration = 13,\n    Selection = 14,\n    AdoptedStyleSheet = 15,\n}\n\nconst ACTIVE_SOURCES = [\n    IncrementalSource.MouseMove,\n    IncrementalSource.MouseInteraction,\n    IncrementalSource.Scroll,\n    IncrementalSource.ViewportResize,\n    IncrementalSource.Input,\n    IncrementalSource.TouchMove,\n    IncrementalSource.MediaInteraction,\n    IncrementalSource.Drag,\n]\n\n/**\n * Session recording starts in buffering mode while waiting for decide response\n * Once the response is received it might be disabled, active or sampled\n * When sampled that means a sample rate is set and the last time the session id was rotated\n * the sample rate determined this session should be sent to the server.\n */\ntype SessionRecordingStatus = 'disabled' | 'sampled' | 'active' | 'buffering'\n\ninterface SnapshotBuffer {\n    size: number\n    data: any[]\n    sessionId: string | null\n    windowId: string | null\n}\n\nexport class SessionRecording {\n    private instance: PostHog\n    private _endpoint: string\n    private flushBufferTimer?: any\n    private buffer?: SnapshotBuffer\n    private mutationRateLimiter?: MutationRateLimiter\n    private _captureStarted: boolean\n    private stopRrweb: listenerHandler | undefined\n    private receivedDecide: boolean\n    private rrwebRecord: rrwebRecord | undefined\n    private isIdle = false\n\n    private _linkedFlagSeen: boolean = false\n    private _lastActivityTimestamp: number = Date.now()\n    private windowId: string | null = null\n    private sessionId: string | null = null\n    private _linkedFlag: string | null = null\n    private _sampleRate: number | null = null\n    private _minimumDuration: number | null = null\n\n    // Util to help developers working on this feature manually override\n    _forceAllowLocalhostNetworkCapture = false\n\n    public get started(): boolean {\n        // TODO could we use status instead of _captureStarted?\n        return this._captureStarted\n    }\n\n    private get sessionManager() {\n        if (!this.instance.sessionManager) {\n            logger.error('Session recording started without valid sessionManager')\n            throw new Error('Session recording started without valid sessionManager. This is a bug.')\n        }\n\n        return this.instance.sessionManager\n    }\n\n    private get isSampled(): boolean | null {\n        if (_isNumber(this._sampleRate)) {\n            return this.instance.get_property(SESSION_RECORDING_IS_SAMPLED)\n        } else {\n            return null\n        }\n    }\n\n    private get sessionDuration(): number | null {\n        const mostRecentSnapshot = this.buffer?.data[this.buffer?.data.length - 1]\n        const { sessionStartTimestamp } = this.sessionManager.checkAndGetSessionAndWindowId(true)\n        return mostRecentSnapshot ? mostRecentSnapshot.timestamp - sessionStartTimestamp : null\n    }\n\n    private get isRecordingEnabled() {\n        const enabled_server_side = !!this.instance.get_property(SESSION_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = !this.instance.config.disable_session_recording\n        return window && enabled_server_side && enabled_client_side\n    }\n\n    private get isConsoleLogCaptureEnabled() {\n        const enabled_server_side = !!this.instance.get_property(CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = this.instance.config.enable_recording_console_log\n        return enabled_client_side ?? enabled_server_side\n    }\n\n    private get recordingVersion() {\n        const recordingVersion_server_side = this.instance.get_property(SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE)\n        const recordingVersion_client_side = this.instance.config.session_recording?.recorderVersion\n        return recordingVersion_client_side || recordingVersion_server_side || 'v1'\n    }\n\n    // network payload capture config has three parts\n    // each can be configured server side or client side\n    private get networkPayloadCapture():\n        | Pick<NetworkRecordOptions, 'recordHeaders' | 'recordBody' | 'recordPerformance'>\n        | undefined {\n        const networkPayloadCapture_server_side = this.instance.get_property(SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE)\n        const networkPayloadCapture_client_side = {\n            recordHeaders: this.instance.config.session_recording?.recordHeaders,\n            recordBody: this.instance.config.session_recording?.recordBody,\n        }\n        const headersEnabled =\n            networkPayloadCapture_client_side?.recordHeaders || networkPayloadCapture_server_side?.recordHeaders\n        const bodyEnabled =\n            networkPayloadCapture_client_side?.recordBody || networkPayloadCapture_server_side?.recordBody\n        const performanceEnabled =\n            this.instance.config.capture_performance || networkPayloadCapture_server_side?.capturePerformance\n\n        return headersEnabled || bodyEnabled || performanceEnabled\n            ? { recordHeaders: headersEnabled, recordBody: bodyEnabled, recordPerformance: performanceEnabled }\n            : undefined\n    }\n\n    /**\n     * defaults to buffering mode until a decide response is received\n     * once a decide response is received status can be disabled, active or sampled\n     */\n    private get status(): SessionRecordingStatus {\n        if (!this.receivedDecide) {\n            return 'buffering'\n        }\n\n        if (!this.isRecordingEnabled) {\n            return 'disabled'\n        }\n\n        if (_isString(this._linkedFlag) && !this._linkedFlagSeen) {\n            return 'buffering'\n        }\n\n        if (_isBoolean(this.isSampled)) {\n            return this.isSampled ? 'sampled' : 'disabled'\n        } else {\n            return 'active'\n        }\n    }\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this._captureStarted = false\n        this._endpoint = BASE_ENDPOINT\n        this.stopRrweb = undefined\n        this.receivedDecide = false\n\n        window?.addEventListener('beforeunload', () => {\n            this._flushBuffer()\n        })\n\n        if (!this.instance.sessionManager) {\n            logger.error('Session recording started without valid sessionManager')\n            throw new Error('Session recording started without valid sessionManager. This is a bug.')\n        }\n\n        this.buffer = this.clearBuffer()\n    }\n\n    startRecordingIfEnabled() {\n        if (this.isRecordingEnabled) {\n            this.startCaptureAndTrySendingQueuedSnapshots()\n        } else {\n            this.stopRecording()\n            this.clearBuffer()\n        }\n    }\n\n    stopRecording() {\n        if (this._captureStarted && this.stopRrweb) {\n            this.stopRrweb()\n            this.stopRrweb = undefined\n            this._captureStarted = false\n        }\n    }\n\n    private makeSamplingDecision(sessionId: string): void {\n        const sessionIdChanged = this.sessionId !== sessionId\n\n        if (!_isNumber(this._sampleRate)) {\n            this.instance.persistence?.register({\n                [SESSION_RECORDING_IS_SAMPLED]: null,\n            })\n            return\n        }\n\n        const storedIsSampled = this.isSampled\n\n        /**\n         * if we get this far then we should make a sampling decision.\n         * When the session id changes or there is no stored sampling decision for this session id\n         * then we should make a new decision.\n         *\n         * Otherwise, we should use the stored decision.\n         */\n        let shouldSample: boolean\n        if (sessionIdChanged || !_isBoolean(storedIsSampled)) {\n            const randomNumber = Math.random()\n            shouldSample = randomNumber < this._sampleRate\n        } else {\n            shouldSample = storedIsSampled\n        }\n\n        if (!shouldSample) {\n            logger.warn(\n                `[SessionSampling] Sample rate (${this._sampleRate}) has determined that this sessionId (${sessionId}) will not be sent to the server.`\n            )\n        }\n\n        this.instance.persistence?.register({\n            [SESSION_RECORDING_IS_SAMPLED]: shouldSample,\n        })\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        if (this.instance.persistence) {\n            this.instance.persistence.register({\n                [SESSION_RECORDING_ENABLED_SERVER_SIDE]: !!response['sessionRecording'],\n                [CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE]: response.sessionRecording?.consoleLogRecordingEnabled,\n                [SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE]: response.sessionRecording?.recorderVersion,\n                [SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE]: {\n                    capturePerformance: response.capturePerformance,\n                    ...response.sessionRecording?.networkPayloadCapture,\n                },\n            })\n        }\n\n        const receivedSampleRate = response.sessionRecording?.sampleRate\n        this._sampleRate =\n            _isUndefined(receivedSampleRate) || _isNull(receivedSampleRate) ? null : parseFloat(receivedSampleRate)\n\n        const receivedMinimumDuration = response.sessionRecording?.minimumDurationMilliseconds\n        this._minimumDuration = _isUndefined(receivedMinimumDuration) ? null : receivedMinimumDuration\n\n        this._linkedFlag = response.sessionRecording?.linkedFlag || null\n\n        if (response.sessionRecording?.endpoint) {\n            this._endpoint = response.sessionRecording?.endpoint\n        }\n\n        if (_isNumber(this._sampleRate)) {\n            this.sessionManager.onSessionId((sessionId) => {\n                this.makeSamplingDecision(sessionId)\n            })\n        }\n\n        if (_isString(this._linkedFlag)) {\n            const linkedFlag = this._linkedFlag\n            this.instance.onFeatureFlags((flags) => {\n                this._linkedFlagSeen = flags.includes(linkedFlag)\n            })\n        }\n\n        this.receivedDecide = true\n        this.startRecordingIfEnabled()\n    }\n\n    log(message: string, level: 'log' | 'warn' | 'error' = 'log') {\n        this.instance.sessionRecording?.onRRwebEmit({\n            type: 6,\n            data: {\n                plugin: 'rrweb/console@1',\n                payload: {\n                    level,\n                    trace: [],\n                    // Even though it is a string we stringify it as that's what rrweb expects\n                    payload: [JSON.stringify(message)],\n                },\n            },\n            timestamp: _timestamp(),\n        })\n    }\n\n    private startCaptureAndTrySendingQueuedSnapshots() {\n        this._startCapture()\n    }\n\n    private _startCapture() {\n        if (_isUndefined(Object.assign)) {\n            // According to the rrweb docs, rrweb is not supported on IE11 and below:\n            // \"rrweb does not support IE11 and below because it uses the MutationObserver API which was supported by these browsers.\"\n            // https://github.com/rrweb-io/rrweb/blob/master/guide.md#compatibility-note\n            //\n            // However, MutationObserver does exist on IE11, it just doesn't work well and does not detect all changes.\n            // Instead, when we load \"recorder.js\", the first JS error is about \"Object.assign\" being undefined.\n            // Thus instead of MutationObserver, we look for this function and block recording if it's undefined.\n            return\n        }\n\n        // We do not switch recorder versions midway through a recording.\n        if (this._captureStarted || this.instance.config.disable_session_recording) {\n            return\n        }\n\n        this._captureStarted = true\n        // We want to ensure the sessionManager is reset if necessary on load of the recorder\n        this.sessionManager.checkAndGetSessionAndWindowId()\n\n        const recorderJS = this.recordingVersion === 'v2' ? 'recorder-v2.js' : 'recorder.js'\n\n        // If recorder.js is already loaded (if array.full.js snippet is used or posthog-js/dist/recorder is\n        // imported) or matches the requested recorder version, don't load script. Otherwise, remotely import\n        // recorder.js from cdn since it hasn't been loaded.\n        if (this.instance.__loaded_recorder_version !== this.recordingVersion) {\n            loadScript(this.instance.config.api_host + `/static/${recorderJS}?v=${Config.LIB_VERSION}`, (err) => {\n                if (err) {\n                    return logger.error(`Could not load ${recorderJS}`, err)\n                }\n\n                this._onScriptLoaded()\n            })\n        } else {\n            this._onScriptLoaded()\n        }\n    }\n\n    private _isInteractiveEvent(event: eventWithTime) {\n        return event.type === INCREMENTAL_SNAPSHOT_EVENT_TYPE && ACTIVE_SOURCES.indexOf(event.data?.source) !== -1\n    }\n\n    private _updateWindowAndSessionIds(event: eventWithTime) {\n        // Some recording events are triggered by non-user events (e.g. \"X minutes ago\" text updating on the screen).\n        // We don't want to extend the session or trigger a new session in these cases. These events are designated by event\n        // type -> incremental update, and source -> mutation.\n\n        const isUserInteraction = this._isInteractiveEvent(event)\n\n        if (!isUserInteraction && !this.isIdle) {\n            // We check if the lastActivityTimestamp is old enough to go idle\n            if (event.timestamp - this._lastActivityTimestamp > RECORDING_IDLE_ACTIVITY_TIMEOUT_MS) {\n                this.isIdle = true\n                this._tryAddCustomEvent('sessionIdle', {\n                    reason: 'user inactivity',\n                    timeSinceLastActive: event.timestamp - this._lastActivityTimestamp,\n                    threshold: RECORDING_IDLE_ACTIVITY_TIMEOUT_MS,\n                })\n            }\n        }\n\n        if (isUserInteraction) {\n            this._lastActivityTimestamp = event.timestamp\n            if (this.isIdle) {\n                // Remove the idle state if set and trigger a full snapshot as we will have ignored previous mutations\n                this.isIdle = false\n                this._tryAddCustomEvent('sessionNoLongerIdle', {\n                    reason: 'user activity',\n                    type: event.type,\n                })\n                this._tryTakeFullSnapshot()\n            }\n        }\n\n        if (this.isIdle) {\n            return\n        }\n\n        // We only want to extend the session if it is an interactive event.\n        const { windowId, sessionId } = this.sessionManager.checkAndGetSessionAndWindowId(\n            !isUserInteraction,\n            event.timestamp\n        )\n\n        const sessionIdChanged = this.sessionId !== sessionId\n        const windowIdChanged = this.windowId !== windowId\n\n        if (\n            [FULL_SNAPSHOT_EVENT_TYPE, META_EVENT_TYPE].indexOf(event.type) === -1 &&\n            (windowIdChanged || sessionIdChanged)\n        ) {\n            this._tryTakeFullSnapshot()\n        }\n\n        this.windowId = windowId\n        this.sessionId = sessionId\n    }\n\n    private _tryRRwebMethod(rrwebMethod: () => void): boolean {\n        if (!this._captureStarted) {\n            return false\n        }\n        try {\n            rrwebMethod()\n            return true\n        } catch (e) {\n            // Sometimes a race can occur where the recorder is not fully started yet\n            logger.error('[Session-Recording] using rrweb when not started.', e)\n            return false\n        }\n    }\n\n    private _tryAddCustomEvent(tag: string, payload: any): boolean {\n        return this._tryRRwebMethod(() => this.rrwebRecord?.addCustomEvent(tag, payload))\n    }\n\n    private _tryTakeFullSnapshot(): boolean {\n        return this._tryRRwebMethod(() => this.rrwebRecord?.takeFullSnapshot())\n    }\n\n    private _onScriptLoaded() {\n        // rrweb config info: https://github.com/rrweb-io/rrweb/blob/7d5d0033258d6c29599fb08412202d9a2c7b9413/src/record/index.ts#L28\n        const sessionRecordingOptions: recordOptions<eventWithTime> = {\n            // select set of rrweb config options we expose to our users\n            // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n            blockClass: 'ph-no-capture',\n            blockSelector: undefined,\n            ignoreClass: 'ph-ignore-input',\n            maskTextClass: 'ph-mask',\n            maskTextSelector: undefined,\n            maskTextFn: undefined,\n            maskAllInputs: true,\n            maskInputOptions: {},\n            maskInputFn: undefined,\n            slimDOMOptions: {},\n            collectFonts: false,\n            inlineStylesheet: true,\n            recordCrossOriginIframes: false,\n        }\n        // We switched from loading all of rrweb to just the record part, but\n        // keep backwards compatibility if someone hasn't upgraded PostHog\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        this.rrwebRecord = window.rrweb ? window.rrweb.record : window.rrwebRecord\n\n        // only allows user to set our allow-listed options\n        const userSessionRecordingOptions = this.instance.config.session_recording\n        for (const [key, value] of Object.entries(userSessionRecordingOptions || {})) {\n            if (key in sessionRecordingOptions) {\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                sessionRecordingOptions[key] = value\n            }\n        }\n\n        if (!this.rrwebRecord) {\n            logger.error(\n                'onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.'\n            )\n            return\n        }\n\n        this.mutationRateLimiter =\n            this.mutationRateLimiter ??\n            new MutationRateLimiter(this.rrwebRecord, {\n                onBlockedNode: (id, node) => {\n                    const message = `Too many mutations on node '${id}'. Rate limiting. This could be due to SVG animations or something similar`\n                    logger.info(message, {\n                        node: node,\n                    })\n\n                    this.log('[PostHog Recorder] ' + message, 'warn')\n                },\n            })\n\n        this.stopRrweb = this.rrwebRecord({\n            emit: (event) => {\n                this.onRRwebEmit(event)\n            },\n            plugins: this._gatherRRWebPlugins(),\n            ...sessionRecordingOptions,\n        })\n\n        // :TRICKY: rrweb does not capture navigation within SPA-s, so hook into our $pageview events to get access to all events.\n        //   Dropping the initial event is fine (it's always captured by rrweb).\n        this.instance._addCaptureHook((eventName) => {\n            // If anything could go wrong here it has the potential to block the main loop,\n            // so we catch all errors.\n            try {\n                if (eventName === '$pageview') {\n                    const href = window ? this._maskUrl(window.location.href) : ''\n                    if (!href) {\n                        return\n                    }\n                    this._tryAddCustomEvent('$pageview', { href })\n                }\n            } catch (e) {\n                logger.error('Could not add $pageview to rrweb session', e)\n            }\n        })\n\n        // We reset the last activity timestamp, resetting the idle timer\n        this._lastActivityTimestamp = Date.now()\n        this.isIdle = false\n    }\n\n    private _gatherRRWebPlugins() {\n        const plugins: RecordPlugin<unknown>[] = []\n\n        if (assignableWindow.rrwebConsoleRecord && this.isConsoleLogCaptureEnabled) {\n            plugins.push(assignableWindow.rrwebConsoleRecord.getRecordConsolePlugin())\n        }\n\n        if (this.networkPayloadCapture && _isFunction(assignableWindow.getRecordNetworkPlugin)) {\n            const canRecordNetwork = !isLocalhost() || this._forceAllowLocalhostNetworkCapture\n\n            if (canRecordNetwork) {\n                plugins.push(\n                    assignableWindow.getRecordNetworkPlugin(\n                        buildNetworkRequestOptions(this.instance.config, this.networkPayloadCapture)\n                    )\n                )\n            } else {\n                logger.info('[SessionReplay-NetworkCapture] not started because we are on localhost.')\n            }\n        }\n\n        return plugins\n    }\n\n    onRRwebEmit(rawEvent: eventWithTime) {\n        if (!rawEvent || !_isObject(rawEvent)) {\n            return\n        }\n\n        if (rawEvent.type === EventType.Meta) {\n            const href = this._maskUrl(rawEvent.data.href)\n            if (!href) {\n                return\n            }\n            rawEvent.data.href = href\n        }\n\n        const throttledEvent = this.mutationRateLimiter\n            ? this.mutationRateLimiter.throttleMutations(rawEvent)\n            : rawEvent\n\n        if (!throttledEvent) {\n            return\n        }\n\n        // TODO: Re-add ensureMaxMessageSize once we are confident in it\n        const event = truncateLargeConsoleLogs(throttledEvent)\n        const size = JSON.stringify(event).length\n\n        this._updateWindowAndSessionIds(event)\n\n        if (this.isIdle) {\n            // When in an idle state we keep recording, but don't capture the events\n            return\n        }\n\n        const properties = {\n            $snapshot_bytes: size,\n            $snapshot_data: event,\n            $session_id: this.sessionId,\n            $window_id: this.windowId,\n        }\n\n        if (this.status !== 'disabled') {\n            this._captureSnapshotBuffered(properties)\n        } else {\n            this.clearBuffer()\n        }\n    }\n\n    private _maskUrl(url: string): string | undefined {\n        const userSessionRecordingOptions = this.instance.config.session_recording\n\n        if (userSessionRecordingOptions.maskNetworkRequestFn) {\n            let networkRequest: NetworkRequest | null | undefined = {\n                url,\n            }\n\n            // TODO we should deprecate this and use the same function for this masking and the rrweb/network plugin\n            // TODO or deprecate this and provide a new clearer name so this would be `maskURLPerformanceFn` or similar\n            networkRequest = userSessionRecordingOptions.maskNetworkRequestFn(networkRequest)\n\n            return networkRequest?.url\n        }\n\n        return url\n    }\n\n    private clearBuffer(): SnapshotBuffer {\n        this.buffer = undefined\n\n        return {\n            size: 0,\n            data: [],\n            sessionId: this.sessionId,\n            windowId: this.windowId,\n        }\n    }\n\n    // the intention is a buffer that (currently) is used only after a decide response enables session recording\n    // it is called ever X seconds using the flushBufferTimer so that we don't have to wait for the buffer to fill up\n    // when it is called on a timer it assumes that it can definitely flush\n    // it is flushed when the session id changes or the size of the buffered data gets too great (1mb by default)\n    // first change: if the recording is in buffering mode,\n    //  flush buffer simply resets the timer and returns the existing flush buffer\n    private _flushBuffer() {\n        if (this.flushBufferTimer) {\n            clearTimeout(this.flushBufferTimer)\n            this.flushBufferTimer = undefined\n        }\n\n        const minimumDuration = this._minimumDuration\n        const sessionDuration = this.sessionDuration\n        // if we have old data in the buffer but the session has rotated then the\n        // session duration might be negative, in that case we want to flush the buffer\n        const isPositiveSessionDuration = _isNumber(sessionDuration) && sessionDuration >= 0\n        const isBelowMinimumDuration =\n            _isNumber(minimumDuration) && isPositiveSessionDuration && sessionDuration < minimumDuration\n\n        if (this.status === 'buffering' || isBelowMinimumDuration) {\n            this.flushBufferTimer = setTimeout(() => {\n                this._flushBuffer()\n            }, RECORDING_BUFFER_TIMEOUT)\n            return this.buffer || this.clearBuffer()\n        }\n\n        if (this.buffer && this.buffer.data.length !== 0) {\n            this._captureSnapshot({\n                $snapshot_bytes: this.buffer.size,\n                $snapshot_data: this.buffer.data,\n                $session_id: this.buffer.sessionId,\n                $window_id: this.buffer.windowId,\n            })\n\n            return this.clearBuffer()\n        } else {\n            return this.buffer || this.clearBuffer()\n        }\n    }\n\n    private _captureSnapshotBuffered(properties: Properties) {\n        const additionalBytes = 2 + (this.buffer?.data.length || 0) // 2 bytes for the array brackets and 1 byte for each comma\n        if (\n            !this.buffer ||\n            this.buffer.size + properties.$snapshot_bytes + additionalBytes > RECORDING_MAX_EVENT_SIZE ||\n            (!!this.buffer.sessionId && this.buffer.sessionId !== this.sessionId)\n        ) {\n            this.buffer = this._flushBuffer()\n        }\n\n        if (_isNull(this.buffer.sessionId) && !_isNull(this.sessionId)) {\n            // session id starts null but has now been assigned, update the buffer\n            this.buffer.sessionId = this.sessionId\n            this.buffer.windowId = this.windowId\n        }\n\n        this.buffer.size += properties.$snapshot_bytes\n        this.buffer.data.push(properties.$snapshot_data)\n\n        if (!this.flushBufferTimer) {\n            this.flushBufferTimer = setTimeout(() => {\n                this._flushBuffer()\n            }, RECORDING_BUFFER_TIMEOUT)\n        }\n    }\n\n    private _captureSnapshot(properties: Properties) {\n        // :TRICKY: Make sure we batch these requests, use a custom endpoint and don't truncate the strings.\n        this.instance.capture('$snapshot', properties, {\n            transport: 'XHR',\n            method: 'POST',\n            endpoint: this._endpoint,\n            _noTruncate: true,\n            _batchKey: SESSION_RECORDING_BATCH_KEY,\n            _metrics: {\n                rrweb_full_snapshot: properties.$snapshot_data.type === FULL_SNAPSHOT_EVENT_TYPE,\n            },\n        })\n    }\n}\n", "import { autocapture } from './autocapture'\nimport { _base64Encode, loadScript } from './utils'\nimport { PostHog } from './posthog-core'\nimport { DecideResponse } from './types'\nimport { STORED_GROUP_PROPERTIES_KEY, STORED_PERSON_PROPERTIES_KEY } from './constants'\n\nimport { _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window, document, assignableWindow } from './utils/globals'\n\nexport class Decide {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        // don't need to wait for `decide` to return if flags were provided on initialisation\n        this.instance.decideEndpointWasHit = this.instance._hasBootstrappedFeatureFlags()\n    }\n\n    call(): void {\n        /*\n        Calls /decide endpoint to fetch options for autocapture, session recording, feature flags & compression.\n        */\n        const json_data = JSON.stringify({\n            token: this.instance.config.token,\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            person_properties: this.instance.get_property(STORED_PERSON_PROPERTIES_KEY),\n            group_properties: this.instance.get_property(STORED_GROUP_PROPERTIES_KEY),\n            disable_flags:\n                this.instance.config.advanced_disable_feature_flags ||\n                this.instance.config.advanced_disable_feature_flags_on_first_load ||\n                undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            `${this.instance.config.api_host}/decide/?v=3`,\n            { data: encoded_data, verbose: true },\n            { method: 'POST' },\n            (response) => this.parseDecideResponse(response as DecideResponse)\n        )\n    }\n\n    parseDecideResponse(response: DecideResponse): void {\n        this.instance.featureFlags.setReloadingPaused(false)\n        // :TRICKY: Reload - start another request if queued!\n        this.instance.featureFlags._startReloadTimer()\n\n        if (response?.status === 0) {\n            logger.error('Failed to fetch feature flags from PostHog.')\n            return\n        }\n        if (!(document && document.body)) {\n            logger.info('document not ready yet, trying again in 500 milliseconds...')\n            setTimeout(() => {\n                this.parseDecideResponse(response)\n            }, 500)\n            return\n        }\n\n        this.instance.toolbar.afterDecideResponse(response)\n        this.instance.sessionRecording?.afterDecideResponse(response)\n        autocapture.afterDecideResponse(response, this.instance)\n        this.instance._afterDecideResponse(response)\n\n        if (\n            !this.instance.config.advanced_disable_feature_flags_on_first_load &&\n            !this.instance.config.advanced_disable_feature_flags\n        ) {\n            this.instance.featureFlags.receivedFeatureFlags(response)\n        }\n\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        const surveysGenerator = window?.extendPostHogWithSurveys\n\n        if (response['surveys'] && !surveysGenerator) {\n            loadScript(this.instance.config.api_host + `/static/surveys.js`, (err) => {\n                if (err) {\n                    return logger.error(`Could not load surveys script`, err)\n                }\n\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                window.extendPostHogWithSurveys(this.instance)\n            })\n        }\n\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        const exceptionAutoCaptureAddedToWindow = window?.extendPostHogWithExceptionAutoCapture\n        if (\n            response['autocaptureExceptions'] &&\n            !!response['autocaptureExceptions'] &&\n            _isUndefined(exceptionAutoCaptureAddedToWindow)\n        ) {\n            loadScript(this.instance.config.api_host + `/static/exception-autocapture.js`, (err) => {\n                if (err) {\n                    return logger.error(`Could not load exception autocapture script`, err)\n                }\n\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                window.extendPostHogWithExceptionAutocapture(this.instance, response)\n            })\n        }\n\n        if (response['siteApps']) {\n            if (this.instance.config.opt_in_site_apps) {\n                const apiHost = this.instance.config.api_host\n                for (const { id, url } of response['siteApps']) {\n                    const scriptUrl = [\n                        apiHost,\n                        apiHost[apiHost.length - 1] === '/' && url[0] === '/' ? url.substring(1) : url,\n                    ].join('')\n\n                    assignableWindow[`__$$ph_site_app_${id}`] = this.instance\n\n                    loadScript(scriptUrl, (err) => {\n                        if (err) {\n                            logger.error(`Error while initializing PostHog app with config id ${id}`, err)\n                        }\n                    })\n                }\n            } else if (response['siteApps'].length > 0) {\n                logger.error('PostHog site apps are disabled. Enable the \"opt_in_site_apps\" config to proceed.')\n            }\n        }\n    }\n}\n", "export const POSTHOG_MANAGED_HOSTS = ['https://app.posthog.com', 'https://eu.posthog.com']\n", "import { _register_event, _try, loadScript } from '../utils'\nimport { PostHog } from '../posthog-core'\nimport { DecideResponse, ToolbarParams } from '../types'\nimport { POSTHOG_MANAGED_HOSTS } from './cloud'\nimport { _getHashParam } from '../utils/request-utils'\nimport { logger } from '../utils/logger'\nimport { window, document, assignableWindow } from '../utils/globals'\n\n// TRICKY: Many web frameworks will modify the route on load, potentially before posthog is initialized.\n// To get ahead of this we grab it as soon as the posthog-js is parsed\nconst STATE_FROM_WINDOW = window?.location\n    ? _getHashParam(window.location.hash, '__posthog') || _getHashParam(location.hash, 'state')\n    : null\n\nexport class Toolbar {\n    instance: PostHog\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        const toolbarParams: ToolbarParams =\n            response['toolbarParams'] ||\n            response['editorParams'] ||\n            (response['toolbarVersion'] ? { toolbarVersion: response['toolbarVersion'] } : {})\n        if (\n            response['isAuthenticated'] &&\n            toolbarParams['toolbarVersion'] &&\n            toolbarParams['toolbarVersion'].indexOf('toolbar') === 0\n        ) {\n            this.loadToolbar({\n                ...toolbarParams,\n            })\n        }\n    }\n\n    /**\n     * To load the toolbar, we need an access token and other state. That state comes from one of three places:\n     * 1. In the URL hash params\n     * 2. From session storage under the key `toolbarParams` if the toolbar was initialized on a previous page\n     */\n    maybeLoadToolbar(\n        location: Location | undefined = undefined,\n        localStorage: Storage | undefined = undefined,\n        history: History | undefined = undefined\n    ): boolean {\n        if (!window || !document) {\n            return false\n        }\n        location = location ?? window.location\n        history = history ?? window.history\n\n        try {\n            // Before running the code we check if we can access localStorage, if not we opt-out\n            if (!localStorage) {\n                try {\n                    window.localStorage.setItem('test', 'test')\n                    window.localStorage.removeItem('test')\n                } catch (error) {\n                    return false\n                }\n\n                // If localStorage was undefined, and localStorage is supported we set the default value\n                localStorage = window?.localStorage\n            }\n\n            /**\n             * Info about the state\n             * The state is a json object\n             * 1. (Legacy) The state can be `state={}` as a urlencoded object of info. In this case\n             * 2. The state should now be found in `__posthog={}` and can be base64 encoded or urlencoded.\n             * 3. Base64 encoding is preferred and will gradually be rolled out everywhere\n             */\n\n            const stateHash =\n                STATE_FROM_WINDOW || _getHashParam(location.hash, '__posthog') || _getHashParam(location.hash, 'state')\n\n            let toolbarParams: ToolbarParams\n            const state = stateHash\n                ? _try(() => JSON.parse(atob(decodeURIComponent(stateHash)))) ||\n                  _try(() => JSON.parse(decodeURIComponent(stateHash)))\n                : null\n\n            const parseFromUrl = state && state['action'] === 'ph_authorize'\n\n            if (parseFromUrl) {\n                // happens if they are initializing the toolbar using an old snippet\n                toolbarParams = state\n                toolbarParams.source = 'url'\n\n                if (toolbarParams && Object.keys(toolbarParams).length > 0) {\n                    if (state['desiredHash']) {\n                        // hash that was in the url before the redirect\n                        location.hash = state['desiredHash']\n                    } else if (history) {\n                        history.replaceState('', document.title, location.pathname + location.search) // completely remove hash\n                    } else {\n                        location.hash = '' // clear hash (but leaves # unfortunately)\n                    }\n                }\n            } else {\n                // get credentials from localStorage from a previous initialzation\n                toolbarParams = JSON.parse(localStorage.getItem('_postHogToolbarParams') || '{}')\n                toolbarParams.source = 'localstorage'\n\n                // delete \"add-action\" or other intent from toolbarParams, otherwise we'll have the same intent\n                // every time we open the page (e.g. you just visiting your own site an hour later)\n                delete toolbarParams.userIntent\n            }\n\n            if (toolbarParams['token'] && this.instance.config.token === toolbarParams['token']) {\n                this.loadToolbar(toolbarParams)\n                return true\n            } else {\n                return false\n            }\n        } catch (e) {\n            return false\n        }\n    }\n\n    loadToolbar(params?: ToolbarParams): boolean {\n        if (!window || assignableWindow['_postHogToolbarLoaded']) {\n            return false\n        }\n        // only load the toolbar once, even if there are multiple instances of PostHogLib\n        assignableWindow['_postHogToolbarLoaded'] = true\n\n        const host = this.instance.config.api_host\n        // toolbar.js is served from the PostHog CDN, this has a TTL of 24 hours.\n        // the toolbar asset includes a rotating \"token\" that is valid for 5 minutes.\n        const fiveMinutesInMillis = 5 * 60 * 1000\n        // this ensures that we bust the cache periodically\n        const timestampToNearestFiveMinutes = Math.floor(Date.now() / fiveMinutesInMillis) * fiveMinutesInMillis\n        const toolbarUrl = `${host}${host.endsWith('/') ? '' : '/'}static/toolbar.js?t=${timestampToNearestFiveMinutes}`\n        const disableToolbarMetrics =\n            !POSTHOG_MANAGED_HOSTS.includes(this.instance.config.api_host) &&\n            this.instance.config.advanced_disable_toolbar_metrics\n\n        const toolbarParams = {\n            token: this.instance.config.token,\n            ...params,\n            apiURL: host, // defaults to api_host from the instance config if nothing else set\n            ...(disableToolbarMetrics ? { instrument: false } : {}),\n        }\n\n        const { source: _discard, ...paramsToPersist } = toolbarParams // eslint-disable-line\n        window.localStorage.setItem('_postHogToolbarParams', JSON.stringify(paramsToPersist))\n\n        loadScript(toolbarUrl, (err) => {\n            if (err) {\n                logger.error('Failed to load toolbar', err)\n                return\n            }\n            ;(assignableWindow['ph_load_toolbar'] || assignableWindow['ph_load_editor'])(toolbarParams, this.instance)\n        })\n        // Turbolinks doesn't fire an onload event but does replace the entire body, including the toolbar.\n        // Thus, we ensure the toolbar is only loaded inside the body, and then reloaded on turbolinks:load.\n        _register_event(window, 'turbolinks:load', () => {\n            assignableWindow['_postHogToolbarLoaded'] = false\n            this.loadToolbar(toolbarParams)\n        })\n        return true\n    }\n\n    /** @deprecated Use \"loadToolbar\" instead. */\n    _loadEditor(params: ToolbarParams): boolean {\n        return this.loadToolbar(params)\n    }\n\n    /** @deprecated Use \"maybeLoadToolbar\" instead. */\n    maybeLoadEditor(\n        location: Location | undefined = undefined,\n        localStorage: Storage | undefined = undefined,\n        history: History | undefined = undefined\n    ): boolean {\n        return this.maybeLoadToolbar(location, localStorage, history)\n    }\n}\n", "/**\n * GDPR utils\n *\n * The General Data Protection Regulation (GDPR) is a regulation in EU law on data protection\n * and privacy for all individuals within the European Union. It addresses the export of personal\n * data outside the EU. The GDPR aims primarily to give control back to citizens and residents\n * over their personal data and to simplify the regulatory environment for international business\n * by unifying the regulation within the EU.\n *\n * This set of utilities is intended to enable opt in/out functionality in the PostHog JS SDK.\n * These functions are used internally by the SDK and are not intended to be publicly exposed.\n */\n\nimport { _each, _includes } from './utils'\nimport { window } from './utils/globals'\nimport { cookieStore, localStore, localPlusCookieStore } from './storage'\nimport { GDPROptions, PersistentStore } from './types'\nimport { PostHog } from './posthog-core'\n\nimport { _isNumber, _isString } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\n/**\n * A function used to capture a PostHog event (e.g. PostHogLib.capture)\n * @callback captureFunction\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after capturing the event.\n */\n\n/** Public **/\n\nconst GDPR_DEFAULT_PERSISTENCE_PREFIX = '__ph_opt_in_out_'\n\n/**\n * Opt the user in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function optIn(token: string, options: GDPROptions): void {\n    _optInOut(true, token, options)\n}\n\n/**\n * Opt the user out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-out cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-out cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-out cookie is set as secure or not\n */\nexport function optOut(token: string, options: GDPROptions): void {\n    _optInOut(false, token, options)\n}\n\n/**\n * Check whether the user has opted in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted in to the given opt type\n */\nexport function hasOptedIn(token: string, options: GDPROptions): boolean {\n    return _getStorageValue(token, options) === '1'\n}\n\n/**\n * Check whether the user has opted out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the user has opted out of the given opt type\n */\nexport function hasOptedOut(token: string, options: Partial<GDPROptions>): boolean {\n    if (_hasDoNotTrackFlagOn(options)) {\n        return true\n    }\n    return _getStorageValue(token, options) === '0'\n}\n\n/**\n * Clear the user's opt in/out status of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function clearOptInOut(token: string, options: GDPROptions) {\n    options = options || {}\n    _getStorage(options).remove(_getStorageKey(token, options), !!options.crossSubdomainCookie)\n}\n\n/** Private **/\n\n/**\n * Get storage util\n * @param {Object} [options]\n * @param {string} [options.persistenceType]\n * @returns {object} either cookieStore or localStore\n */\nfunction _getStorage(options: GDPROptions): PersistentStore {\n    options = options || {}\n    if (options.persistenceType === 'localStorage') {\n        return localStore\n    }\n    if (options.persistenceType === 'localStorage+cookie') {\n        return localPlusCookieStore\n    }\n    return cookieStore\n}\n\n/**\n * Get the name of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the name of the cookie for the given opt type\n */\nfunction _getStorageKey(token: string, options: GDPROptions) {\n    options = options || {}\n    return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token\n}\n\n/**\n * Get the value of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the value of the cookie for the given opt type\n */\nfunction _getStorageValue(token: string, options: GDPROptions) {\n    return _getStorage(options).get(_getStorageKey(token, options))\n}\n\n/**\n * Check whether the user has set the DNT/doNotTrack setting to true in their browser\n * @param {Object} [options]\n * @param {string} [options.window] - alternate window object to check; used to force various DNT settings in browser tests\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the DNT setting is true\n */\nfunction _hasDoNotTrackFlagOn(options: GDPROptions) {\n    if (options && options.respectDnt) {\n        const win = (options && options.window) || window\n        const nav = win?.navigator\n        let hasDntOn = false\n        _each(\n            [\n                nav?.doNotTrack, // standard\n                (nav as any)['msDoNotTrack'],\n                (win as any)['doNotTrack'],\n            ],\n            function (dntValue) {\n                if (_includes([true, 1, '1', 'yes'], dntValue)) {\n                    hasDntOn = true\n                }\n            }\n        )\n        return hasDntOn\n    }\n    return false\n}\n\n/**\n * Set cookie/localstorage for the user indicating that they are opted in or out for the given opt type\n * @param {boolean} optValue - whether to opt the user in or out for the given opt type\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction _optInOut(optValue: boolean, token: string, options: GDPROptions) {\n    if (!_isString(token) || !token.length) {\n        logger.error('gdpr.' + (optValue ? 'optIn' : 'optOut') + ' called with an invalid token')\n        return\n    }\n\n    options = options || {}\n\n    _getStorage(options).set(\n        _getStorageKey(token, options),\n        optValue ? 1 : 0,\n        _isNumber(options.cookieExpiration) ? options.cookieExpiration : null,\n        options.crossSubdomainCookie,\n        options.secureCookie\n    )\n\n    if (options.capture && optValue) {\n        // only capture event if opting in (optValue=true)\n        options.capture(options.captureEventName || '$opt_in', options.captureProperties || {}, {\n            send_instantly: true,\n        })\n    }\n}\n\nexport function userOptedOut(posthog: PostHog) {\n    let optedOut = false\n\n    try {\n        const token = posthog.config.token\n        const respectDnt = posthog.config.respect_dnt\n        const persistenceType = posthog.config.opt_out_capturing_persistence_type\n        const persistencePrefix = posthog.config.opt_out_capturing_cookie_prefix || undefined\n        const win = (posthog.config as any).window as Window | undefined // used to override window during browser tests\n\n        if (token) {\n            // if there was an issue getting the token, continue method execution as normal\n            optedOut = hasOptedOut(token, {\n                respectDnt,\n                persistenceType,\n                persistencePrefix,\n                window: win,\n            })\n        }\n    } catch (err) {\n        logger.error('Unexpected error when checking capturing opt-out status: ' + err)\n    }\n    return optedOut\n}\n", "export class RequestQueueScaffold {\n    isPolling: boolean // flag to continue to recursively poll or not\n    _event_queue: any[]\n    _empty_queue_count: number // to track empty polls\n    _poller: number | undefined // to become interval for reference to clear later\n    _pollInterval: number\n\n    constructor(pollInterval = 3000) {\n        this.isPolling = true // flag to continue to recursively poll or not\n        this._event_queue = []\n        this._empty_queue_count = 0 // to track empty polls\n        this._poller = undefined // to become interval for reference to clear later\n        this._pollInterval = pollInterval\n    }\n\n    setPollInterval(interval: number): void {\n        this._pollInterval = interval\n        // Reset interval if running already\n        if (this.isPolling) {\n            this.poll()\n        }\n    }\n\n    // // eslint-disable-next-line no-unused-vars\n    // enqueue(_requestData: Record<string, any>): void {\n    //     return\n    // }\n\n    poll(): void {\n        return\n    }\n\n    unload(): void {\n        return\n    }\n\n    getTime(): number {\n        return new Date().getTime()\n    }\n}\n", "import { RequestQueueScaffold } from './base-request-queue'\nimport { _each } from './utils'\nimport { Properties, QueuedRequestData, XHROptions } from './types'\n\nimport { _isUndefined } from './utils/type-utils'\n\nexport class RequestQueue extends RequestQueueScaffold {\n    handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void\n\n    constructor(handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void, pollInterval = 3000) {\n        super(pollInterval)\n        this.handlePollRequest = handlePollRequest\n    }\n\n    enqueue(url: string, data: Properties, options: XHROptions): void {\n        this._event_queue.push({ url, data, options })\n\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this._event_queue.length > 0) {\n                const requests = this.formatQueue()\n                for (const key in requests) {\n                    const { url, data, options } = requests[key]\n                    _each(data, (_, dataKey) => {\n                        data[dataKey]['offset'] = Math.abs(data[dataKey]['timestamp'] - this.getTime())\n                        delete data[dataKey]['timestamp']\n                    })\n                    this.handlePollRequest(url, data, options)\n                }\n                this._event_queue.length = 0 // flush the _event_queue\n                this._empty_queue_count = 0\n            } else {\n                this._empty_queue_count++\n            }\n\n            /**\n             * _empty_queue_count will increment each time the queue is polled\n             *  and it is empty. To avoid empty polling (user went idle, stepped away from comp)\n             *  we can turn it off with the isPolling flag.\n             *\n             * Polling will be re enabled when the next time PostHogLib.capture is called with\n             *  an event that should be added to the event queue.\n             */\n            if (this._empty_queue_count > 4) {\n                this.isPolling = false\n                this._empty_queue_count = 0\n            }\n            if (this.isPolling) {\n                this.poll()\n            }\n        }, this._pollInterval) as any as number\n    }\n\n    unload(): void {\n        clearTimeout(this._poller)\n        const requests = this._event_queue.length > 0 ? this.formatQueue() : {}\n        this._event_queue.length = 0\n        const requestValues = Object.values(requests)\n\n        // Always force events to be sent before recordings, as events are more important, and recordings are bigger and thus less likely to arrive\n        const sortedRequests = [\n            ...requestValues.filter((r) => r.url.indexOf('/e') === 0),\n            ...requestValues.filter((r) => r.url.indexOf('/e') !== 0),\n        ]\n        sortedRequests.map(({ url, data, options }) => {\n            this.handlePollRequest(url, data, { ...options, transport: 'sendBeacon' })\n        })\n    }\n\n    formatQueue(): Record<string, QueuedRequestData> {\n        const requests: Record<string, QueuedRequestData> = {}\n        _each(this._event_queue, (request) => {\n            const { url, data, options } = request\n            const key = (options ? options._batchKey : null) || url\n            if (_isUndefined(requests[key])) {\n                requests[key] = { data: [], url, options }\n            }\n\n            // :TRICKY: Metrics-only code\n            if (\n                options &&\n                requests[key].options &&\n                requests[key].options._metrics &&\n                !(requests[key].options._metrics as any)['rrweb_full_snapshot']\n            ) {\n                ;(requests[key].options._metrics as any)['rrweb_full_snapshot'] =\n                    options._metrics['rrweb_full_snapshot']\n            }\n            requests[key].data.push(data)\n        })\n        return requests\n    }\n}\n", "// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Much of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// Many optimizations have been made, so the bundle size is ultimately smaller but performance is similar.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var u = ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([c], { type: 'text/javascript' })));\n    var w = new Worker(u);\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i)\n            co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8)) >>> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >>> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) >> 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                if (!noSt && pos + tl * (clb + 7) > tbts)\n                    break;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts)\n                throw 'unexpected EOF';\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var mxa = lbt + dbt + 18;\n        while (noSt || pos + mxa < tbts) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts)\n                throw 'unexpected EOF';\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts)\n                    throw 'unexpected EOF';\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = pos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [new u8(0), 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.floor(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768\n            var imod = i & 32767;\n            // previous index with this value\n            var pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst)\n            pos = wfblk(w, pos, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = 0xFFFFFFFF;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return c ^ 0xFFFFFFFF; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 5552, l);\n                for (; i < e; ++i)\n                    n += d[i], m += n;\n                n %= 65521, m %= 65521;\n            }\n            a = n, b = m;\n        },\n        d: function () { return ((a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8)) + ((a & 255) << 23) * 2; }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    if (!opts.consume)\n        dat = new u8(dat);\n    w.postMessage([dat, opts], [dat.buffer]);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16)) + (d[b + 3] << 23) * 2; };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) + (2 * (d[l - 1] << 23));\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    return dopt(data, opts, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) >> 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = gzs(this.p);\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    var l = str.length;\n    if (!latin1 && typeof TextEncoder != 'undefined')\n        return new TextEncoder().encode(str);\n    var ar = new u8(str.length + (str.length >>> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >>> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >>> 18)), w(128 | ((c >>> 12) & 63)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >>> 12)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    var r = '';\n    if (!latin1 && typeof TextDecoder != 'undefined')\n        return new TextDecoder().decode(dat);\n    for (var i = 0; i < dat.length;) {\n        var c = dat[i++];\n        if (c < 128 || latin1)\n            r += String.fromCharCode(c);\n        else if (c < 224)\n            r += String.fromCharCode((c & 31) << 6 | (dat[i++] & 63));\n        else if (c < 240)\n            r += String.fromCharCode((c & 15) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63));\n        else\n            c = ((c & 15) << 18 | (dat[i++] & 63) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n    }\n    return r;\n}\n;\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl;\n    var _a = z ? z64e(d, es) : [b4(d, b + 20), b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b4(d, b + 12), b4(d, b + 4), b4(d, b + 20)];\n};\n// write zip header\nvar wzh = function (d, b, c, cmp, su, fn, u, o, ce, t) {\n    var fl = fn.length, l = cmp.length;\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b] = 20, b += 2;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (t == 8 && (o.level == 1 ? 6 : o.level < 6 ? 4 : o.level == 9 ? 2 : 0)), d[b++] = u && 8;\n    d[b] = t, b += 2;\n    var dt = new Date(o.mtime || Date.now()), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, ((y << 24) * 2) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1));\n    b += 4;\n    wbytes(d, b, c);\n    wbytes(d, b + 4, l);\n    wbytes(d, b + 8, su);\n    wbytes(d, b + 12, fl), b += 16; // skip extra field, comment\n    if (ce != null)\n        wbytes(d, b += 10, ce), b += 4;\n    d.set(fn, b);\n    b += fl;\n    if (ce == null)\n        d.set(cmp, b);\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                wzh(out, tot, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n                wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, tot, f.t), o += 46 + f.n.length, tot += 30 + f.n.length + f.d.length;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), m = file.length;\n        c.p(file);\n        var n = strToU8(fn), s = n.length;\n        var t = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = {\n                    t: t,\n                    d: d,\n                    m: m,\n                    c: c.d(),\n                    u: fn.length != l,\n                    n: n,\n                    p: p\n                };\n                o += 30 + s + l;\n                tot += 76 + 2 * s + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (n.length > 65535)\n            cbl('filename too long', null);\n        if (!t)\n            cbl(null, file);\n        else if (m < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var t = p.level == 0 ? 0 : 8;\n        var n = strToU8(fn), s = n.length;\n        if (n.length > 65535)\n            throw 'filename too long';\n        var d = t ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push({\n            t: t,\n            d: d,\n            m: file.length,\n            c: c.d(),\n            u: fn.length != s,\n            n: n,\n            o: o,\n            p: p\n        });\n        o += 30 + s + l;\n        tot += 76 + 2 * s + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n        wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, f.o, f.t), o += 46 + f.n.length;\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_2 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_2(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n", "import type { MaskInputOptions, SlimDOMOptions } from 'rrweb-snapshot'\nimport { PostHog } from './posthog-core'\nimport { RetryQueue } from './retry-queue'\n\nexport type Property = any\nexport type Properties = Record<string, Property>\n\nexport interface CaptureResult {\n    uuid: string\n    event: string\n    properties: Properties\n    $set?: Properties\n    $set_once?: Properties\n    timestamp?: Date\n}\nexport type CaptureCallback = (response: any, data: any) => void\n\nexport type AutocaptureCompatibleElement = 'a' | 'button' | 'form' | 'input' | 'select' | 'textarea' | 'label'\nexport type DomAutocaptureEvents = 'click' | 'change' | 'submit'\n\n/**\n * If an array is passed for an allowlist, autocapture events will only be sent for elements matching\n * at least one of the elements in the array. Multiple allowlists can be used\n */\nexport interface AutocaptureConfig {\n    /**\n     * List of URLs to allow autocapture on, can be strings to match\n     * or regexes e.g. ['https://example.com', 'test.com/.*']\n     */\n    url_allowlist?: (string | RegExp)[]\n\n    /**\n     * List of DOM events to allow autocapture on  e.g. ['click', 'change', 'submit']\n     */\n    dom_event_allowlist?: DomAutocaptureEvents[]\n\n    /**\n     * List of DOM elements to allow autocapture on\n     * e.g. ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n     */\n    element_allowlist?: AutocaptureCompatibleElement[]\n\n    /**\n     * List of CSS selectors to allow autocapture on\n     * e.g. ['[ph-capture]']\n     */\n    css_selector_allowlist?: string[]\n\n    /**\n     * Exclude certain element attributes from autocapture\n     * E.g. ['aria-label'] or [data-attr-pii]\n     */\n    element_attribute_ignorelist?: string[]\n}\n\nexport type UUIDVersion = 'og' | 'v7'\n\nexport interface PostHogConfig {\n    api_host: string\n    api_method: string\n    api_transport: string\n    ui_host: string | null\n    token: string\n    autocapture: boolean | AutocaptureConfig\n    rageclick: boolean\n    cross_subdomain_cookie: boolean\n    persistence: 'localStorage' | 'cookie' | 'memory' | 'localStorage+cookie' | 'sessionStorage'\n    persistence_name: string\n    cookie_name: string\n    loaded: (posthog_instance: PostHog) => void\n    store_google: boolean\n    custom_campaign_params: string[]\n    // a list of strings to be tested against navigator.userAgent to determine if the source is a bot\n    // this is **added to** the default list of bots that we check\n    // defaults to the empty array\n    custom_blocked_useragents: string[]\n    save_referrer: boolean\n    verbose: boolean\n    capture_pageview: boolean\n    capture_pageleave: boolean\n    debug: boolean\n    cookie_expiration: number\n    upgrade: boolean\n    disable_session_recording: boolean\n    disable_persistence: boolean\n    /** @deprecated - use `disable_persistence` instead  */\n    disable_cookie: boolean\n    enable_recording_console_log?: boolean\n    secure_cookie: boolean\n    ip: boolean\n    opt_out_capturing_by_default: boolean\n    opt_out_persistence_by_default: boolean\n    opt_out_capturing_persistence_type: 'localStorage' | 'cookie'\n    opt_out_capturing_cookie_prefix: string | null\n    opt_in_site_apps: boolean\n    respect_dnt: boolean\n    property_blacklist: string[]\n    xhr_headers: { [header_name: string]: string }\n    on_xhr_error: (failedRequest: XMLHttpRequest) => void\n    inapp_protocol: string\n    inapp_link_new_window: boolean\n    request_batching: boolean\n    sanitize_properties: ((properties: Properties, event_name: string) => Properties) | null\n    properties_string_max_length: number\n    session_recording: SessionRecordingOptions\n    session_idle_timeout_seconds: number\n    mask_all_element_attributes: boolean\n    mask_all_text: boolean\n    advanced_disable_decide: boolean\n    advanced_disable_feature_flags: boolean\n    advanced_disable_feature_flags_on_first_load: boolean\n    advanced_disable_toolbar_metrics: boolean\n    get_device_id: (uuid: string) => string\n    name: string\n    callback_fn: string\n    _onCapture: (eventName: string, eventData: CaptureResult) => void\n    capture_performance?: boolean\n    // Should only be used for testing. Could negatively impact performance.\n    disable_compression: boolean\n    bootstrap: {\n        distinctID?: string\n        isIdentifiedID?: boolean\n        featureFlags?: Record<string, boolean | string>\n        featureFlagPayloads?: Record<string, JsonType>\n    }\n    segment?: any\n    __preview_measure_pageview_stats?: boolean\n    __preview_send_client_session_params?: boolean\n}\n\nexport interface OptInOutCapturingOptions {\n    capture: (event: string, properties: Properties, options: CaptureOptions) => void\n    capture_event_name: string\n    capture_properties: Properties\n    enable_persistence: boolean\n    clear_persistence: boolean\n    persistence_type: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    cookie_prefix: string\n    cookie_expiration: number\n    cross_subdomain_cookie: boolean\n    secure_cookie: boolean\n}\n\nexport interface isFeatureEnabledOptions {\n    send_event: boolean\n}\n\nexport interface SessionRecordingOptions {\n    blockClass?: string | RegExp\n    blockSelector?: string | null\n    ignoreClass?: string\n    maskTextClass?: string | RegExp\n    maskTextSelector?: string | null\n    maskTextFn?: ((text: string) => string) | null\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: ((text: string, element?: HTMLElement) => string) | null\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    collectFonts?: boolean\n    inlineStylesheet?: boolean\n    recorderVersion?: 'v1' | 'v2'\n    recordCrossOriginIframes?: boolean\n    /** @deprecated - use maskCapturedNetworkRequestFn instead  */\n    maskNetworkRequestFn?: ((data: NetworkRequest) => NetworkRequest | null | undefined) | null\n    /** Modify the network request before it is captured. Returning null or undefined stops it being captured */\n    maskCapturedNetworkRequestFn?: ((data: CapturedNetworkRequest) => CapturedNetworkRequest | null | undefined) | null\n    // properties below here are ALPHA, don't rely on them, they may change without notice\n    // TODO which of these do we actually expose?\n    // if this isn't provided a default will be used\n    // this only applies to the payload recorder\n    // TODO I guess it should apply to the other recorder to\n    initiatorTypes?: InitiatorType[]\n    recordHeaders?: boolean | { request: boolean; response: boolean }\n    // true means record all bodies\n    // false means record no bodies\n    // string[] means record bodies matching the provided content-type headers\n    recordBody?: boolean | string[] | { request: boolean | string[]; response: boolean | string[] }\n    // I can't think why you wouldn't want this... so\n    // recordInitialRequests?: boolean\n}\n\nexport type SessionIdChangedCallback = (sessionId: string, windowId: string | null | undefined) => void\n\nexport enum Compression {\n    GZipJS = 'gzip-js',\n    Base64 = 'base64',\n}\n\nexport interface XHROptions {\n    transport?: 'XHR' | 'sendBeacon'\n    method?: 'POST' | 'GET'\n    urlQueryArgs?: { compression: Compression }\n    verbose?: boolean\n    blob?: boolean\n    sendBeacon?: boolean\n}\n\nexport interface CaptureOptions extends XHROptions {\n    $set?: Properties /** used with $identify */\n    $set_once?: Properties /** used with $identify */\n    _batchKey?: string /** key of queue, e.g. 'sessionRecording' vs 'event' */\n    _metrics?: Properties\n    _noTruncate?: boolean /** if set, overrides and disables config.properties_string_max_length */\n    endpoint?: string /** defaults to '/e/' */\n    send_instantly?: boolean /** if set skips the batched queue */\n    timestamp?: Date\n}\n\nexport interface RetryQueueElement {\n    retryAt: Date\n    requestData: QueuedRequestData\n}\nexport interface QueuedRequestData {\n    url: string\n    data: Properties\n    options: CaptureOptions\n    headers?: Properties\n    callback?: RequestCallback\n    retriesPerformedSoFar?: number\n}\n\nexport interface XHRParams extends QueuedRequestData {\n    retryQueue: RetryQueue\n    onXHRError: (req: XMLHttpRequest) => void\n    timeout?: number\n    onResponse?: (req: XMLHttpRequest) => void\n}\n\nexport interface DecideResponse {\n    status: number\n    supportedCompression: Compression[]\n    config: {\n        enable_collect_everything: boolean\n    }\n    custom_properties: AutoCaptureCustomProperty[] // TODO: delete, not sent\n    featureFlags: Record<string, string | boolean>\n    featureFlagPayloads: Record<string, JsonType>\n    errorsWhileComputingFlags: boolean\n    autocapture_opt_out?: boolean\n    capturePerformance?: boolean\n    analytics?: {\n        endpoint?: string\n    }\n    elementsChainAsString?: boolean\n    // this is currently in development and may have breaking changes without a major version bump\n    autocaptureExceptions?:\n        | boolean\n        | {\n              endpoint?: string\n              errors_to_ignore: string[]\n          }\n    sessionRecording?: {\n        endpoint?: string\n        consoleLogRecordingEnabled?: boolean\n        recorderVersion?: 'v1' | 'v2'\n        // the API returns a decimal between 0 and 1 as a string\n        sampleRate?: string | null\n        minimumDurationMilliseconds?: number\n        linkedFlag?: string | null\n        networkPayloadCapture?: Pick<NetworkRecordOptions, 'recordBody' | 'recordHeaders'>\n    }\n    surveys?: boolean\n    toolbarParams: ToolbarParams\n    editorParams?: ToolbarParams /** @deprecated, renamed to toolbarParams, still present on older API responses */\n    toolbarVersion: 'toolbar' /** @deprecated, moved to toolbarParams */\n    isAuthenticated: boolean\n    siteApps: { id: number; url: string }[]\n}\n\nexport type FeatureFlagsCallback = (flags: string[], variants: Record<string, string | boolean>) => void\n\n// TODO: delete custom_properties after changeless typescript refactor\nexport interface AutoCaptureCustomProperty {\n    name: string\n    css_selector: string\n    event_selectors: string[]\n}\n\nexport interface CompressionData {\n    data: string\n    compression?: Compression\n}\n\nexport interface GDPROptions {\n    capture?: (\n        event: string,\n        properties: Properties,\n        options: CaptureOptions\n    ) => void /** function used for capturing a PostHog event to record the opt-in action */\n    captureEventName?: string /** event name to be used for capturing the opt-in action */\n    captureProperties?: Properties /** set of properties to be captured along with the opt-in action */\n    /** persistence mechanism used */\n    persistenceType?: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    persistencePrefix?: string /** [__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name */\n    cookieExpiration?: number /** number of days until the opt-in cookie expires */\n    crossSubdomainCookie?: boolean /** whether the opt-in cookie is set as cross-subdomain or not */\n    secureCookie?: boolean /** whether the opt-in cookie is set as secure or not */\n    respectDnt?: boolean\n    window?: Window\n}\n\nexport type RequestCallback = (response: Record<string, any>, data?: Properties) => void\n\nexport interface PersistentStore {\n    is_supported: () => boolean\n    error: (error: any) => void\n    parse: (name: string) => any\n    get: (name: string) => any\n    set: (name: string, value: any, expire_days?: number | null, cross_subdomain?: boolean, secure?: boolean) => void\n    remove: (name: string, cross_subdomain?: boolean) => void\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Breaker = {}\nexport type EventHandler = (event: Event) => boolean | void\n\nexport type ToolbarUserIntent = 'add-action' | 'edit-action'\nexport type ToolbarSource = 'url' | 'localstorage'\nexport type ToolbarVersion = 'toolbar'\n\n/* sync with posthog */\nexport interface ToolbarParams {\n    token?: string /** public posthog-js token */\n    temporaryToken?: string /** private temporary user token */\n    actionId?: number\n    userIntent?: ToolbarUserIntent\n    source?: ToolbarSource\n    toolbarVersion?: ToolbarVersion\n    instrument?: boolean\n    distinctId?: string\n    userEmail?: string\n    dataAttributes?: string[]\n    featureFlags?: Record<string, string | boolean>\n}\n\nexport interface PostData {\n    buffer?: BlobPart\n    compression?: Compression\n    data?: string\n}\n\nexport interface JSC {\n    (): void\n    [key: string]: (response: any) => void\n}\n\nexport type SnippetArrayItem = [method: string, ...args: any[]]\n\nexport type JsonType = string | number | boolean | null | { [key: string]: JsonType } | Array<JsonType>\n\n/** A feature that isn't publicly available yet.*/\nexport interface EarlyAccessFeature {\n    // Sync this with the backend's EarlyAccessFeatureSerializer!\n    name: string\n    description: string\n    stage: 'concept' | 'alpha' | 'beta'\n    documentationUrl: string | null\n    flagKey: string | null\n}\n\nexport type EarlyAccessFeatureCallback = (earlyAccessFeatures: EarlyAccessFeature[]) => void\n\nexport interface EarlyAccessFeatureResponse {\n    earlyAccessFeatures: EarlyAccessFeature[]\n}\n\nexport type Headers = Record<string, string>\n\nexport type Body =\n    | string\n    | Document\n    | Blob\n    | ArrayBufferView\n    | ArrayBuffer\n    | FormData\n    // rrweb uses URLSearchParams and ReadableStream<Uint8Array>\n    // as part of the union for this type\n    // because they don't support IE11\n    // but, we do \n    // what's going to happen here in IE11?\n    | URLSearchParams\n    | ReadableStream<Uint8Array>\n    | null\n\n/* for rrweb/network@1\n ** when that is released as part of rrweb this can be removed\n ** don't rely on this type, it may change without notice\n */\nexport type InitiatorType =\n    | 'audio'\n    | 'beacon'\n    | 'body'\n    | 'css'\n    | 'early-hint'\n    | 'embed'\n    | 'fetch'\n    | 'frame'\n    | 'iframe'\n    | 'icon'\n    | 'image'\n    | 'img'\n    | 'input'\n    | 'link'\n    | 'navigation'\n    | 'object'\n    | 'ping'\n    | 'script'\n    | 'track'\n    | 'video'\n    | 'xmlhttprequest'\n\nexport type NetworkRecordOptions = {\n    initiatorTypes?: InitiatorType[]\n    maskRequestFn?: (data: CapturedNetworkRequest) => CapturedNetworkRequest | undefined\n    recordHeaders?: boolean | { request: boolean; response: boolean }\n    recordBody?: boolean | string[] | { request: boolean | string[]; response: boolean | string[] }\n    recordInitialRequests?: boolean\n    // whether to record PerformanceEntry events for network requests\n    recordPerformance?: boolean\n    // the PerformanceObserver will only observe these entry types\n    performanceEntryTypeToObserve: string[]\n    // the maximum size of the request/response body to record\n    // NB this will be at most 1MB even if set larger\n    payloadSizeLimitBytes: number\n}\n\n/** @deprecated - use CapturedNetworkRequest instead  */\nexport type NetworkRequest = {\n    url: string\n}\n\n// In rrweb this is called NetworkRequest, but we already exposed that as having only URL\n// we also want to vary from the rrweb NetworkRequest because we want to include\n// all PerformanceEntry properties too.\n// that has 4 required properties\n//     readonly duration: DOMHighResTimeStamp;\n//     readonly entryType: string;\n//     readonly name: string;\n//     readonly startTime: DOMHighResTimeStamp;\n// NB: properties below here are ALPHA, don't rely on them, they may change without notice\nexport type CapturedNetworkRequest = Omit<PerformanceEntry, 'toJSON'> & {\n    // properties below here are ALPHA, don't rely on them, they may change without notice\n    method?: string\n    initiatorType?: InitiatorType\n    status?: number\n    timeOrigin?: number\n    timestamp?: number\n    startTime?: number\n    endTime?: number\n    requestHeaders?: Headers\n    requestBody?: Body\n    responseHeaders?: Headers\n    responseBody?: Body\n    // was this captured before fetch/xhr could have been wrapped\n    isInitial?: boolean\n}\n", "import { _each } from './utils'\nimport Config from './config'\nimport { PostData, XHROptions, XHRParams } from './types'\nimport { _HTTPBuildQuery } from './utils/request-utils'\n\nimport { _isArray, _isFunction, _isNumber, _isUint8Array, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\nexport const addParamsToURL = (\n    url: string,\n    urlQueryArgs: Record<string, any> | undefined,\n    parameterOptions: { ip?: boolean }\n): string => {\n    const args = urlQueryArgs || {}\n    args['ip'] = parameterOptions['ip'] ? 1 : 0\n    args['_'] = new Date().getTime().toString()\n    args['ver'] = Config.LIB_VERSION\n\n    const halves = url.split('?')\n    if (halves.length > 1) {\n        const params = halves[1].split('&')\n        for (const p of params) {\n            const key = p.split('=')[0]\n            if (!_isUndefined(args[key])) {\n                delete args[key]\n            }\n        }\n    }\n\n    const argSeparator = url.indexOf('?') > -1 ? '&' : '?'\n    return url + argSeparator + _HTTPBuildQuery(args)\n}\n\nexport const encodePostData = (data: PostData | Uint8Array, options: Partial<XHROptions>): string | BlobPart | null => {\n    if (options.blob && data.buffer) {\n        return new Blob([_isUint8Array(data) ? data : data.buffer], { type: 'text/plain' })\n    }\n\n    if (options.sendBeacon || options.blob) {\n        const body = encodePostData(data, { method: 'POST' }) as BlobPart\n        return new Blob([body], { type: 'application/x-www-form-urlencoded' })\n    }\n\n    if (options.method !== 'POST') {\n        return null\n    }\n\n    let body_data\n\n    if (_isArray(data) || _isUint8Array(data)) {\n        // TODO: eh? passing an Array here?\n        body_data = 'data=' + encodeURIComponent(data as any)\n    } else {\n        body_data = 'data=' + encodeURIComponent(data.data as string)\n    }\n\n    if ('compression' in data && data.compression) {\n        body_data += '&compression=' + data.compression\n    }\n\n    return body_data\n}\n\nexport const xhr = ({\n    url,\n    data,\n    headers,\n    options,\n    callback,\n    retriesPerformedSoFar,\n    retryQueue,\n    onXHRError,\n    timeout = 60000,\n    onResponse,\n}: XHRParams) => {\n    if (_isNumber(retriesPerformedSoFar) && retriesPerformedSoFar > 0) {\n        url = addParamsToURL(url, { retry_count: retriesPerformedSoFar }, {})\n    }\n\n    const req = new XMLHttpRequest()\n    req.open(options.method || 'GET', url, true)\n\n    const body = encodePostData(data, options)\n\n    _each(headers, function (headerValue, headerName) {\n        req.setRequestHeader(headerName, headerValue)\n    })\n\n    if (options.method === 'POST' && !options.blob) {\n        req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n    }\n\n    req.timeout = timeout\n    // send the ph_optout cookie\n    // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n    req.withCredentials = true\n    req.onreadystatechange = () => {\n        // XMLHttpRequest.DONE == 4, except in safari 4\n        if (req.readyState === 4) {\n            onResponse?.(req)\n            if (req.status === 200) {\n                if (callback) {\n                    let response\n                    try {\n                        response = JSON.parse(req.responseText)\n                    } catch (e) {\n                        logger.error(e)\n                        return\n                    }\n                    callback(response)\n                }\n            } else {\n                if (_isFunction(onXHRError)) {\n                    onXHRError(req)\n                }\n\n                // don't retry errors between 400 and 500 inclusive\n                if (req.status < 400 || req.status > 500) {\n                    retryQueue.enqueue({\n                        url,\n                        data,\n                        options,\n                        headers,\n                        retriesPerformedSoFar: (retriesPerformedSoFar || 0) + 1,\n                        callback,\n                    })\n                }\n\n                callback?.({ status: 0 })\n            }\n        }\n    }\n    req.send(body)\n}\n", "import { RequestQueueScaffold } from './base-request-queue'\nimport { encodePostData, xhr } from './send-request'\nimport { QueuedRequestData, RetryQueueElement } from './types'\nimport { RateLimiter } from './rate-limiter'\n\nimport { _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window } from './utils/globals'\n\nconst thirtyMinutes = 30 * 60 * 1000\n\n/**\n * Generates a jitter-ed exponential backoff delay in milliseconds\n *\n * The base value is 6 seconds, which is doubled with each retry\n * up to the maximum of 30 minutes\n *\n * Each value then has +/- 50% jitter\n *\n * Giving a range of 6 seconds up to 45 minutes\n */\nexport function pickNextRetryDelay(retriesPerformedSoFar: number): number {\n    const rawBackoffTime = 3000 * 2 ** retriesPerformedSoFar\n    const minBackoff = rawBackoffTime / 2\n    const cappedBackoffTime = Math.min(thirtyMinutes, rawBackoffTime)\n    const jitterFraction = Math.random() - 0.5 // A random number between -0.5 and 0.5\n    const jitter = jitterFraction * (cappedBackoffTime - minBackoff)\n    return Math.ceil(cappedBackoffTime + jitter)\n}\n\nexport class RetryQueue extends RequestQueueScaffold {\n    queue: RetryQueueElement[]\n    isPolling: boolean\n    areWeOnline: boolean\n    onXHRError: (failedRequest: XMLHttpRequest) => void\n    rateLimiter: RateLimiter\n\n    constructor(onXHRError: (failedRequest: XMLHttpRequest) => void, rateLimiter: RateLimiter) {\n        super()\n        this.isPolling = false\n        this.queue = []\n        this.areWeOnline = true\n        this.onXHRError = onXHRError\n        this.rateLimiter = rateLimiter\n\n        if (!_isUndefined(window) && 'onLine' in window.navigator) {\n            this.areWeOnline = window.navigator.onLine\n            window.addEventListener('online', () => {\n                this._handleWeAreNowOnline()\n            })\n            window.addEventListener('offline', () => {\n                this.areWeOnline = false\n            })\n        }\n    }\n\n    enqueue(requestData: QueuedRequestData): void {\n        const retriesPerformedSoFar = requestData.retriesPerformedSoFar || 0\n        if (retriesPerformedSoFar >= 10) {\n            return\n        }\n        const msToNextRetry = pickNextRetryDelay(retriesPerformedSoFar)\n        const retryAt = new Date(Date.now() + msToNextRetry)\n\n        this.queue.push({ retryAt, requestData })\n\n        let logMessage = `Enqueued failed request for retry in ${msToNextRetry}`\n        if (!navigator.onLine) {\n            logMessage += ' (Browser is offline)'\n        }\n        logger.warn(logMessage)\n\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        this._poller && clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this.areWeOnline && this.queue.length > 0) {\n                this.flush()\n            }\n            this.poll()\n        }, this._pollInterval) as any as number\n    }\n\n    flush(): void {\n        // using Date.now to make tests easier, as recommended here https://codewithhugo.com/mocking-the-current-date-in-jest-tests/\n        const now = new Date(Date.now())\n        const toFlush = this.queue.filter(({ retryAt }) => retryAt < now)\n        if (toFlush.length > 0) {\n            this.queue = this.queue.filter(({ retryAt }) => retryAt >= now)\n            for (const { requestData } of toFlush) {\n                this._executeXhrRequest(requestData)\n            }\n        }\n    }\n\n    unload(): void {\n        if (this._poller) {\n            clearTimeout(this._poller)\n            this._poller = undefined\n        }\n\n        for (const { requestData } of this.queue) {\n            const { url, data, options } = requestData\n\n            if (this.rateLimiter.isRateLimited(options._batchKey)) {\n                logger.warn('[RetryQueue] is quota limited. Dropping request.')\n                continue\n            }\n\n            try {\n                // we've had send beacon in place for at least 2 years\n                // eslint-disable-next-line compat/compat\n                window?.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // Note sendBeacon automatically retries, and after the first retry it will lose reference to contextual `this`.\n                // This means in some cases `this.getConfig` will be undefined.\n                logger.error(e)\n            }\n        }\n        this.queue = []\n    }\n\n    _executeXhrRequest({ url, data, options, headers, callback, retriesPerformedSoFar }: QueuedRequestData): void {\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            return\n        }\n\n        xhr({\n            url,\n            data: data || {},\n            options: options || {},\n            headers: headers || {},\n            retriesPerformedSoFar: retriesPerformedSoFar || 0,\n            callback,\n            retryQueue: this,\n            onXHRError: this.onXHRError,\n            onResponse: this.rateLimiter.checkForLimiting,\n        })\n    }\n\n    _handleWeAreNowOnline(): void {\n        this.areWeOnline = true\n        this.flush()\n    }\n}\n", "import { PostHogPersistence } from './posthog-persistence'\nimport { SESSION_ID } from './constants'\nimport { sessionStore } from './storage'\nimport { PostHogConfig, SessionIdChangedCallback } from './types'\nimport { uuidv7 } from './uuidv7'\nimport { window } from './utils/globals'\n\nimport { _isArray, _isNumber, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\nconst MAX_SESSION_IDLE_TIMEOUT = 30 * 60 // 30 minutes\nconst MIN_SESSION_IDLE_TIMEOUT = 60 // 1 minute\nconst SESSION_LENGTH_LIMIT = 24 * 3600 * 1000 // 24 hours\n\nexport class SessionIdManager {\n    private readonly _sessionIdGenerator: () => string\n    private readonly _windowIdGenerator: () => string\n    private config: Partial<PostHogConfig>\n    private persistence: PostHogPersistence\n    private _windowId: string | null | undefined\n    private _sessionId: string | null | undefined\n    private readonly _window_id_storage_key: string\n    private readonly _primary_window_exists_storage_key: string\n    private _sessionStartTimestamp: number | null\n\n    private _sessionActivityTimestamp: number | null\n    private readonly _sessionTimeoutMs: number\n    private _sessionIdChangedHandlers: SessionIdChangedCallback[] = []\n\n    constructor(\n        config: Partial<PostHogConfig>,\n        persistence: PostHogPersistence,\n        sessionIdGenerator?: () => string,\n        windowIdGenerator?: () => string\n    ) {\n        this.config = config\n        this.persistence = persistence\n        this._windowId = undefined\n        this._sessionId = undefined\n        this._sessionStartTimestamp = null\n        this._sessionActivityTimestamp = null\n        this._sessionIdGenerator = sessionIdGenerator || uuidv7\n        this._windowIdGenerator = windowIdGenerator || uuidv7\n\n        const persistenceName = config['persistence_name'] || config['token']\n        let desiredTimeout = config['session_idle_timeout_seconds'] || MAX_SESSION_IDLE_TIMEOUT\n\n        if (!_isNumber(desiredTimeout)) {\n            logger.warn('session_idle_timeout_seconds must be a number. Defaulting to 30 minutes.')\n            desiredTimeout = MAX_SESSION_IDLE_TIMEOUT\n        } else if (desiredTimeout > MAX_SESSION_IDLE_TIMEOUT) {\n            logger.warn('session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead.')\n        } else if (desiredTimeout < MIN_SESSION_IDLE_TIMEOUT) {\n            logger.warn('session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead.')\n        }\n\n        this._sessionTimeoutMs =\n            Math.min(Math.max(desiredTimeout, MIN_SESSION_IDLE_TIMEOUT), MAX_SESSION_IDLE_TIMEOUT) * 1000\n        this._window_id_storage_key = 'ph_' + persistenceName + '_window_id'\n        this._primary_window_exists_storage_key = 'ph_' + persistenceName + '_primary_window_exists'\n\n        // primary_window_exists is set when the DOM has been loaded and is cleared on unload\n        // if it exists here it means there was no unload which suggests this window is opened as a tab duplication, window.open, etc.\n        if (this._canUseSessionStorage()) {\n            const lastWindowId = sessionStore.parse(this._window_id_storage_key)\n\n            const primaryWindowExists = sessionStore.parse(this._primary_window_exists_storage_key)\n            if (lastWindowId && !primaryWindowExists) {\n                // Persist window from previous storage state\n                this._windowId = lastWindowId\n            } else {\n                // Wipe any reference to previous window id\n                sessionStore.remove(this._window_id_storage_key)\n            }\n            // Flag this session as having a primary window\n            sessionStore.set(this._primary_window_exists_storage_key, true)\n        }\n\n        this._listenToReloadWindow()\n    }\n\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        // KLUDGE: when running in tests the handlers array was always undefined\n        // it's yucky but safe to set it here so that it's always definitely available\n        if (_isUndefined(this._sessionIdChangedHandlers)) {\n            this._sessionIdChangedHandlers = []\n        }\n\n        this._sessionIdChangedHandlers.push(callback)\n        if (this._sessionId) {\n            callback(this._sessionId, this._windowId)\n        }\n        return () => {\n            this._sessionIdChangedHandlers = this._sessionIdChangedHandlers.filter((h) => h !== callback)\n        }\n    }\n\n    private _canUseSessionStorage(): boolean {\n        // We only want to use sessionStorage if persistence is enabled and not memory storage\n        return this.config.persistence !== 'memory' && !this.persistence.disabled && sessionStore.is_supported()\n    }\n\n    // Note: this tries to store the windowId in sessionStorage. SessionStorage is unique to the current window/tab,\n    // and persists page loads/reloads. So it's uniquely suited for storing the windowId. This function also respects\n    // when persistence is disabled (by user config) and when sessionStorage is not supported (it *should* be supported on all browsers),\n    // and in that case, it falls back to memory (which sadly, won't persist page loads)\n    private _setWindowId(windowId: string): void {\n        if (windowId !== this._windowId) {\n            this._windowId = windowId\n            if (this._canUseSessionStorage()) {\n                sessionStore.set(this._window_id_storage_key, windowId)\n            }\n        }\n    }\n\n    private _getWindowId(): string | null {\n        if (this._windowId) {\n            return this._windowId\n        }\n        if (this._canUseSessionStorage()) {\n            return sessionStore.parse(this._window_id_storage_key)\n        }\n        // New window id will be generated\n        return null\n    }\n\n    // Note: 'this.persistence.register' can be disabled in the config.\n    // In that case, this works by storing sessionId and the timestamp in memory.\n    private _setSessionId(\n        sessionId: string | null,\n        sessionActivityTimestamp: number | null,\n        sessionStartTimestamp: number | null\n    ): void {\n        if (\n            sessionId !== this._sessionId ||\n            sessionActivityTimestamp !== this._sessionActivityTimestamp ||\n            sessionStartTimestamp !== this._sessionStartTimestamp\n        ) {\n            this._sessionStartTimestamp = sessionStartTimestamp\n            this._sessionActivityTimestamp = sessionActivityTimestamp\n            this._sessionId = sessionId\n\n            this.persistence.register({\n                [SESSION_ID]: [sessionActivityTimestamp, sessionId, sessionStartTimestamp],\n            })\n        }\n    }\n\n    private _getSessionId(): [number, string, number] {\n        if (this._sessionId && this._sessionActivityTimestamp && this._sessionStartTimestamp) {\n            return [this._sessionActivityTimestamp, this._sessionId, this._sessionStartTimestamp]\n        }\n        const sessionId = this.persistence.props[SESSION_ID]\n\n        if (_isArray(sessionId) && sessionId.length === 2) {\n            // Storage does not yet have a session start time. Add the last activity timestamp as the start time\n            sessionId.push(sessionId[0])\n        }\n\n        return sessionId || [0, null, 0]\n    }\n\n    // Resets the session id by setting it to null. On the subsequent call to checkAndGetSessionAndWindowId,\n    // new ids will be generated.\n    resetSessionId(): void {\n        this._setSessionId(null, null, null)\n    }\n\n    /*\n     * Listens to window unloads and removes the primaryWindowExists key from sessionStorage.\n     * Reloaded or fresh tabs created after a DOM unloads (reloading the same tab) WILL NOT have this primaryWindowExists flag in session storage.\n     * Cloned sessions (new tab, tab duplication, window.open(), ...) WILL have this primaryWindowExists flag in their copied session storage.\n     * We conditionally check the primaryWindowExists value in the constructor to decide if the window id in the last session storage should be carried over.\n     */\n    private _listenToReloadWindow(): void {\n        window?.addEventListener('beforeunload', () => {\n            if (this._canUseSessionStorage()) {\n                sessionStore.remove(this._primary_window_exists_storage_key)\n            }\n        })\n    }\n\n    /*\n     * This function returns the current sessionId and windowId. It should be used to\n     * access these values over directly calling `._sessionId` or `._windowId`.\n     * In addition to returning the sessionId and windowId, this function also manages cycling the\n     * sessionId and windowId when appropriate by doing the following:\n     *\n     * 1. If the sessionId or windowId is not set, it will generate a new one and store it.\n     * 2. If the readOnly param is set to false, it will:\n     *    a. Check if it has been > SESSION_CHANGE_THRESHOLD since the last call with this flag set.\n     *       If so, it will generate a new sessionId and store it.\n     *    b. Update the timestamp stored with the sessionId to ensure the current session is extended\n     *       for the appropriate amount of time.\n     *\n     * @param {boolean} readOnly (optional) Defaults to False. Should be set to True when the call to the function should not extend or cycle the session (e.g. being called for non-user generated events)\n     * @param {Number} timestamp (optional) Defaults to the current time. The timestamp to be stored with the sessionId (used when determining if a new sessionId should be generated)\n     */\n    checkAndGetSessionAndWindowId(readOnly = false, _timestamp: number | null = null) {\n        const timestamp = _timestamp || new Date().getTime()\n\n        // eslint-disable-next-line prefer-const\n        let [lastTimestamp, sessionId, startTimestamp] = this._getSessionId()\n        let windowId = this._getWindowId()\n\n        const sessionPastMaximumLength =\n            startTimestamp && startTimestamp > 0 && Math.abs(timestamp - startTimestamp) > SESSION_LENGTH_LIMIT\n\n        let valuesChanged = false\n        const noSessionId = !sessionId\n        const activityTimeout = !readOnly && Math.abs(timestamp - lastTimestamp) > this._sessionTimeoutMs\n        if (noSessionId || activityTimeout || sessionPastMaximumLength) {\n            sessionId = this._sessionIdGenerator()\n            windowId = this._windowIdGenerator()\n            startTimestamp = timestamp\n            valuesChanged = true\n        } else if (!windowId) {\n            windowId = this._windowIdGenerator()\n            valuesChanged = true\n        }\n\n        const newTimestamp = lastTimestamp === 0 || !readOnly || sessionPastMaximumLength ? timestamp : lastTimestamp\n        const sessionStartTimestamp = startTimestamp === 0 ? new Date().getTime() : startTimestamp\n\n        this._setWindowId(windowId)\n        this._setSessionId(sessionId, newTimestamp, sessionStartTimestamp)\n\n        if (valuesChanged) {\n            this._sessionIdChangedHandlers.forEach((handler) => handler(sessionId, windowId))\n        }\n\n        return {\n            sessionId,\n            windowId,\n            sessionStartTimestamp,\n        }\n    }\n}\n", "/**\n * Integrate Sentry with PostHog. This will add a direct link to the person in Sentry, and an $exception event in PostHog\n *\n * ### Usage\n *\n *     Sentry.init({\n *          dsn: 'https://example',\n *          integrations: [\n *              new posthog.SentryIntegration(posthog)\n *          ]\n *     })\n *\n * @param {Object} [posthog] The posthog object\n * @param {string} [organization] Optional: The Sentry organization, used to send a direct link from PostHog to Sentry\n * @param {Number} [projectId] Optional: The Sentry project id, used to send a direct link from PostHog to Sentry\n * @param {string} [prefix] Optional: Url of a self-hosted sentry instance (default: https://sentry.io/organizations/)\n */\n\nimport { PostHog } from '../posthog-core'\n\n// NOTE - we can't import from @sentry/types because it changes frequently and causes clashes\n// We only use a small subset of the types, so we can just define the integration overall and use any for the rest\n\n// import {\n//     Event as _SentryEvent,\n//     EventProcessor as _SentryEventProcessor,\n//     Hub as _SentryHub,\n//     Integration as _SentryIntegration,\n// } from '@sentry/types'\n\n// Uncomment the above and comment the below to get type checking for development\n\ntype _SentryEvent = any\ntype _SentryEventProcessor = any\ntype _SentryHub = any\n\ninterface _SentryIntegration {\n    name: string\n    setupOnce(addGlobalEventProcessor: (callback: _SentryEventProcessor) => void, getCurrentHub: () => _SentryHub): void\n}\n\ninterface SentryExceptionProperties {\n    $sentry_event_id: any\n    $sentry_exception: any\n    $sentry_exception_message: any\n    $sentry_exception_type: any\n    $sentry_tags: any\n    $sentry_url?: string\n}\n\nexport class SentryIntegration implements _SentryIntegration {\n    name: string\n\n    setupOnce: (\n        addGlobalEventProcessor: (callback: _SentryEventProcessor) => void,\n        getCurrentHub: () => _SentryHub\n    ) => void\n\n    constructor(_posthog: PostHog, organization?: string, projectId?: number, prefix?: string) {\n        // setupOnce gets called by Sentry when it intializes the plugin\n        this.name = 'posthog-js'\n        this.setupOnce = function (addGlobalEventProcessor: (callback: _SentryEventProcessor) => void) {\n            addGlobalEventProcessor((event: _SentryEvent) => {\n                if (event.level !== 'error' || !_posthog.__loaded) return event\n                if (!event.tags) event.tags = {}\n\n                const host = _posthog.config.ui_host || _posthog.config.api_host\n                event.tags['PostHog Person URL'] = host + '/person/' + _posthog.get_distinct_id()\n                if (_posthog.sessionRecordingStarted()) {\n                    event.tags['PostHog Recording URL'] = _posthog.get_session_replay_url({ withTimestamp: true })\n                }\n\n                const exceptions = event.exception?.values || []\n\n                const data: SentryExceptionProperties & {\n                    // two properties added to match any exception auto-capture\n                    // added manually to avoid any dependency on the lazily loaded content\n                    $exception_message: any\n                    $exception_type: any\n                    $exception_personURL: string\n                } = {\n                    // PostHog Exception Properties,\n                    $exception_message: exceptions[0]?.value,\n                    $exception_type: exceptions[0]?.type,\n                    $exception_personURL: host + '/person/' + _posthog.get_distinct_id(),\n                    // Sentry Exception Properties\n                    $sentry_event_id: event.event_id,\n                    $sentry_exception: event.exception,\n                    $sentry_exception_message: exceptions[0]?.value,\n                    $sentry_exception_type: exceptions[0]?.type,\n                    $sentry_tags: event.tags,\n                }\n\n                if (organization && projectId)\n                    data['$sentry_url'] =\n                        (prefix || 'https://sentry.io/organizations/') +\n                        organization +\n                        '/issues/?project=' +\n                        projectId +\n                        '&query=' +\n                        event.event_id\n                _posthog.capture('$exception', data)\n                return event\n            })\n        }\n    }\n}\n", "/**\n * Extend Segment with extra PostHog JS functionality. Required for things like Recordings and feature flags to work correctly.\n *\n * ### Usage\n *\n *  ```js\n *  // After your standard segment anyalytics install\n *  analytics.load(\"GOEDfA21zZTtR7clsBuDvmBKAtAdZ6Np\");\n *\n *  analytics.ready(() => {\n *    posthog.init('<posthog-api-key>', {\n *      capture_pageview: false,\n *      segment: window.analytics, // NOTE: Be sure to use window.analytics here!\n *    });\n *    window.analytics.page();\n *  })\n *  ```\n */\nimport { PostHog } from '../posthog-core'\nimport { logger } from '../utils/logger'\n\n// Loosely based on https://github.com/segmentio/analytics-next/blob/master/packages/core/src/plugins/index.ts\ninterface SegmentPluginContext {\n    event: {\n        event: string\n        userId?: string\n        anonymousId?: string\n        properties: any\n    }\n}\n\ninterface SegmentPlugin {\n    name: string\n    version: string\n    type: 'enrichment'\n    isLoaded: () => boolean\n    load: (ctx: SegmentPluginContext, instance: any, config?: any) => Promise<unknown>\n    unload?: (ctx: SegmentPluginContext, instance: any) => Promise<unknown> | unknown\n    ready?: () => Promise<unknown>\n    track?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    identify?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    page?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    group?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    alias?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    screen?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n}\n\nexport const createSegmentIntegration = (posthog: PostHog): SegmentPlugin => {\n    if (!Promise || !Promise.resolve) {\n        logger.warn('This browser does not have Promise support, and can not use the segment integration')\n    }\n\n    const enrichEvent = (ctx: SegmentPluginContext, eventName: string) => {\n        if (!ctx.event.userId && ctx.event.anonymousId !== posthog.get_distinct_id()) {\n            // This is our only way of detecting that segment's analytics.reset() has been called so we also call it\n            posthog.reset()\n        }\n        if (ctx.event.userId && ctx.event.userId !== posthog.get_distinct_id()) {\n            posthog.register({\n                distinct_id: ctx.event.userId,\n            })\n            posthog.reloadFeatureFlags()\n        }\n\n        const additionalProperties = posthog._calculate_event_properties(eventName, ctx.event.properties)\n        ctx.event.properties = Object.assign({}, additionalProperties, ctx.event.properties)\n        return ctx\n    }\n\n    return {\n        name: 'PostHog JS',\n        type: 'enrichment',\n        version: '1.0.0',\n        isLoaded: () => true,\n        // check and early return above\n        // eslint-disable-next-line compat/compat\n        load: () => Promise.resolve(),\n        track: (ctx) => enrichEvent(ctx, ctx.event.event),\n        page: (ctx) => enrichEvent(ctx, '$pageview'),\n        identify: (ctx) => enrichEvent(ctx, '$identify'),\n        screen: (ctx) => enrichEvent(ctx, '$screen'),\n    }\n}\n", "import { window } from './utils/globals'\n\ninterface PageViewData {\n    pathname: string\n    // scroll is how far down the page the user has scrolled,\n    // content is how far down the page the user can view content\n    // (e.g. if the page is 1000 tall, but the user's screen is only 500 tall,\n    // and they don't scroll at all, then scroll is 0 and content is 500)\n    maxScrollHeight?: number\n    maxScrollY?: number\n    lastScrollY?: number\n    maxContentHeight?: number\n    maxContentY?: number\n    lastContentY?: number\n}\n\ninterface ScrollProperties {\n    $prev_pageview_last_scroll?: number\n    $prev_pageview_last_scroll_percentage?: number\n    $prev_pageview_max_scroll?: number\n    $prev_pageview_max_scroll_percentage?: number\n    $prev_pageview_last_content?: number\n    $prev_pageview_last_content_percentage?: number\n    $prev_pageview_max_content?: number\n    $prev_pageview_max_content_percentage?: number\n}\n\ninterface PageViewEventProperties extends ScrollProperties {\n    $prev_pageview_pathname?: string\n}\n\nexport class PageViewManager {\n    _pageViewData: PageViewData | undefined\n    _hasSeenPageView = false\n\n    _createPageViewData(): PageViewData {\n        return {\n            pathname: window?.location.pathname ?? '',\n        }\n    }\n\n    doPageView(): PageViewEventProperties {\n        let prevPageViewData: PageViewData | undefined\n        // if there were events created before the first PageView, we would have created a\n        // pageViewData for them. If this happened, we don't want to create a new pageViewData\n        if (!this._hasSeenPageView) {\n            this._hasSeenPageView = true\n            prevPageViewData = undefined\n            if (!this._pageViewData) {\n                this._pageViewData = this._createPageViewData()\n            }\n        } else {\n            prevPageViewData = this._pageViewData\n            this._pageViewData = this._createPageViewData()\n        }\n\n        // update the scroll properties for the new page, but wait until the next tick\n        // of the event loop\n        setTimeout(this._updateScrollData, 0)\n\n        return {\n            $prev_pageview_pathname: prevPageViewData?.pathname,\n            ...this._calculatePrevPageScrollProperties(prevPageViewData),\n        }\n    }\n\n    doPageLeave(): PageViewEventProperties {\n        const prevPageViewData = this._pageViewData\n        return {\n            $prev_pageview_pathname: prevPageViewData?.pathname,\n            ...this._calculatePrevPageScrollProperties(prevPageViewData),\n        }\n    }\n\n    _calculatePrevPageScrollProperties(prevPageViewData: PageViewData | undefined): ScrollProperties {\n        if (\n            !prevPageViewData ||\n            prevPageViewData.maxScrollHeight == null ||\n            prevPageViewData.lastScrollY == null ||\n            prevPageViewData.maxScrollY == null ||\n            prevPageViewData.maxContentHeight == null ||\n            prevPageViewData.lastContentY == null ||\n            prevPageViewData.maxContentY == null\n        ) {\n            return {}\n        }\n\n        let { maxScrollHeight, lastScrollY, maxScrollY, maxContentHeight, lastContentY, maxContentY } = prevPageViewData\n\n        // Use ceil, so that e.g. scrolling 999.5px of a 1000px page is considered 100% scrolled\n        maxScrollHeight = Math.ceil(maxScrollHeight)\n        lastScrollY = Math.ceil(lastScrollY)\n        maxScrollY = Math.ceil(maxScrollY)\n        maxContentHeight = Math.ceil(maxContentHeight)\n        lastContentY = Math.ceil(lastContentY)\n        maxContentY = Math.ceil(maxContentY)\n\n        // if the maximum scroll height is near 0, then the percentage is 1\n        const lastScrollPercentage = maxScrollHeight <= 1 ? 1 : clamp(lastScrollY / maxScrollHeight, 0, 1)\n        const maxScrollPercentage = maxScrollHeight <= 1 ? 1 : clamp(maxScrollY / maxScrollHeight, 0, 1)\n        const lastContentPercentage = maxContentHeight <= 1 ? 1 : clamp(lastContentY / maxContentHeight, 0, 1)\n        const maxContentPercentage = maxContentHeight <= 1 ? 1 : clamp(maxContentY / maxContentHeight, 0, 1)\n\n        return {\n            $prev_pageview_last_scroll: lastScrollY,\n            $prev_pageview_last_scroll_percentage: lastScrollPercentage,\n            $prev_pageview_max_scroll: maxScrollY,\n            $prev_pageview_max_scroll_percentage: maxScrollPercentage,\n            $prev_pageview_last_content: lastContentY,\n            $prev_pageview_last_content_percentage: lastContentPercentage,\n            $prev_pageview_max_content: maxContentY,\n            $prev_pageview_max_content_percentage: maxContentPercentage,\n        }\n    }\n\n    _updateScrollData = () => {\n        if (!this._pageViewData) {\n            this._pageViewData = this._createPageViewData()\n        }\n        const pageViewData = this._pageViewData\n\n        const scrollY = this._scrollY()\n        const scrollHeight = this._scrollHeight()\n        const contentY = this._contentY()\n        const contentHeight = this._contentHeight()\n\n        pageViewData.lastScrollY = scrollY\n        pageViewData.maxScrollY = Math.max(scrollY, pageViewData.maxScrollY ?? 0)\n        pageViewData.maxScrollHeight = Math.max(scrollHeight, pageViewData.maxScrollHeight ?? 0)\n\n        pageViewData.lastContentY = contentY\n        pageViewData.maxContentY = Math.max(contentY, pageViewData.maxContentY ?? 0)\n        pageViewData.maxContentHeight = Math.max(contentHeight, pageViewData.maxContentHeight ?? 0)\n    }\n\n    startMeasuringScrollPosition() {\n        window?.addEventListener('scroll', this._updateScrollData)\n        window?.addEventListener('scrollend', this._updateScrollData)\n        window?.addEventListener('resize', this._updateScrollData)\n    }\n\n    stopMeasuringScrollPosition() {\n        window?.removeEventListener('scroll', this._updateScrollData)\n        window?.removeEventListener('scrollend', this._updateScrollData)\n        window?.removeEventListener('resize', this._updateScrollData)\n    }\n\n    _scrollHeight(): number {\n        return window\n            ? Math.max(0, window.document.documentElement.scrollHeight - window.document.documentElement.clientHeight)\n            : 0\n    }\n\n    _scrollY(): number {\n        return window ? window.scrollY || window.pageYOffset || window.document.documentElement.scrollTop || 0 : 0\n    }\n\n    _contentHeight(): number {\n        return window?.document.documentElement.scrollHeight || 0\n    }\n\n    _contentY(): number {\n        const clientHeight = window?.document.documentElement.clientHeight || 0\n        return this._scrollY() + clientHeight\n    }\n}\n\nfunction clamp(x: number, min: number, max: number) {\n    return Math.max(min, Math.min(x, max))\n}\n", "import { PostHog } from './posthog-core'\nimport { SURVEYS } from './constants'\nimport { SurveyCallback, SurveyUrlMatchType } from './posthog-surveys-types'\nimport { _isUrlMatchingRegex } from './utils/request-utils'\nimport { window, document } from './utils/globals'\n\nexport const surveyUrlValidationMap: Record<SurveyUrlMatchType, (conditionsUrl: string) => boolean> = {\n    icontains: (conditionsUrl) =>\n        !!window && window.location.href.toLowerCase().indexOf(conditionsUrl.toLowerCase()) > -1,\n    regex: (conditionsUrl) => !!window && _isUrlMatchingRegex(window.location.href, conditionsUrl),\n    exact: (conditionsUrl) => window?.location.href === conditionsUrl,\n}\n\nexport class PostHogSurveys {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    getSurveys(callback: SurveyCallback, forceReload = false) {\n        const existingSurveys = this.instance.get_property(SURVEYS)\n        if (!existingSurveys || forceReload) {\n            this.instance._send_request(\n                `${this.instance.config.api_host}/api/surveys/?token=${this.instance.config.token}`,\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const surveys = response.surveys || []\n                    this.instance.persistence?.register({ [SURVEYS]: surveys })\n                    return callback(surveys)\n                }\n            )\n        } else {\n            return callback(existingSurveys)\n        }\n    }\n\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false) {\n        this.getSurveys((surveys) => {\n            const activeSurveys = surveys.filter((survey) => {\n                return !!(survey.start_date && !survey.end_date)\n            })\n            const conditionMatchedSurveys = activeSurveys.filter((survey) => {\n                if (!survey.conditions) {\n                    return true\n                }\n\n                // use urlMatchType to validate url condition, fallback to contains for backwards compatibility\n                const urlCheck = survey.conditions?.url\n                    ? surveyUrlValidationMap[survey.conditions?.urlMatchType ?? 'icontains'](survey.conditions.url)\n                    : true\n                const selectorCheck = survey.conditions?.selector\n                    ? document?.querySelector(survey.conditions.selector)\n                    : true\n                return urlCheck && selectorCheck\n            })\n            const targetingMatchedSurveys = conditionMatchedSurveys.filter((survey) => {\n                if (!survey.linked_flag_key && !survey.targeting_flag_key) {\n                    return true\n                }\n                const linkedFlagCheck = survey.linked_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.linked_flag_key)\n                    : true\n                const targetingFlagCheck = survey.targeting_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.targeting_flag_key)\n                    : true\n                return linkedFlagCheck && targetingFlagCheck\n            })\n\n            return callback(targetingMatchedSurveys)\n        }, forceReload)\n    }\n}\n", "import Config from './config'\nimport {\n    _copyAndTruncateStrings,\n    _each,\n    _eachArray,\n    _extend,\n    _register_event,\n    _safewrap_class,\n    isCrossDomainCookie,\n    isDistinctIdStringLike,\n} from './utils'\nimport { assignableWindow, window } from './utils/globals'\nimport { autocapture } from './autocapture'\nimport { PostHogFeatureFlags } from './posthog-featureflags'\nimport { PostHogPersistence } from './posthog-persistence'\nimport { ALIAS_ID_KEY, FLAG_CALL_REPORTED, PEOPLE_DISTINCT_ID_KEY } from './constants'\nimport { SessionRecording } from './extensions/replay/sessionrecording'\nimport { Decide } from './decide'\nimport { Toolbar } from './extensions/toolbar'\nimport { clearOptInOut, hasOptedIn, hasOptedOut, optIn, optOut, userOptedOut } from './gdpr-utils'\nimport { cookieStore, localStore } from './storage'\nimport { RequestQueue } from './request-queue'\nimport { compressData, decideCompression } from './compression'\nimport { addParamsToURL, encodePostData, xhr } from './send-request'\nimport { RetryQueue } from './retry-queue'\nimport { SessionIdManager } from './sessionid'\nimport {\n    AutocaptureConfig,\n    CaptureOptions,\n    CaptureResult,\n    Compression,\n    DecideResponse,\n    EarlyAccessFeatureCallback,\n    GDPROptions,\n    isFeatureEnabledOptions,\n    JSC,\n    JsonType,\n    OptInOutCapturingOptions,\n    PostHogConfig,\n    Properties,\n    Property,\n    RequestCallback,\n    SessionIdChangedCallback,\n    SnippetArrayItem,\n    ToolbarParams,\n    XHROptions,\n} from './types'\nimport { SentryIntegration } from './extensions/sentry-integration'\nimport { createSegmentIntegration } from './extensions/segment-integration'\nimport { PageViewManager } from './page-view'\nimport { PostHogSurveys } from './posthog-surveys'\nimport { RateLimiter } from './rate-limiter'\nimport { uuidv7 } from './uuidv7'\nimport { SurveyCallback } from './posthog-surveys-types'\nimport { _isArray, _isEmptyObject, _isFunction, _isObject, _isString, _isUndefined } from './utils/type-utils'\nimport { _info } from './utils/event-utils'\nimport { logger } from './utils/logger'\nimport { document, userAgent } from './utils/globals'\nimport { SessionPropsManager } from './session-props'\nimport { _isBlockedUA } from './utils/blocked-uas'\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x === public function\nthis._x === internal - only use within this file\nthis.__x === private - only use within the class\n\nGlobals should be all caps\n*/\n\nenum InitType {\n    INIT_MODULE = 0,\n    INIT_SNIPPET = 1,\n}\n\nlet init_type: InitType\n\n// TODO: the type of this is very loose. Sometimes it's also PostHogLib itself\nlet posthog_master: Record<string, PostHog> & {\n    init: (token: string, config: Partial<PostHogConfig>, name: string) => void\n}\n\n// some globals for comparisons\nconst __NOOP = () => {}\nconst __NOOPTIONS = {}\n\nconst PRIMARY_INSTANCE_NAME = 'posthog'\n\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n// http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n// https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\nconst USE_XHR = window?.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()\n\n// IE<10 does not support cross-origin XHR's but script tags\n// with defer won't block window.onload; ENQUEUE_REQUESTS\n// should only be true for Opera<12\nlet ENQUEUE_REQUESTS = !USE_XHR && userAgent?.indexOf('MSIE') === -1 && userAgent?.indexOf('Mozilla') === -1\n\nexport const defaultConfig = (): PostHogConfig => ({\n    api_host: 'https://app.posthog.com',\n    api_method: 'POST',\n    api_transport: 'XHR',\n    ui_host: null,\n    token: '',\n    autocapture: true,\n    rageclick: true,\n    cross_subdomain_cookie: isCrossDomainCookie(document?.location),\n    persistence: 'localStorage+cookie', // up to 1.92.0 this was 'cookie'. It's easy to migrate as 'localStorage+cookie' will migrate data from cookie storage\n    persistence_name: '',\n    cookie_name: '',\n    loaded: __NOOP,\n    store_google: true,\n    custom_campaign_params: [],\n    custom_blocked_useragents: [],\n    save_referrer: true,\n    capture_pageview: true,\n    capture_pageleave: true, // We'll only capture pageleave events if capture_pageview is also true\n    debug: false,\n    verbose: false,\n    cookie_expiration: 365,\n    upgrade: false,\n    disable_session_recording: false,\n    disable_persistence: false,\n    disable_cookie: false,\n    enable_recording_console_log: undefined, // When undefined, it falls back to the server-side setting\n    secure_cookie: window?.location?.protocol === 'https:',\n    ip: true,\n    opt_out_capturing_by_default: false,\n    opt_out_persistence_by_default: false,\n    opt_out_capturing_persistence_type: 'localStorage',\n    opt_out_capturing_cookie_prefix: null,\n    opt_in_site_apps: false,\n    property_blacklist: [],\n    respect_dnt: false,\n    sanitize_properties: null,\n    xhr_headers: {}, // { header: value, header2: value }\n    inapp_protocol: '//',\n    inapp_link_new_window: false,\n    request_batching: true,\n    properties_string_max_length: 65535,\n    session_recording: {},\n    mask_all_element_attributes: false,\n    mask_all_text: false,\n    advanced_disable_decide: false,\n    advanced_disable_feature_flags: false,\n    advanced_disable_feature_flags_on_first_load: false,\n    advanced_disable_toolbar_metrics: false,\n    on_xhr_error: (req) => {\n        const error = 'Bad HTTP status: ' + req.status + ' ' + req.statusText\n        logger.error(error)\n    },\n    get_device_id: (uuid) => uuid,\n    // Used for internal testing\n    _onCapture: __NOOP,\n    capture_performance: undefined,\n    name: 'posthog',\n    callback_fn: 'posthog._jsc',\n    bootstrap: {},\n    disable_compression: false,\n    session_idle_timeout_seconds: 30 * 60, // 30 minutes\n})\n\n/**\n * create_phlib(token:string, config:object, name:string)\n *\n * This function is used by the init method of PostHogLib objects\n * as well as the main initializer at the end of the JSLib (that\n * initializes document.posthog as well as any additional instances\n * declared before this file has loaded).\n */\nconst create_phlib = function (\n    token: string,\n    config?: Partial<PostHogConfig>,\n    name?: string,\n    createComplete?: (instance: PostHog) => void\n): PostHog {\n    let instance: PostHog\n    const target =\n        name === PRIMARY_INSTANCE_NAME || !posthog_master ? posthog_master : name ? posthog_master[name] : undefined\n    const callbacksHandled = {\n        initComplete: false,\n        syncCode: false,\n    }\n    const handleCallback = (callbackName: keyof typeof callbacksHandled) => (instance: PostHog) => {\n        if (!callbacksHandled[callbackName]) {\n            callbacksHandled[callbackName] = true\n            if (callbacksHandled.initComplete && callbacksHandled.syncCode) {\n                createComplete?.(instance)\n            }\n        }\n    }\n\n    if (target && init_type === InitType.INIT_MODULE) {\n        instance = target as any\n    } else {\n        if (target && !_isArray(target)) {\n            logger.error('You have already initialized ' + name)\n            // TODO: throw something instead?\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return\n        }\n        instance = new PostHog()\n    }\n\n    instance._init(token, config, name, handleCallback('initComplete'))\n    instance.toolbar.maybeLoadToolbar()\n\n    instance.sessionRecording = new SessionRecording(instance)\n    instance.sessionRecording.startRecordingIfEnabled()\n\n    if (instance.config.__preview_measure_pageview_stats) {\n        instance.pageViewManager.startMeasuringScrollPosition()\n    }\n\n    instance.__autocapture = instance.config.autocapture\n    autocapture._setIsAutocaptureEnabled(instance)\n    if (autocapture._isAutocaptureEnabled) {\n        instance.__autocapture = instance.config.autocapture\n        const num_buckets = 100\n        const num_enabled_buckets = 100\n        if (!autocapture.enabledForProject(instance.config.token, num_buckets, num_enabled_buckets)) {\n            instance.__autocapture = false\n            logger.info('Not in active bucket: disabling Automatic Event Collection.')\n        } else if (!autocapture.isBrowserSupported()) {\n            instance.__autocapture = false\n            logger.info('Disabling Automatic Event Collection because this browser is not supported')\n        } else {\n            autocapture.init(instance)\n        }\n    }\n\n    // if any instance on the page has debug = true, we set the\n    // global debug to be true\n    Config.DEBUG = Config.DEBUG || instance.config.debug\n\n    // if target is not defined, we called init after the lib already\n    // loaded, so there won't be an array of things to execute\n    if (!_isUndefined(target) && _isArray(target)) {\n        // Crunch through the people queue first - we queue this data up &\n        // flush on identify, so it's better to do all these operations first\n        instance._execute_array.call(instance.people, (target as any).people)\n        instance._execute_array(target)\n    }\n\n    handleCallback('syncCode')(instance)\n    return instance\n}\n\nclass DeprecatedWebPerformanceObserver {\n    get _forceAllowLocalhost(): boolean {\n        return this.__forceAllowLocalhost\n    }\n    set _forceAllowLocalhost(value: boolean) {\n        logger.error(\n            'WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`'\n        )\n        this.__forceAllowLocalhost = value\n    }\n    private __forceAllowLocalhost: boolean = false\n}\n\n/**\n * PostHog Library Object\n * @constructor\n */\nexport class PostHog {\n    __loaded: boolean\n    __loaded_recorder_version: 'v1' | 'v2' | undefined // flag that keeps track of which version of recorder is loaded\n    config: PostHogConfig\n\n    rateLimiter: RateLimiter\n    pageViewManager: PageViewManager\n    featureFlags: PostHogFeatureFlags\n    surveys: PostHogSurveys\n    toolbar: Toolbar\n\n    // These are instance-specific state created after initialisation\n    persistence?: PostHogPersistence\n    sessionPersistence?: PostHogPersistence\n    sessionManager?: SessionIdManager\n    sessionPropsManager?: SessionPropsManager\n\n    _requestQueue?: RequestQueue\n    _retryQueue?: RetryQueue\n    sessionRecording?: SessionRecording\n    webPerformance = new DeprecatedWebPerformanceObserver()\n\n    _triggered_notifs: any\n    compression: Partial<Record<Compression, boolean>>\n    _jsc: JSC\n    __captureHooks: ((eventName: string) => void)[]\n    __request_queue: [url: string, data: Record<string, any>, options: XHROptions, callback?: RequestCallback][]\n    __autocapture: boolean | AutocaptureConfig | undefined\n    decideEndpointWasHit: boolean\n    analyticsDefaultEndpoint: string\n    elementsChainAsString: boolean\n\n    SentryIntegration: typeof SentryIntegration\n    segmentIntegration: () => any\n\n    /** DEPRECATED: We keep this to support existing usage but now one should just call .setPersonProperties */\n    people: {\n        set: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n        set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n    }\n\n    constructor() {\n        this.config = defaultConfig()\n        this.compression = {}\n        this.decideEndpointWasHit = false\n        this.SentryIntegration = SentryIntegration\n        this.segmentIntegration = () => createSegmentIntegration(this)\n        this.__captureHooks = []\n        this.__request_queue = []\n        this.__loaded = false\n        this.__loaded_recorder_version = undefined\n        this.__autocapture = undefined\n        this._jsc = function () {} as JSC\n        this.analyticsDefaultEndpoint = '/e/'\n        this.elementsChainAsString = false\n\n        this.featureFlags = new PostHogFeatureFlags(this)\n        this.toolbar = new Toolbar(this)\n        this.pageViewManager = new PageViewManager()\n        this.surveys = new PostHogSurveys(this)\n        this.rateLimiter = new RateLimiter()\n\n        // NOTE: See the property definition for deprecation notice\n        this.people = {\n            set: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = _isString(prop) ? { [prop]: to } : prop\n                this.setPersonProperties(setProps)\n                callback?.({})\n            },\n            set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = _isString(prop) ? { [prop]: to } : prop\n                this.setPersonProperties(undefined, setProps)\n                callback?.({})\n            },\n        }\n    }\n\n    // Initialization methods\n\n    /**\n     * This function initializes a new instance of the PostHog capturing object.\n     * All new instances are added to the main posthog object as sub properties (such as\n     * posthog.library_name) and also returned by this function. To define a\n     * second instance on the page, you would call:\n     *\n     *     posthog.init('new token', { your: 'config' }, 'library_name');\n     *\n     * and use it like so:\n     *\n     *     posthog.library_name.capture(...);\n     *\n     * @param {String} token   Your PostHog API token\n     * @param {Object} [config]  A dictionary of config options to override. <a href=\"https://github.com/posthog/posthog-js/blob/6e0e873/src/posthog-core.js#L57-L91\">See a list of default config options</a>.\n     * @param {String} [name]    The name for the new posthog instance that you want created\n     */\n    init(token: string, config?: Partial<PostHogConfig>, name?: string): PostHog | void {\n        if (_isUndefined(name)) {\n            logger.critical('You must name your new library: init(token, config, name)')\n            return\n        }\n        if (name === PRIMARY_INSTANCE_NAME) {\n            logger.critical(\n                'You must initialize the main posthog object right after you include the PostHog js snippet'\n            )\n            return\n        }\n\n        const instance: PostHog = create_phlib(token, config, name, (instance: PostHog) => {\n            posthog_master[name] = instance\n            instance._loaded()\n        })\n        posthog_master[name] = instance\n\n        return instance\n    }\n\n    // posthog._init(token:string, config:object, name:string)\n    //\n    // This function sets up the current instance of the posthog\n    // library.  The difference between this method and the init(...)\n    // method is this one initializes the actual instance, whereas the\n    // init(...) method sets up a new library and calls _init on it.\n    //\n    // Note that there are operations that can be asynchronous, so we\n    // accept a callback that is called when all the asynchronous work\n    // is done. Note that we do not use promises because we want to be\n    // IE11 compatible. We could use polyfills, which would make the\n    // code a bit cleaner, but will add some overhead.\n    //\n    _init(\n        token: string,\n        config: Partial<PostHogConfig> = {},\n        name?: string,\n        initComplete?: (instance: PostHog) => void\n    ): void {\n        this.__loaded = true\n        this.config = {} as PostHogConfig // will be set right below\n        this._triggered_notifs = []\n\n        // To avoid using Promises and their helper functions, we instead keep\n        // track of which callbacks have been called, and then call initComplete\n        // when all of them have been called. To add additional async code, add\n        // to `callbacksHandled` and pass updateInitComplete as a callback to\n        // the async code.\n        const callbacksHandled = { segmentRegister: false, syncCode: false }\n        const updateInitComplete = (callbackName: keyof typeof callbacksHandled) => () => {\n            // Update the register of callbacks that have been called, and if\n            // they have all been called, then we are ready to call\n            // initComplete.\n            if (!callbacksHandled[callbackName]) {\n                callbacksHandled[callbackName] = true\n                if (callbacksHandled.segmentRegister && callbacksHandled.syncCode) {\n                    initComplete?.(this)\n                }\n            }\n        }\n\n        this.set_config(\n            _extend({}, defaultConfig(), config, {\n                name: name,\n                token: token,\n                callback_fn: (name === PRIMARY_INSTANCE_NAME ? name : PRIMARY_INSTANCE_NAME + '.' + name) + '._jsc',\n            })\n        )\n\n        this._jsc = function () {} as JSC\n\n        // Check if recorder.js is already loaded\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        if (window?.rrweb?.record || window?.rrwebRecord) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            this.__loaded_recorder_version = window?.rrweb?.version\n        }\n\n        this.persistence = new PostHogPersistence(this.config)\n\n        this._requestQueue = new RequestQueue(this._handle_queued_event.bind(this))\n        this._retryQueue = new RetryQueue(this.config.on_xhr_error, this.rateLimiter)\n        this.__captureHooks = []\n        this.__request_queue = []\n\n        this.sessionManager = new SessionIdManager(this.config, this.persistence)\n        this.sessionPropsManager = new SessionPropsManager(this.sessionManager, this.persistence)\n        this.sessionPersistence =\n            this.config.persistence === 'sessionStorage'\n                ? this.persistence\n                : new PostHogPersistence({ ...this.config, persistence: 'sessionStorage' })\n\n        this._gdpr_init()\n\n        if (config.segment) {\n            // Use segments anonymousId instead\n            this.config.get_device_id = () => config.segment.user().anonymousId()\n\n            // If a segment user ID exists, set it as the distinct_id\n            if (config.segment.user().id()) {\n                this.register({\n                    distinct_id: config.segment.user().id(),\n                })\n                this.persistence.set_user_state('identified')\n            }\n\n            config.segment.register(this.segmentIntegration()).then(updateInitComplete('segmentRegister'))\n        } else {\n            updateInitComplete('segmentRegister')()\n        }\n\n        // isUndefined doesn't provide typehint here so wouldn't reduce bundle as we'd need to assign\n        // eslint-disable-next-line posthog-js/no-direct-undefined-check\n        if (config.bootstrap?.distinctID !== undefined) {\n            const uuid = this.config.get_device_id(uuidv7())\n            const deviceID = config.bootstrap?.isIdentifiedID ? uuid : config.bootstrap.distinctID\n            this.persistence.set_user_state(config.bootstrap?.isIdentifiedID ? 'identified' : 'anonymous')\n            this.register({\n                distinct_id: config.bootstrap.distinctID,\n                $device_id: deviceID,\n            })\n        }\n\n        if (this._hasBootstrappedFeatureFlags()) {\n            const activeFlags = Object.keys(config.bootstrap?.featureFlags || {})\n                .filter((flag) => !!config.bootstrap?.featureFlags?.[flag])\n                .reduce(\n                    (res: Record<string, string | boolean>, key) => (\n                        (res[key] = config.bootstrap?.featureFlags?.[key] || false), res\n                    ),\n                    {}\n                )\n            const featureFlagPayloads = Object.keys(config.bootstrap?.featureFlagPayloads || {})\n                .filter((key) => activeFlags[key])\n                .reduce((res: Record<string, JsonType>, key) => {\n                    if (config.bootstrap?.featureFlagPayloads?.[key]) {\n                        res[key] = config.bootstrap?.featureFlagPayloads?.[key]\n                    }\n                    return res\n                }, {})\n\n            this.featureFlags.receivedFeatureFlags({ featureFlags: activeFlags, featureFlagPayloads })\n        }\n\n        if (!this.get_distinct_id()) {\n            // There is no need to set the distinct id\n            // or the device id if something was already stored\n            // in the persitence\n            const uuid = this.config.get_device_id(uuidv7())\n            this.register_once(\n                {\n                    distinct_id: uuid,\n                    $device_id: uuid,\n                },\n                ''\n            )\n            // distinct id == $device_id is a proxy for anonymous user\n            this.persistence.set_user_state('anonymous')\n        }\n        // Set up event handler for pageleave\n        // Use `onpagehide` if available, see https://calendar.perfplanet.com/2020/beaconing-in-practice/#beaconing-reliability-avoiding-abandons\n        window?.addEventListener?.('onpagehide' in self ? 'pagehide' : 'unload', this._handle_unload.bind(this))\n\n        // Make sure that we also call the initComplete callback at the end of\n        // the synchronous code as well.\n        updateInitComplete('syncCode')()\n    }\n\n    // Private methods\n\n    _afterDecideResponse(response: DecideResponse) {\n        this.compression = {}\n        if (response.supportedCompression && !this.config.disable_compression) {\n            const compression: Partial<Record<Compression, boolean>> = {}\n            for (const method of response['supportedCompression']) {\n                compression[method] = true\n            }\n            this.compression = compression\n        }\n\n        if (response.analytics?.endpoint) {\n            this.analyticsDefaultEndpoint = response.analytics.endpoint\n        }\n\n        if (response.elementsChainAsString) {\n            this.elementsChainAsString = response.elementsChainAsString\n        }\n    }\n\n    _loaded(): void {\n        // Pause `reloadFeatureFlags` calls in config.loaded callback.\n        // These feature flags are loaded in the decide call made right\n        // afterwards\n        const disableDecide = this.config.advanced_disable_decide\n        if (!disableDecide) {\n            this.featureFlags.setReloadingPaused(true)\n        }\n\n        try {\n            this.config.loaded(this)\n        } catch (err) {\n            logger.critical('`loaded` function failed', err)\n        }\n\n        this._start_queue_if_opted_in()\n\n        // this happens after so a user can call identify in\n        // the loaded callback\n        if (this.config.capture_pageview && document) {\n            this.capture('$pageview', { title: document.title }, { send_instantly: true })\n        }\n\n        // Call decide to get what features are enabled and other settings.\n        // As a reminder, if the /decide endpoint is disabled, feature flags, toolbar, session recording, autocapture,\n        // and compression will not be available.\n        if (!disableDecide) {\n            new Decide(this).call()\n\n            // TRICKY: Reset any decide reloads queued during config.loaded because they'll be\n            // covered by the decide call right above.\n            this.featureFlags.resetRequestQueue()\n        }\n    }\n\n    _start_queue_if_opted_in(): void {\n        if (!this.has_opted_out_capturing()) {\n            if (this.config.request_batching) {\n                this._requestQueue?.poll()\n            }\n        }\n    }\n\n    _dom_loaded(): void {\n        if (!this.has_opted_out_capturing()) {\n            _eachArray(this.__request_queue, (item) => {\n                this._send_request(...item)\n            })\n        }\n\n        this.__request_queue = []\n\n        this._start_queue_if_opted_in()\n    }\n\n    /**\n     * _prepare_callback() should be called by callers of _send_request for use\n     * as the callback argument.\n     *\n     * If there is no callback, this returns null.\n     * If we are going to make XHR/XDR requests, this returns a function.\n     * If we are going to use script tags, this returns a string to use as the\n     * callback GET param.\n     */\n    // TODO: get rid of the \"| string\"\n    _prepare_callback(callback?: RequestCallback, data?: Properties): RequestCallback | null | string {\n        if (_isUndefined(callback)) {\n            return null\n        }\n\n        if (USE_XHR) {\n            return function (response) {\n                callback(response, data)\n            }\n        } else {\n            // if the user gives us a callback, we store as a random\n            // property on this instances jsc function and update our\n            // callback string to reflect that.\n            const jsc = this._jsc\n            const randomized_cb = '' + Math.floor(Math.random() * 100000000)\n            const callback_string = this.config.callback_fn + '[' + randomized_cb + ']'\n            jsc[randomized_cb] = function (response: any) {\n                delete jsc[randomized_cb]\n                callback(response, data)\n            }\n            return callback_string\n        }\n    }\n\n    _handle_unload(): void {\n        if (!this.config.request_batching) {\n            if (this.config.capture_pageview && this.config.capture_pageleave) {\n                this.capture('$pageleave', null, { transport: 'sendBeacon' })\n            }\n            return\n        }\n\n        if (this.config.capture_pageview && this.config.capture_pageleave) {\n            this.capture('$pageleave')\n        }\n\n        this._requestQueue?.unload()\n        this._retryQueue?.unload()\n    }\n\n    _handle_queued_event(url: string, data: Record<string, any>, options?: XHROptions): void {\n        const jsonData = JSON.stringify(data)\n        this.__compress_and_send_json_request(url, jsonData, options || __NOOPTIONS, __NOOP)\n    }\n\n    __compress_and_send_json_request(\n        url: string,\n        jsonData: string,\n        options: XHROptions,\n        callback?: RequestCallback\n    ): void {\n        const [data, _options] = compressData(decideCompression(this.compression), jsonData, options)\n        this._send_request(url, data, _options, callback)\n    }\n\n    _send_request(url: string, data: Record<string, any>, options: CaptureOptions, callback?: RequestCallback): void {\n        if (!this.__loaded || !this._retryQueue) {\n            return\n        }\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            return\n        }\n\n        if (ENQUEUE_REQUESTS) {\n            this.__request_queue.push([url, data, options, callback])\n            return\n        }\n\n        const DEFAULT_OPTIONS = {\n            method: this.config.api_method,\n            transport: this.config.api_transport,\n            verbose: this.config.verbose,\n        }\n\n        options = _extend(DEFAULT_OPTIONS, options || {})\n        if (!USE_XHR) {\n            options.method = 'GET'\n        }\n\n        const useSendBeacon = window && 'sendBeacon' in window.navigator && options.transport === 'sendBeacon'\n        url = addParamsToURL(url, options.urlQueryArgs || {}, {\n            ip: this.config.ip,\n        })\n\n        if (useSendBeacon) {\n            // beacon documentation https://w3c.github.io/beacon/\n            // beacons format the message and use the type property\n            try {\n                window?.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // send beacon is a best-effort, fire-and-forget mechanism on page unload,\n                // we don't want to throw errors here\n            }\n        } else if (USE_XHR || !document) {\n            try {\n                xhr({\n                    url: url,\n                    data: data,\n                    headers: this.config.xhr_headers,\n                    options: options,\n                    callback,\n                    retriesPerformedSoFar: 0,\n                    retryQueue: this._retryQueue,\n                    onXHRError: this.config.on_xhr_error,\n                    onResponse: this.rateLimiter.checkForLimiting,\n                })\n            } catch (e) {\n                logger.error(e)\n            }\n        } else {\n            const script = document.createElement('script')\n            script.type = 'text/javascript'\n            script.async = true\n            script.defer = true\n            script.src = url\n            const s = document.getElementsByTagName('script')[0]\n            s.parentNode?.insertBefore(script, s)\n        }\n    }\n\n    /**\n     * _execute_array() deals with processing any posthog function\n     * calls that were called before the PostHog library were loaded\n     * (and are thus stored in an array so they can be called later)\n     *\n     * Note: we fire off all the posthog function calls && user defined\n     * functions BEFORE we fire off posthog capturing calls. This is so\n     * identify/register/set_config calls can properly modify early\n     * capturing calls.\n     *\n     * @param {Array} array\n     */\n    _execute_array(array: SnippetArrayItem[]): void {\n        let fn_name\n        const alias_calls: SnippetArrayItem[] = []\n        const other_calls: SnippetArrayItem[] = []\n        const capturing_calls: SnippetArrayItem[] = []\n        _eachArray(array, (item) => {\n            if (item) {\n                fn_name = item[0]\n                if (_isArray(fn_name)) {\n                    capturing_calls.push(item) // chained call e.g. posthog.get_group().set()\n                } else if (_isFunction(item)) {\n                    ;(item as any).call(this)\n                } else if (_isArray(item) && fn_name === 'alias') {\n                    alias_calls.push(item)\n                } else if (_isArray(item) && fn_name.indexOf('capture') !== -1 && _isFunction((this as any)[fn_name])) {\n                    capturing_calls.push(item)\n                } else {\n                    other_calls.push(item)\n                }\n            }\n        })\n\n        const execute = function (calls: SnippetArrayItem[], thisArg: any) {\n            _eachArray(\n                calls,\n                function (item) {\n                    if (_isArray(item[0])) {\n                        // chained call\n                        let caller = thisArg\n                        _each(item, function (call) {\n                            caller = caller[call[0]].apply(caller, call.slice(1))\n                        })\n                    } else {\n                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                        // @ts-ignore\n                        this[item[0]].apply(this, item.slice(1))\n                    }\n                },\n                thisArg\n            )\n        }\n\n        execute(alias_calls, this)\n        execute(other_calls, this)\n        execute(capturing_calls, this)\n    }\n\n    _hasBootstrappedFeatureFlags(): boolean {\n        return (\n            (this.config.bootstrap?.featureFlags && Object.keys(this.config.bootstrap?.featureFlags).length > 0) ||\n            false\n        )\n    }\n\n    /**\n     * push() keeps the standard async-array-push\n     * behavior around after the lib is loaded.\n     * This is only useful for external integrations that\n     * do not wish to rely on our convenience methods\n     * (created in the snippet).\n     *\n     * ### Usage:\n     *     posthog.push(['register', { a: 'b' }]);\n     *\n     * @param {Array} item A [function_name, args...] array to be executed\n     */\n    push(item: SnippetArrayItem): void {\n        this._execute_array([item])\n    }\n\n    /**\n     * Capture an event. This is the most important and\n     * frequently used PostHog function.\n     *\n     * ### Usage:\n     *\n     *     // capture an event named 'Registered'\n     *     posthog.capture('Registered', {'Gender': 'Male', 'Age': 21});\n     *\n     *     // capture an event using navigator.sendBeacon\n     *     posthog.capture('Left page', {'duration_seconds': 35}, {transport: 'sendBeacon'});\n     *\n     * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n     * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n     * @param {Object} [options] Optional configuration for this capture request.\n     * @param {String} [options.transport] Transport method for network request ('XHR' or 'sendBeacon').\n     * @param {Date} [options.timestamp] Timestamp is a Date object. If not set, it'll automatically be set to the current time.\n     */\n    capture(\n        event_name: string,\n        properties?: Properties | null,\n        options: CaptureOptions = __NOOPTIONS\n    ): CaptureResult | void {\n        // While developing, a developer might purposefully _not_ call init(),\n        // in this case, we would like capture to be a noop.\n        if (!this.__loaded || !this.sessionPersistence || !this._requestQueue) {\n            return logger.uninitializedWarning('posthog.capture')\n        }\n\n        if (userOptedOut(this)) {\n            return\n        }\n\n        options = options || __NOOPTIONS\n        const transport = options['transport'] // external API, don't minify 'transport' prop\n        if (transport) {\n            options.transport = transport // 'transport' prop name can be minified internally\n        }\n\n        // typing doesn't prevent interesting data\n        if (_isUndefined(event_name) || !_isString(event_name)) {\n            logger.error('No event name provided to posthog.capture')\n            return\n        }\n\n        if (userAgent && _isBlockedUA(userAgent, this.config.custom_blocked_useragents)) {\n            return\n        }\n\n        // update persistence\n        this.sessionPersistence.update_search_keyword()\n\n        if (this.config.store_google) {\n            this.sessionPersistence.update_campaign_params()\n        }\n        if (this.config.save_referrer) {\n            this.sessionPersistence.update_referrer_info()\n        }\n\n        let data: CaptureResult = {\n            uuid: uuidv7(),\n            event: event_name,\n            properties: this._calculate_event_properties(event_name, properties || {}),\n        }\n\n        if (event_name === '$identify') {\n            data['$set'] = options['$set']\n            data['$set_once'] = options['$set_once']\n        }\n\n        data = _copyAndTruncateStrings(data, options._noTruncate ? null : this.config.properties_string_max_length)\n        data.timestamp = options.timestamp || new Date()\n\n        // Top-level $set overriding values from the one from properties is taken from the plugin-server normalizeEvent\n        // This doesn't handle $set_once, because posthog-people doesn't either\n        const finalSet = { ...data.properties['$set'], ...data['$set'] }\n        if (!_isEmptyObject(finalSet)) {\n            this.setPersonPropertiesForFlags(finalSet)\n        }\n\n        logger.info('send', data)\n        const jsonData = JSON.stringify(data)\n\n        const url = this.config.api_host + (options.endpoint || this.analyticsDefaultEndpoint)\n\n        const has_unique_traits = options !== __NOOPTIONS\n\n        if (this.config.request_batching && (!has_unique_traits || options._batchKey) && !options.send_instantly) {\n            this._requestQueue.enqueue(url, data, options)\n        } else {\n            this.__compress_and_send_json_request(url, jsonData, options)\n        }\n\n        this._invokeCaptureHooks(event_name, data)\n\n        return data\n    }\n\n    _addCaptureHook(callback: (eventName: string) => void): void {\n        this.__captureHooks.push(callback)\n    }\n\n    _invokeCaptureHooks(eventName: string, eventData: CaptureResult): void {\n        this.config._onCapture(eventName, eventData)\n        _each(this.__captureHooks, (callback) => callback(eventName))\n    }\n\n    _calculate_event_properties(event_name: string, event_properties: Properties): Properties {\n        if (!this.persistence || !this.sessionPersistence) {\n            return event_properties\n        }\n\n        // set defaults\n        const start_timestamp = this.persistence.remove_event_timer(event_name)\n        let properties = { ...event_properties }\n        properties['token'] = this.config.token\n\n        if (event_name === '$snapshot') {\n            const persistenceProps = { ...this.persistence.properties(), ...this.sessionPersistence.properties() }\n            properties['distinct_id'] = persistenceProps.distinct_id\n            return properties\n        }\n\n        const infoProperties = _info.properties()\n\n        if (this.sessionManager) {\n            const { sessionId, windowId } = this.sessionManager.checkAndGetSessionAndWindowId()\n            properties['$session_id'] = sessionId\n            properties['$window_id'] = windowId\n        }\n\n        if (\n            this.sessionPropsManager &&\n            this.config.__preview_send_client_session_params &&\n            (event_name === '$pageview' || event_name === '$pageleave' || event_name === '$autocapture')\n        ) {\n            const sessionProps = this.sessionPropsManager.getSessionProps()\n            properties = _extend(properties, sessionProps)\n        }\n\n        if (this.config.__preview_measure_pageview_stats) {\n            let performanceProperties: Record<string, any> = {}\n            if (event_name === '$pageview') {\n                performanceProperties = this.pageViewManager.doPageView()\n            } else if (event_name === '$pageleave') {\n                performanceProperties = this.pageViewManager.doPageLeave()\n            }\n            properties = _extend(properties, performanceProperties)\n        }\n\n        if (event_name === '$pageview' && document) {\n            properties['title'] = document.title\n        }\n\n        if (event_name === '$performance_event') {\n            const persistenceProps = this.persistence.properties()\n            // Early exit for $performance_event as we only need session and $current_url\n            properties['distinct_id'] = persistenceProps.distinct_id\n            properties['$current_url'] = infoProperties.$current_url\n            return properties\n        }\n\n        // set $duration if time_event was previously called for this event\n        if (!_isUndefined(start_timestamp)) {\n            const duration_in_ms = new Date().getTime() - start_timestamp\n            properties['$duration'] = parseFloat((duration_in_ms / 1000).toFixed(3))\n        }\n\n        // note: extend writes to the first object, so lets make sure we\n        // don't write to the persistence properties object and info\n        // properties object by passing in a new object\n\n        // update properties with pageview info and super-properties\n        properties = _extend(\n            {},\n            _info.properties(),\n            this.persistence.properties(),\n            this.sessionPersistence.properties(),\n            properties\n        )\n\n        const property_blacklist = this.config.property_blacklist\n        if (_isArray(property_blacklist)) {\n            _each(property_blacklist, function (blacklisted_prop) {\n                delete properties[blacklisted_prop]\n            })\n        } else {\n            logger.error('Invalid value for property_blacklist config: ' + property_blacklist)\n        }\n\n        const sanitize_properties = this.config.sanitize_properties\n        if (sanitize_properties) {\n            properties = sanitize_properties(properties, event_name)\n        }\n\n        return properties\n    }\n\n    /**\n     * Register a set of super properties, which are included with all\n     * events. This will overwrite previous super property values, except\n     * for session properties (see `register_for_session(properties)`).\n     *\n     * ### Usage:\n     *\n     *     // register 'Gender' as a super property\n     *     posthog.register({'Gender': 'Female'});\n     *\n     *     // register several super properties when a user signs up\n     *     posthog.register({\n     *         'Email': 'jdoe@example.com',\n     *         'Account Type': 'Free'\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {Number} [days] How many days since the user's last visit to store the super properties\n     */\n    register(properties: Properties, days?: number): void {\n        this.persistence?.register(properties, days)\n    }\n\n    /**\n     * Register a set of super properties only once. These will not\n     * overwrite previous super property values, unlike register().\n     *\n     * ### Usage:\n     *\n     *     // register a super property for the first time only\n     *     posthog.register_once({\n     *         'First Login Date': new Date().toISOString()\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * ### Notes:\n     *\n     * If default_value is specified, current super properties\n     * with that value will be overwritten.\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {*} [default_value] Value to override if already set in super properties (ex: 'False') Default: 'None'\n     * @param {Number} [days] How many days since the users last visit to store the super properties\n     */\n    register_once(properties: Properties, default_value?: Property, days?: number): void {\n        this.persistence?.register_once(properties, default_value, days)\n    }\n\n    /**\n     * Register a set of super properties, which are included with all events, but only\n     * for THIS SESSION. These will overwrite all other super property values.\n     *\n     * Unlike regular super properties, which last in LocalStorage for a long time,\n     * session super properties get cleared after a session ends.\n     *\n     * ### Usage:\n     *\n     *     // register on all events this session\n     *     posthog.register_for_session({'referer': customGetReferer()});\n     *\n     *     // register several session super properties when a user signs up\n     *     posthog.register_for_session({\n     *         'selectedPlan': 'pro',\n     *         'completedSteps': 4,\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.sessionPersistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     */\n    register_for_session(properties: Properties): void {\n        this.sessionPersistence?.register(properties)\n    }\n\n    /**\n     * Delete a super property stored with the current user.\n     *\n     * @param {String} property The name of the super property to remove\n     */\n    unregister(property: string): void {\n        this.persistence?.unregister(property)\n    }\n\n    /**\n     * Delete a session super property stored with the current user.\n     *\n     * @param {String} property The name of the session super property to remove\n     */\n    unregister_for_session(property: string): void {\n        this.sessionPersistence?.unregister(property)\n    }\n\n    _register_single(prop: string, value: Property) {\n        this.register({ [prop]: value })\n    }\n\n    /*\n     * Get feature flag value for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options?: { send_event?: boolean }): boolean | string | undefined {\n        return this.featureFlags.getFeatureFlag(key, options)\n    }\n\n    /*\n     * Get feature flag payload value matching key for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') {\n     *          const someValue = posthog.getFeatureFlagPayload('beta-feature')\n     *          // do something\n     *     }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     */\n    getFeatureFlagPayload(key: string): JsonType {\n        const payload = this.featureFlags.getFeatureFlagPayload(key)\n        try {\n            return JSON.parse(payload as any)\n        } catch {\n            return payload\n        }\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options?: isFeatureEnabledOptions): boolean | undefined {\n        return this.featureFlags.isFeatureEnabled(key, options)\n    }\n\n    reloadFeatureFlags(): void {\n        this.featureFlags.reloadFeatureFlags()\n    }\n\n    /** Opt the user in or out of an early access feature. */\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        this.featureFlags.updateEarlyAccessFeatureEnrollment(key, isEnrolled)\n    }\n\n    /** Get the list of early access features. To check enrollment status, use `isFeatureEnabled`. */\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        return this.featureFlags.getEarlyAccessFeatures(callback, force_reload)\n    }\n\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: (flags: string[], variants: Record<string, string | boolean>) => void): () => void {\n        return this.featureFlags.onFeatureFlags(callback)\n    }\n\n    /*\n     * Register an event listener that runs whenever the session id or window id change.\n     * If there is already a session id, the listener is called immediately in addition to being called on future changes.\n     *\n     * Can be used, for example, to sync the PostHog session id with a backend session.\n     *\n     * ### Usage:\n     *\n     *     posthog.onSessionId(function(sessionId, windowId) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once a session id is present or when it or the window id are updated.\n     * @returns {Function} A function that can be called to unsubscribe the listener. E.g. Used by useEffect when the component unmounts.\n     */\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        return this.sessionManager?.onSessionId(callback) ?? (() => {})\n    }\n\n    /** Get list of all surveys. */\n    getSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getSurveys(callback, forceReload)\n    }\n\n    /** Get surveys that should be enabled for the current user. */\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getActiveMatchingSurveys(callback, forceReload)\n    }\n\n    /**\n     * Identify a user with a unique ID instead of a PostHog\n     * randomly generated distinct_id. If the method is never called,\n     * then unique visitors will be identified by a UUID that is generated\n     * the first time they visit the site.\n     *\n     * If user properties are passed, they are also sent to posthog.\n     *\n     * ### Usage:\n     *\n     *      posthog.identify('[user unique id]')\n     *      posthog.identify('[user unique id]', { email: 'john@example.com' })\n     *      posthog.identify('[user unique id]', {}, { referral_code: '12345' })\n     *\n     * ### Notes:\n     *\n     * You can call this function to overwrite a previously set\n     * unique ID for the current user.\n     *\n     * If the user has been identified ($user_state in persistence is set to 'identified'),\n     * then capture of $identify is skipped to avoid merging users. For example,\n     * if your system allows an admin user to impersonate another user.\n     *\n     * Then a single browser instance can have:\n     *\n     *  `identify('a') -> capture(1) -> identify('b') -> capture(2)`\n     *\n     * and capture 1 and capture 2 will have the correct distinct_id.\n     * but users a and b will NOT be merged in posthog.\n     *\n     * However, if reset is called then:\n     *\n     *  `identify('a') -> capture(1) -> reset() -> capture(2) -> identify('b') -> capture(3)`\n     *\n     * users a and b are not merged.\n     * Capture 1 is associated with user a.\n     * A new distinct id is generated for capture 2.\n     * which is merged with user b.\n     * So, capture 2 and 3 are associated with user b.\n     *\n     * If you want to merge two identified users, you can call posthog.alias\n     *\n     * @param {String} [new_distinct_id] A string that uniquely identifies a user. If not provided, the distinct_id currently in the persistent store (cookie or localStorage) will be used.\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    identify(new_distinct_id?: string, userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        if (!this.__loaded || !this.persistence) {\n            return logger.uninitializedWarning('posthog.identify')\n        }\n        //if the new_distinct_id has not been set ignore the identify event\n        if (!new_distinct_id) {\n            logger.error('Unique user id has not been set in posthog.identify')\n            return\n        }\n\n        if (isDistinctIdStringLike(new_distinct_id)) {\n            logger.critical(\n                `The string \"${new_distinct_id}\" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.`\n            )\n            return\n        }\n\n        const previous_distinct_id = this.get_distinct_id()\n        this.register({ $user_id: new_distinct_id })\n\n        if (!this.get_property('$device_id')) {\n            // The persisted distinct id might not actually be a device id at all\n            // it might be a distinct id of the user from before\n            const device_id = previous_distinct_id\n            this.register_once(\n                {\n                    $had_persisted_distinct_id: true,\n                    $device_id: device_id,\n                },\n                ''\n            )\n        }\n\n        // if the previous distinct id had an alias stored, then we clear it\n        if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {\n            this.unregister(ALIAS_ID_KEY)\n            this.register({ distinct_id: new_distinct_id })\n        }\n\n        const isKnownAnonymous = this.persistence.get_user_state() === 'anonymous'\n\n        // send an $identify event any time the distinct_id is changing and the old ID is an anoymous ID\n        // - logic on the server will determine whether or not to do anything with it.\n        if (new_distinct_id !== previous_distinct_id && isKnownAnonymous) {\n            this.persistence.set_user_state('identified')\n\n            // Update current user properties\n            this.setPersonPropertiesForFlags(userPropertiesToSet || {}, false)\n\n            this.capture(\n                '$identify',\n                {\n                    distinct_id: new_distinct_id,\n                    $anon_distinct_id: previous_distinct_id,\n                },\n                { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} }\n            )\n            // let the reload feature flag request know to send this previous distinct id\n            // for flag consistency\n            this.featureFlags.setAnonymousDistinctId(previous_distinct_id)\n        } else if (userPropertiesToSet || userPropertiesToSetOnce) {\n            // If the distinct_id is not changing, but we have user properties to set, we can go for a $set event\n            this.setPersonProperties(userPropertiesToSet, userPropertiesToSetOnce)\n        }\n\n        // Reload active feature flags if the user identity changes.\n        // Note we don't reload this on property changes as these get processed async\n        if (new_distinct_id !== previous_distinct_id) {\n            this.reloadFeatureFlags()\n            // also clear any stored flag calls\n            this.unregister(FLAG_CALL_REPORTED)\n        }\n    }\n\n    /**\n     * Sets properties for the Person associated with the current distinct_id.\n     *\n     *\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    setPersonProperties(userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        if (!userPropertiesToSet && !userPropertiesToSetOnce) {\n            return\n        }\n\n        // Update current user properties\n        this.setPersonPropertiesForFlags(userPropertiesToSet || {})\n\n        this.capture('$set', { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} })\n    }\n\n    /**\n     * Alpha feature: don't use unless you know what you're doing!\n     *\n     * Sets group analytics information for subsequent events and reloads feature flags.\n     *\n     * @param {String} groupType Group type (example: 'organization')\n     * @param {String} groupKey Group key (example: 'org::5')\n     * @param {Object} groupPropertiesToSet Optional properties to set for group\n     */\n    group(groupType: string, groupKey: string, groupPropertiesToSet?: Properties): void {\n        if (!groupType || !groupKey) {\n            logger.error('posthog.group requires a group type and group key')\n            return\n        }\n\n        const existingGroups = this.getGroups()\n\n        // if group key changes, remove stored group properties\n        if (existingGroups[groupType] !== groupKey) {\n            this.resetGroupPropertiesForFlags(groupType)\n        }\n\n        this.register({ $groups: { ...existingGroups, [groupType]: groupKey } })\n\n        if (groupPropertiesToSet) {\n            this.capture('$groupidentify', {\n                $group_type: groupType,\n                $group_key: groupKey,\n                $group_set: groupPropertiesToSet,\n            })\n            this.setGroupPropertiesForFlags({ [groupType]: groupPropertiesToSet })\n        }\n\n        // If groups change and no properties change, reload feature flags.\n        // The property change reload case is handled in setGroupPropertiesForFlags.\n        if (existingGroups[groupType] !== groupKey && !groupPropertiesToSet) {\n            this.reloadFeatureFlags()\n        }\n    }\n\n    /**\n     * Resets only the group properties of the user currently logged in.\n     */\n    resetGroups(): void {\n        this.register({ $groups: {} })\n        this.resetGroupPropertiesForFlags()\n\n        // If groups changed, reload feature flags.\n        this.reloadFeatureFlags()\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        this.featureFlags.setPersonPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.featureFlags.resetPersonPropertiesForFlags()\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        this.featureFlags.setGroupPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        this.featureFlags.resetGroupPropertiesForFlags(group_type)\n    }\n\n    /**\n     * Clears super properties and generates a new random distinct_id for this instance.\n     * Useful for clearing data when a user logs out.\n     */\n    reset(reset_device_id?: boolean): void {\n        if (!this.__loaded) {\n            return logger.uninitializedWarning('posthog.reset')\n        }\n        const device_id = this.get_property('$device_id')\n        this.persistence?.clear()\n        this.sessionPersistence?.clear()\n        this.persistence?.set_user_state('anonymous')\n        this.sessionManager?.resetSessionId()\n        const uuid = this.config.get_device_id(uuidv7())\n        this.register_once(\n            {\n                distinct_id: uuid,\n                $device_id: reset_device_id ? uuid : device_id,\n            },\n            ''\n        )\n    }\n\n    /**\n     * Returns the current distinct id of the user. This is either the id automatically\n     * generated by the library or the id that has been passed by a call to identify().\n     *\n     * ### Notes:\n     *\n     * get_distinct_id() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // set distinct_id after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             distinct_id = posthog.get_distinct_id();\n     *         }\n     *     });\n     */\n    get_distinct_id(): string {\n        return this.get_property('distinct_id')\n    }\n\n    getGroups(): Record<string, any> {\n        return this.get_property('$groups') || {}\n    }\n\n    /**\n     * Returns the current session_id.\n     *\n     * NOTE: This should only be used for informative purposes.\n     * Any actual internal use case for the session_id should be handled by the sessionManager.\n     */\n\n    get_session_id(): string {\n        return this.sessionManager?.checkAndGetSessionAndWindowId(true).sessionId ?? ''\n    }\n\n    /**\n     * Returns the Replay url for the current session.\n     *\n     * @param options Options for the url\n     * @param options.withTimestamp Whether to include the timestamp in the url (defaults to false)\n     * @param options.timestampLookBack How many seconds to look back for the timestamp (defaults to 10)\n     */\n    get_session_replay_url(options?: { withTimestamp?: boolean; timestampLookBack?: number }): string {\n        if (!this.sessionManager) {\n            return ''\n        }\n        const host = this.config.ui_host || this.config.api_host\n        const { sessionId, sessionStartTimestamp } = this.sessionManager.checkAndGetSessionAndWindowId(true)\n        let url = host + '/replay/' + sessionId\n        if (options?.withTimestamp && sessionStartTimestamp) {\n            const LOOK_BACK = options.timestampLookBack ?? 10\n            if (!sessionStartTimestamp) {\n                return url\n            }\n            const recordingStartTime = Math.max(\n                Math.floor((new Date().getTime() - sessionStartTimestamp) / 1000) - LOOK_BACK,\n                0\n            )\n            url += `?t=${recordingStartTime}`\n        }\n\n        return url\n    }\n\n    /**\n     * Create an alias, which PostHog will use to link two distinct_ids going forward (not retroactively).\n     * Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n     * following is a valid scenario:\n     *\n     *     posthog.alias('new_id', 'existing_id');\n     *     ...\n     *     posthog.alias('newer_id', 'new_id');\n     *\n     * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n     *\n     * ### Notes:\n     *\n     * The best practice is to call alias() when a unique ID is first created for a user\n     * (e.g., when a user first registers for an account and provides an email address).\n     * alias() should never be called more than once for a given user, except to\n     * chain a newer ID to a previously new ID, as described above.\n     *\n     * @param {String} alias A unique identifier that you want to use for this user in the future.\n     * @param {String} [original] The current identifier being used for this user.\n     */\n    alias(alias: string, original?: string): CaptureResult | void | number {\n        // If the $people_distinct_id key exists in persistence, there has been a previous\n        // posthog.people.identify() call made for this user. It is VERY BAD to make an alias with\n        // this ID, as it will duplicate users.\n        if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n            logger.critical('Attempting to create alias for existing People user - aborting.')\n            return -2\n        }\n\n        if (_isUndefined(original)) {\n            original = this.get_distinct_id()\n        }\n        if (alias !== original) {\n            this._register_single(ALIAS_ID_KEY, alias)\n            return this.capture('$create_alias', { alias: alias, distinct_id: original })\n        } else {\n            logger.warn('alias matches current distinct_id - skipping api call.')\n            this.identify(alias)\n            return -1\n        }\n    }\n\n    /**\n     * Update the configuration of a posthog library instance.\n     *\n     * The default config is:\n     *\n     *     {\n     *       // PostHog API host\n     *       api_host: 'https://app.posthog.com',\n     *\n     *       // HTTP method for capturing requests\n     *       api_method: 'POST'\n     *\n     *       // PostHog web app host, currently only used by the Sentry integration.\n     *       // This will only be different from api_host when using a reverse-proxied API host  in that case\n     *       // the original web app host needs to be passed here so that links to the web app are still convenient.\n     *       ui_host: 'https://app.posthog.com',\n     *\n     *       // Automatically capture clicks, form submissions and change events\n     *       autocapture: true\n     *\n     *       // Capture rage clicks\n     *       rageclick: true\n     *\n     *       // transport for sending requests ('XHR' or 'sendBeacon')\n     *       // NB: sendBeacon should only be used for scenarios such as\n     *       // page unload where a \"best-effort\" attempt to send is\n     *       // acceptable; the sendBeacon API does not support callbacks\n     *       // or any way to know the result of the request. PostHog\n     *       // capturing via sendBeacon will not support any event-\n     *       // batching or retry mechanisms.\n     *       api_transport: 'XHR'\n     *\n     *       // super properties cookie expiration (in days)\n     *       cookie_expiration: 365\n     *\n     *       // super properties span subdomains\n     *       cross_subdomain_cookie: true\n     *\n     *       // debug mode\n     *       debug: false\n     *\n     *       // if this is true, the posthog cookie or localStorage entry\n     *       // will be deleted, and no user persistence will take place\n     *       disable_persistence: false\n     *\n     *       // if this is true, PostHog will automatically determine\n     *       // City, Region and Country data using the IP address of\n     *       //the client\n     *       ip: true\n     *\n     *       // opt users out of capturing by this PostHog instance by default\n     *       opt_out_capturing_by_default: false\n     *\n     *       // opt users out of browser data storage by this PostHog instance by default\n     *       opt_out_persistence_by_default: false\n     *\n     *       // persistence mechanism used by opt-in/opt-out methods - cookie\n     *       // or localStorage - falls back to cookie if localStorage is unavailable\n     *       opt_out_capturing_persistence_type: 'localStorage'\n     *\n     *       // customize the name of cookie/localStorage set by opt-in/opt-out methods\n     *       opt_out_capturing_cookie_prefix: null\n     *\n     *       // type of persistent store for super properties (cookie/\n     *       // localStorage) if set to 'localStorage', any existing\n     *       // posthog cookie value with the same persistence_name\n     *       // will be transferred to localStorage and deleted\n     *       persistence: 'cookie'\n     *\n     *       // name for super properties persistent store\n     *       persistence_name: ''\n     *\n     *       // names of properties/superproperties which should never\n     *       // be sent with capture() calls\n     *       property_blacklist: []\n     *\n     *       // if this is true, posthog cookies will be marked as\n     *       // secure, meaning they will only be transmitted over https\n     *       secure_cookie: false\n     *\n     *       // should we capture a page view on page load\n     *       capture_pageview: true\n     *\n     *       // if you set upgrade to be true, the library will check for\n     *       // a cookie from our old js library and import super\n     *       // properties from it, then the old cookie is deleted\n     *       // The upgrade config option only works in the initialization,\n     *       // so make sure you set it when you create the library.\n     *       upgrade: false\n     *\n     *       // if this is true, session recording is always disabled.\n     *       disable_session_recording: false,\n     *\n     *       // extra HTTP request headers to set for each API request, in\n     *       // the format {'Header-Name': value}\n     *       xhr_headers: {}\n     *\n     *       // protocol for fetching in-app message resources, e.g.\n     *       // 'https://' or 'http://'; defaults to '//' (which defers to the\n     *       // current page's protocol)\n     *       inapp_protocol: '//'\n     *\n     *       // whether to open in-app message link in new tab/window\n     *       inapp_link_new_window: false\n     *\n     *      // a set of rrweb config options that PostHog users can configure\n     *      // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n     *      session_recording: {\n     *         blockClass: 'ph-no-capture',\n     *         blockSelector: null,\n     *         ignoreClass: 'ph-ignore-input',\n     *         maskAllInputs: true,\n     *         maskInputOptions: {},\n     *         maskInputFn: null,\n     *         slimDOMOptions: {},\n     *         collectFonts: false\n     *      }\n     *\n     *      // prevent autocapture from capturing any attribute names on elements\n     *      mask_all_element_attributes: false\n     *\n     *      // prevent autocapture from capturing textContent on all elements\n     *      mask_all_text: false\n     *\n     *      // Anonymous users get a random UUID as their device by default.\n     *      // This option allows overriding that option.\n     *      get_device_id: (uuid) => uuid\n     *     }\n     *\n     *\n     * @param {Object} config A dictionary of new configuration values to update\n     */\n\n    set_config(config: Partial<PostHogConfig>): void {\n        const oldConfig = { ...this.config }\n        if (_isObject(config)) {\n            _extend(this.config, config)\n\n            if (!this.config.persistence_name) {\n                this.config.persistence_name = this.config.cookie_name\n            }\n            if (!this.config.disable_persistence) {\n                this.config.disable_persistence = this.config.disable_cookie\n            }\n\n            // We assume the api_host is without a trailing slash in most places throughout the codebase\n            this.config.api_host = this.config.api_host.replace(/\\/$/, '')\n            this.persistence?.update_config(this.config)\n            this.sessionPersistence?.update_config(this.config)\n\n            if (localStore.is_supported() && localStore.get('ph_debug') === 'true') {\n                this.config.debug = true\n            }\n            if (this.config.debug) {\n                Config.DEBUG = true\n            }\n\n            if (this.sessionRecording && !_isUndefined(config.disable_session_recording)) {\n                if (oldConfig.disable_session_recording !== config.disable_session_recording) {\n                    if (config.disable_session_recording) {\n                        this.sessionRecording.stopRecording()\n                    } else {\n                        this.sessionRecording.startRecordingIfEnabled()\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * turns session recording on, and updates the config option\n     * disable_session_recording to false\n     */\n    startSessionRecording(): void {\n        this.set_config({ disable_session_recording: false })\n    }\n\n    /**\n     * turns session recording off, and updates the config option\n     * disable_session_recording to true\n     */\n    stopSessionRecording(): void {\n        this.set_config({ disable_session_recording: true })\n    }\n\n    /**\n     * returns a boolean indicating whether session recording\n     * is currently running\n     */\n    sessionRecordingStarted(): boolean {\n        return !!this.sessionRecording?.started\n    }\n\n    /**\n     * returns a boolean indicating whether the toolbar loaded\n     * @param toolbarParams\n     */\n\n    loadToolbar(params: ToolbarParams): boolean {\n        return this.toolbar.loadToolbar(params)\n    }\n\n    /**\n     * Returns the value of the super property named property_name. If no such\n     * property is set, get_property() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * get_property() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for '$user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.get_property('$user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the super property you want to retrieve\n     */\n    get_property(property_name: string): Property | undefined {\n        return this.persistence?.['props'][property_name]\n    }\n\n    /**\n     * Returns the value of the session super property named property_name. If no such\n     * property is set, getSessionProperty() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * This is based on browser-level `sessionStorage`, NOT the PostHog session.\n     * getSessionProperty() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for 'user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.getSessionProperty('user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the session super property you want to retrieve\n     */\n    getSessionProperty(property_name: string): Property | undefined {\n        return this.sessionPersistence?.['props'][property_name]\n    }\n\n    toString(): string {\n        let name = this.config.name ?? PRIMARY_INSTANCE_NAME\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            name = PRIMARY_INSTANCE_NAME + '.' + name\n        }\n        return name\n    }\n\n    // perform some housekeeping around GDPR opt-in/out state\n    _gdpr_init(): void {\n        const is_localStorage_requested = this.config.opt_out_capturing_persistence_type === 'localStorage'\n\n        // try to convert opt-in/out cookies to localStorage if possible\n        if (is_localStorage_requested && localStore.is_supported()) {\n            if (!this.has_opted_in_capturing() && this.has_opted_in_capturing({ persistence_type: 'cookie' })) {\n                this.opt_in_capturing({ enable_persistence: false })\n            }\n            if (!this.has_opted_out_capturing() && this.has_opted_out_capturing({ persistence_type: 'cookie' })) {\n                this.opt_out_capturing({ clear_persistence: false })\n            }\n            this.clear_opt_in_out_capturing({\n                persistence_type: 'cookie',\n                enable_persistence: false,\n            })\n        }\n\n        // check whether the user has already opted out - if so, clear & disable persistence\n        if (this.has_opted_out_capturing()) {\n            this._gdpr_update_persistence({ clear_persistence: true })\n\n            // check whether we should opt out by default\n            // note: we don't clear persistence here by default since opt-out default state is often\n            //       used as an initial state while GDPR information is being collected\n        } else if (\n            !this.has_opted_in_capturing() &&\n            (this.config.opt_out_capturing_by_default || cookieStore.get('ph_optout'))\n        ) {\n            cookieStore.remove('ph_optout')\n            this.opt_out_capturing({\n                clear_persistence: this.config.opt_out_persistence_by_default,\n            })\n        }\n    }\n\n    /**\n     * Enable or disable persistence based on options\n     * only enable/disable if persistence is not already in this state\n     * @param {boolean} [options.clear_persistence] If true, will delete all data stored by the sdk in persistence and disable it\n     * @param {boolean} [options.enable_persistence] If true, will re-enable sdk persistence\n     */\n    _gdpr_update_persistence(options: Partial<OptInOutCapturingOptions>): void {\n        let disabled\n        if (options && options['clear_persistence']) {\n            disabled = true\n        } else if (options && options['enable_persistence']) {\n            disabled = false\n        } else {\n            return\n        }\n\n        if (!this.config.disable_persistence && this.persistence?.disabled !== disabled) {\n            this.persistence?.set_disabled(disabled)\n        }\n        if (!this.config.disable_persistence && this.sessionPersistence?.disabled !== disabled) {\n            this.sessionPersistence?.set_disabled(disabled)\n        }\n    }\n\n    // call a base gdpr function after constructing the appropriate token and options args\n    _gdpr_call_func<R = any>(\n        func: (token: string, options: GDPROptions) => R,\n        options?: Partial<OptInOutCapturingOptions>\n    ): R {\n        options = _extend(\n            {\n                capture: this.capture.bind(this),\n                persistence_type: this.config.opt_out_capturing_persistence_type,\n                cookie_prefix: this.config.opt_out_capturing_cookie_prefix,\n                cookie_expiration: this.config.cookie_expiration,\n                cross_subdomain_cookie: this.config.cross_subdomain_cookie,\n                secure_cookie: this.config.secure_cookie,\n            },\n            options || {}\n        )\n\n        // check if localStorage can be used for recording opt out status, fall back to cookie if not\n        if (!localStore.is_supported() && options['persistence_type'] === 'localStorage') {\n            options['persistence_type'] = 'cookie'\n        }\n\n        return func(this.config.token, {\n            capture: options['capture'],\n            captureEventName: options['capture_event_name'],\n            captureProperties: options['capture_properties'],\n            persistenceType: options['persistence_type'],\n            persistencePrefix: options['cookie_prefix'],\n            cookieExpiration: options['cookie_expiration'],\n            crossSubdomainCookie: options['cross_subdomain_cookie'],\n            secureCookie: options['secure_cookie'],\n        })\n    }\n\n    /**\n     * Opt the user in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user in\n     *     posthog.opt_in_capturing();\n     *\n     *     // opt user in with specific event name, properties, cookie configuration\n     *     posthog.opt_in_capturing({\n     *         capture_event_name: 'User opted in',\n     *         capture_event_properties: {\n     *             'Email': 'jdoe@example.com'\n     *         },\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {function} [options.capture] Function used for capturing a PostHog event to record the opt-in action (default is this PostHog instance's capture method)\n     * @param {string} [options.capture_event_name=$opt_in] Event name to be used for capturing the opt-in action\n     * @param {Object} [options.capture_properties] Set of properties to be captured along with the opt-in action\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_in_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        options = _extend(\n            {\n                enable_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optIn, options)\n        this._gdpr_update_persistence(options)\n    }\n\n    /**\n     * Opt the user out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user out\n     *     posthog.opt_out_capturing();\n     *\n     *     // opt user out with different cookie configuration from PostHog instance\n     *     posthog.opt_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.clear_persistence=true] If true, will delete all data stored by the sdk in persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options = _extend(\n            {\n                clear_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    /**\n     * Check whether the user has opted in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_in = posthog.has_opted_in_capturing();\n     *     // use has_opted_in value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-in status\n     */\n    has_opted_in_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedIn, options)\n    }\n\n    /**\n     * Check whether the user has opted out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_out = posthog.has_opted_out_capturing();\n     *     // use has_opted_out value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-out status\n     */\n    has_opted_out_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedOut, options)\n    }\n\n    /**\n     * Clear the user's opt in/out status of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // clear user's opt-in/out status\n     *     posthog.clear_opt_in_out_capturing();\n     *\n     *     // clear user's opt-in/out status with specific cookie configuration - should match\n     *     // configuration used when opt_in_capturing/opt_out_capturing methods were called.\n     *     posthog.clear_opt_in_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    clear_opt_in_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options: Partial<OptInOutCapturingOptions> = _extend(\n            {\n                enable_persistence: true,\n            },\n            options ?? {}\n        )\n        this._gdpr_call_func(clearOptInOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    debug(debug?: boolean): void {\n        if (debug === false) {\n            window?.console.log(\"You've disabled debug mode.\")\n            localStorage && localStorage.removeItem('ph_debug')\n            this.set_config({ debug: false })\n        } else {\n            window?.console.log(\n                \"You're now in debug mode. All calls to PostHog will be logged in your console.\\nYou can disable this with `posthog.debug(false)`.\"\n            )\n            localStorage && localStorage.setItem('ph_debug', 'true')\n            this.set_config({ debug: true })\n        }\n    }\n}\n\n_safewrap_class(PostHog, ['identify'])\n\nconst instances: Record<string, PostHog> = {}\nconst extend_mp = function () {\n    // add all the sub posthog instances\n    _each(instances, function (instance, name) {\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            posthog_master[name] = instance\n        }\n    })\n}\n\nconst override_ph_init_func = function () {\n    // we override the snippets init function to handle the case where a\n    // user initializes the posthog library after the script loads & runs\n    posthog_master['init'] = function (token?: string, config?: Partial<PostHogConfig>, name?: string) {\n        if (name) {\n            // initialize a sub library\n            if (!posthog_master[name]) {\n                posthog_master[name] = instances[name] = create_phlib(\n                    token || '',\n                    config || {},\n                    name,\n                    (instance: PostHog) => {\n                        posthog_master[name] = instances[name] = instance\n                        instance._loaded()\n                    }\n                )\n            }\n            return posthog_master[name]\n        } else {\n            let instance: PostHog = posthog_master as any as PostHog\n\n            if (instances[PRIMARY_INSTANCE_NAME]) {\n                // main posthog lib already initialized\n                instance = instances[PRIMARY_INSTANCE_NAME]\n            } else if (token) {\n                // intialize the main posthog lib\n                instance = create_phlib(token, config || {}, PRIMARY_INSTANCE_NAME, (instance: PostHog) => {\n                    instances[PRIMARY_INSTANCE_NAME] = instance\n                    instance._loaded()\n                })\n                instances[PRIMARY_INSTANCE_NAME] = instance\n            }\n\n            ;(posthog_master as any) = instance\n            if (init_type === InitType.INIT_SNIPPET) {\n                assignableWindow[PRIMARY_INSTANCE_NAME] = posthog_master\n            }\n            extend_mp()\n            return instance\n        }\n    }\n}\n\nconst add_dom_loaded_handler = function () {\n    // Cross browser DOM Loaded support\n    function dom_loaded_handler() {\n        // function flag since we only want to execute this once\n        if ((dom_loaded_handler as any).done) {\n            return\n        }\n        ;(dom_loaded_handler as any).done = true\n\n        ENQUEUE_REQUESTS = false\n\n        _each(instances, function (inst: PostHog) {\n            inst._dom_loaded()\n        })\n    }\n\n    if (document?.addEventListener) {\n        if (document.readyState === 'complete') {\n            // safari 4 can fire the DOMContentLoaded event before loading all\n            // external JS (including this file). you will see some copypasta\n            // on the internet that checks for 'complete' and 'loaded', but\n            // 'loaded' is an IE thing\n            dom_loaded_handler()\n        } else {\n            document.addEventListener('DOMContentLoaded', dom_loaded_handler, false)\n        }\n    }\n\n    // fallback handler, always will work\n    if (window) {\n        _register_event(window, 'load', dom_loaded_handler, true)\n    }\n}\n\nexport function init_from_snippet(): void {\n    init_type = InitType.INIT_SNIPPET\n    if (_isUndefined(assignableWindow.posthog)) {\n        assignableWindow.posthog = []\n    }\n    posthog_master = assignableWindow.posthog\n\n    if (posthog_master['__loaded'] || (posthog_master['config'] && posthog_master['persistence'])) {\n        // lib has already been loaded at least once; we don't want to override the global object this time so bomb early\n        logger.critical('PostHog library has already been downloaded at least once.')\n        return\n    }\n\n    // Load instances of the PostHog Library\n    _each(posthog_master['_i'], function (item: [token: string, config: Partial<PostHogConfig>, name: string]) {\n        if (item && _isArray(item)) {\n            instances[item[2]] = create_phlib(...item)\n        }\n    })\n\n    override_ph_init_func()\n    ;(posthog_master['init'] as any)()\n\n    // Fire loaded events after updating the window's posthog object\n    _each(instances, function (instance) {\n        instance._loaded()\n    })\n\n    add_dom_loaded_handler()\n}\n\nexport function init_as_module(): PostHog {\n    init_type = InitType.INIT_MODULE\n    ;(posthog_master as any) = new PostHog()\n\n    override_ph_init_func()\n    ;(posthog_master['init'] as any)()\n    add_dom_loaded_handler()\n\n    return posthog_master as any\n}\n", "import { logger } from './utils/logger'\n\nconst oneMinuteInMilliseconds = 60 * 1000\n\ninterface CaptureResponse {\n    quota_limited?: string[]\n}\n\nexport class RateLimiter {\n    limits: Record<string, number> = {}\n\n    public isRateLimited(batchKey: string | undefined): boolean {\n        const retryAfter = this.limits[batchKey || 'events'] || false\n\n        if (retryAfter === false) {\n            return false\n        }\n        return new Date().getTime() < retryAfter\n    }\n\n    public checkForLimiting = (xmlHttpRequest: XMLHttpRequest): void => {\n        try {\n            const text = xmlHttpRequest.responseText\n            if (!text || !text.length) {\n                return\n            }\n\n            const response: CaptureResponse = JSON.parse(text)\n            const quotaLimitedProducts = response.quota_limited || []\n            quotaLimitedProducts.forEach((batchKey) => {\n                logger.info(`[RateLimiter] ${batchKey || 'events'} is quota limited.`)\n                this.limits[batchKey] = new Date().getTime() + oneMinuteInMilliseconds\n            })\n        } catch (e) {\n            logger.error(e)\n            return\n        }\n    }\n}\n", "/* Client-side session parameters. These are primarily used by web analytics,\n * which relies on these for session analytics without the plugin server being\n * available for the person level set-once properties. Obviously not consistent\n * between client-side events and server-side events but this is acceptable\n * as web analytics only uses client-side.\n *\n * These have the same lifespan as a session_id\n */\nimport { window } from './utils/globals'\nimport { _info } from './utils/event-utils'\nimport { SessionIdManager } from './sessionid'\nimport { PostHogPersistence } from './posthog-persistence'\nimport { CLIENT_SESSION_PROPS } from './constants'\n\ninterface SessionSourceProps {\n    initialPathName: string\n    referringDomain: string // Is actually host, but named domain for internal consistency. Should contain a port if there is one.\n    utm_medium?: string\n    utm_source?: string\n    utm_campaign?: string\n    utm_content?: string\n    utm_term?: string\n}\n\ninterface StoredSessionSourceProps {\n    sessionId: string\n    props: SessionSourceProps\n}\n\nconst generateSessionSourceParams = (): SessionSourceProps => {\n    return {\n        initialPathName: window?.location.pathname || '',\n        referringDomain: _info.referringDomain(),\n        ..._info.campaignParams(),\n    }\n}\n\nexport class SessionPropsManager {\n    private readonly _sessionIdManager: SessionIdManager\n    private readonly _persistence: PostHogPersistence\n    private readonly _sessionSourceParamGenerator: () => SessionSourceProps\n\n    constructor(\n        sessionIdManager: SessionIdManager,\n        persistence: PostHogPersistence,\n        sessionSourceParamGenerator?: () => SessionSourceProps\n    ) {\n        this._sessionIdManager = sessionIdManager\n        this._persistence = persistence\n        this._sessionSourceParamGenerator = sessionSourceParamGenerator || generateSessionSourceParams\n\n        this._sessionIdManager.onSessionId(this._onSessionIdCallback)\n    }\n\n    _getStoredProps(): StoredSessionSourceProps | undefined {\n        return this._persistence.props[CLIENT_SESSION_PROPS]\n    }\n\n    _onSessionIdCallback = (sessionId: string) => {\n        const stored = this._getStoredProps()\n        if (stored && stored.sessionId === sessionId) {\n            return\n        }\n\n        const newProps: StoredSessionSourceProps = {\n            sessionId,\n            props: this._sessionSourceParamGenerator(),\n        }\n        this._persistence.register({ [CLIENT_SESSION_PROPS]: newProps })\n    }\n\n    getSessionProps() {\n        const p = this._getStoredProps()?.props\n        if (!p) {\n            return {}\n        }\n\n        return {\n            $client_session_initial_referring_host: p.referringDomain,\n            $client_session_initial_pathname: p.initialPathName,\n            $client_session_initial_utm_source: p.utm_source,\n            $client_session_initial_utm_campaign: p.utm_campaign,\n            $client_session_initial_utm_medium: p.utm_medium,\n            $client_session_initial_utm_content: p.utm_content,\n            $client_session_initial_utm_term: p.utm_term,\n        }\n    }\n}\n", "export const DEFAULT_BLOCKED_UA_STRS = [\n    'ahrefsbot',\n    'ahrefssiteaudit',\n    'applebot',\n    'baiduspider',\n    'bingbot',\n    'bingpreview',\n    'bot.htm',\n    'bot.php',\n    'crawler',\n    'duckduckbot',\n    'facebookexternal',\n    'facebookcatalog',\n    'gptbot',\n    'http://yandex.com/bots',\n    'hubspot',\n    'ia_archiver',\n    'linkedinbot',\n    'mj12bot',\n    'msnbot',\n    'nessus',\n    'petalbot',\n    'pinterest',\n    'prerender',\n    'rogerbot',\n    'screaming frog',\n    'semrushbot',\n    'sitebulb',\n    'slurp',\n    'turnitin',\n    'twitterbot',\n    'vercelbot',\n    'yahoo! slurp',\n    'yandexbot',\n\n    // a whole bunch of goog-specific crawlers\n    // https://developers.google.com/search/docs/advanced/crawling/overview-google-crawlers\n    'adsbot-google',\n    'apis-google',\n    'duplexweb-google',\n    'feedfetcher-google',\n    'google favicon',\n    'google web preview',\n    'google-read-aloud',\n    'googlebot',\n    'googleweblight',\n    'mediapartners-google',\n    'storebot-google',\n]\n\n// _.isBlockedUA()\n// This is to block various web spiders from executing our JS and\n// sending false capturing data\nexport const _isBlockedUA = function (ua: string, customBlockedUserAgents: string[]): boolean {\n    if (!ua) {\n        return false\n    }\n    const uaLower = ua.toLowerCase()\n    return DEFAULT_BLOCKED_UA_STRS.concat(customBlockedUserAgents || []).some((blockedUA) => {\n        const blockedUaLower = blockedUA.toLowerCase()\n        if (uaLower.includes) {\n            return uaLower.includes(blockedUaLower)\n        } else {\n            // IE 11 :/\n            return uaLower.indexOf(blockedUaLower) !== -1\n        }\n    })\n}\n", "import { gzipSync, strToU8 } from 'fflate'\nimport { _base64Encode } from './utils'\nimport { Compression, CompressionData, XHROptions } from './types'\n\nexport function decideCompression(compressionSupport: Partial<Record<Compression, boolean>>): Compression {\n    if (compressionSupport[Compression.GZipJS]) {\n        return Compression.GZipJS\n    } else {\n        return Compression.Base64\n    }\n}\n\nexport function compressData(\n    compression: Compression,\n    jsonData: string,\n    options: XHROptions\n): [CompressionData | Uint8Array, XHROptions] {\n    if (compression === Compression.GZipJS) {\n        // :TRICKY: This returns an UInt8Array. We don't encode this to a string - returning a blob will do this for us.\n        return [\n            gzipSync(strToU8(jsonData), { mtime: 0 }),\n            { ...options, blob: true, urlQueryArgs: { compression: Compression.GZipJS } },\n        ]\n    } else {\n        return [{ data: _base64Encode(jsonData) }, options]\n    }\n}\n", "/**\n * Having Survey types in types.ts was confusing tsc\n * and generating an invalid module.d.ts\n * See https://github.com/PostHog/posthog-js/issues/698\n */\n\nexport interface SurveyAppearance {\n    // keep in sync with frontend/src/types.ts -> SurveyAppearance\n    backgroundColor?: string\n    submitButtonColor?: string\n    textColor?: string\n    // deprecate submit button text eventually\n    submitButtonText?: string\n    descriptionTextColor?: string\n    ratingButtonColor?: string\n    ratingButtonActiveColor?: string\n    ratingButtonHoverColor?: string\n    whiteLabel?: boolean\n    autoDisappear?: boolean\n    displayThankYouMessage?: boolean\n    thankYouMessageHeader?: string\n    thankYouMessageDescription?: string\n    borderColor?: string\n    position?: 'left' | 'right' | 'center'\n    placeholder?: string\n    // widget options\n    widgetType?: 'button' | 'tab' | 'selector'\n    widgetSelector?: string\n    widgetLabel?: string\n    widgetColor?: string\n    // questionable: Not in frontend/src/types.ts -> SurveyAppearance, but used in site app\n    maxWidth?: string\n    zIndex?: string\n}\n\nexport enum SurveyType {\n    Popover = 'popover',\n    API = 'api',\n    Widget = 'widget',\n}\n\nexport type SurveyQuestion = BasicSurveyQuestion | LinkSurveyQuestion | RatingSurveyQuestion | MultipleSurveyQuestion\n\ninterface SurveyQuestionBase {\n    question: string\n    description?: string | null\n    optional?: boolean\n    buttonText?: string\n}\n\nexport interface BasicSurveyQuestion extends SurveyQuestionBase {\n    type: SurveyQuestionType.Open\n}\n\nexport interface LinkSurveyQuestion extends SurveyQuestionBase {\n    type: SurveyQuestionType.Link\n    link: string | null\n}\n\nexport interface RatingSurveyQuestion extends SurveyQuestionBase {\n    type: SurveyQuestionType.Rating\n    display: 'number' | 'emoji'\n    scale: number\n    lowerBoundLabel: string\n    upperBoundLabel: string\n}\n\nexport interface MultipleSurveyQuestion extends SurveyQuestionBase {\n    type: SurveyQuestionType.SingleChoice | SurveyQuestionType.MultipleChoice\n    choices: string[]\n    hasOpenChoice?: boolean\n}\n\nexport enum SurveyQuestionType {\n    Open = 'open',\n    MultipleChoice = 'multiple_choice',\n    SingleChoice = 'single_choice',\n    Rating = 'rating',\n    Link = 'link',\n}\n\nexport interface SurveyResponse {\n    surveys: Survey[]\n}\n\nexport type SurveyCallback = (surveys: Survey[]) => void\n\nexport type SurveyUrlMatchType = 'regex' | 'exact' | 'icontains'\n\nexport interface Survey {\n    // Sync this with the backend's SurveyAPISerializer!\n    id: string\n    name: string\n    description: string\n    type: SurveyType\n    linked_flag_key: string | null\n    targeting_flag_key: string | null\n    questions: SurveyQuestion[]\n    appearance: SurveyAppearance | null\n    conditions: {\n        url?: string\n        selector?: string\n        seenSurveyWaitPeriodInDays?: number\n        urlMatchType?: SurveyUrlMatchType\n    } | null\n    start_date: string | null\n    end_date: string | null\n}\n", "import { init_as_module } from './posthog-core'\nexport { PostHog } from './posthog-core'\nexport * from './types'\nexport * from './posthog-surveys-types'\nexport const posthog = init_as_module()\nexport default posthog\n"],
  "mappings": "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",
  "names": ["Config", "DEBUG", "LIB_VERSION", "nativeIsArray", "Array", "isArray", "ObjProto", "Object", "prototype", "hasOwnProperty", "toString", "_isArray", "obj", "call", "_isUint8Array", "x", "_isFunction", "f", "_isObject", "_isEmptyObject", "key", "_isUndefined", "_isString", "_isNull", "_isNumber", "_isBoolean", "ArrayProto", "nativeForEach", "forEach", "nativeIndexOf", "indexOf", "win", "window", "navigator", "document", "userAgent", "assignableWindow", "LOGGER_PREFIX", "logger", "_log", "level", "POSTHOG_DEBUG", "console", "consoleLog", "_len", "arguments", "length", "args", "_key", "apply", "concat", "info", "_len2", "_key2", "warn", "_len3", "_key3", "error", "_len4", "_key4", "critical", "_console", "_len5", "_key5", "uninitializedWarning", "methodName", "breaker", "_trim", "str", "replace", "_eachArray", "iterator", "thisArg", "i", "l", "_each", "_extend", "source", "prop", "_includes", "needle", "_entries", "ownProps", "keys", "resArray", "_timestamp", "Date", "now", "_try", "fn", "e", "_safewrap", "this", "_strip_empty_properties", "p", "ret", "v", "k", "LONG_STRINGS_ALLOW_LIST", "_copyAndTruncateStrings", "object", "maxStringLength", "value", "customizer", "slice", "COPY_IN_PROGRESS_SET", "Set", "internalDeepCircularCopy", "has", "add", "result", "it", "push", "val", "_base64Encode", "data", "h1", "h2", "h3", "h4", "bits", "b64", "ac", "enc", "tmp_arr", "_utf8Encode", "charCodeAt", "charAt", "join", "string", "start", "end", "stringl", "n", "utftext", "c1", "String", "fromCharCode", "substring", "_register_event", "fixEvent", "event", "preventDefault", "stopPropagation", "returnValue", "cancelBubble", "element", "type", "handler", "oldSchool", "useCapture", "addEventListener", "ontype", "old_handler", "new_handler", "old_handlers", "old_result", "new_result", "loadScript", "scriptUrlToLoad", "callback", "addScript", "scriptTag", "createElement", "src", "onload", "onerror", "_scripts$0$parentNode", "scripts", "querySelectorAll", "parentNode", "insertBefore", "body", "appendChild", "splitClassString", "s", "split", "getClassNames", "el", "className", "baseVal", "getAttribute", "getSafeText", "elText", "shouldCaptureElement", "isSensitiveElement", "childNodes", "child", "isTextNode", "textContent", "filter", "shouldCaptureValue", "isElementNode", "nodeType", "isTag", "tag", "tagName", "toLowerCase", "isDocumentFragment", "autocaptureCompatibleElements", "curEl", "classes", "name", "id", "test", "includes", "getDirectAndNestedSpanText", "target", "text", "getNestedSpanText", "trim", "_child$tagName", "spanText", "getElementsChainString", "elements", "map", "_element$nth_child", "_element$nth_of_type", "el_string", "tag_name", "attr_class", "sort", "_step", "_iterator", "done", "single_class", "err", "attributes", "_objectSpread", "nth_child", "nth_of_type", "href", "attr_id", "sortedAttributes", "_ref", "_ref2", "a", "_slicedToArray", "b", "localeCompare", "_ref5", "_ref6", "escapeQuotes", "_ref7", "_ref8", "_el$$el_text", "_el$attr__href", "response", "extractAttrClass", "_ref9", "_ref11", "_ref12", "input", "RageClick", "enabled", "_classCallCheck", "clicks", "y", "timestamp", "lastClick", "Math", "abs", "PEOPLE_DISTINCT_ID_KEY", "ALIAS_ID_KEY", "EVENT_TIMERS_KEY", "AUTOCAPTURE_DISABLED_SERVER_SIDE", "SESSION_RECORDING_ENABLED_SERVER_SIDE", "CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE", "SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE", "SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE", "SESSION_ID", "SESSION_RECORDING_IS_SAMPLED", "ENABLED_FEATURE_FLAGS", "PERSISTENCE_EARLY_ACCESS_FEATURES", "STORED_PERSON_PROPERTIES_KEY", "STORED_GROUP_PROPERTIES_KEY", "SURVEYS", "FLAG_CALL_REPORTED", "USER_STATE", "POSTHOG_QUOTA_LIMITED", "CLIENT_SESSION_PROPS", "PERSISTENCE_RESERVED_PROPERTIES", "limitText", "autocapture", "_initializedTokens", "_isDisabledServerSide", "_isAutocaptureEnabled", "_setIsAutocaptureEnabled", "instance", "_instance$persistence", "disabled_server_side", "persistence", "props", "enabled_client_side", "config", "_previousElementSibling", "previousElementSibling", "_el", "previousSibling", "_getAugmentPropertiesFromElement", "elem", "attr", "propertyKey", "propertyValue", "_getPropertiesFromElement", "maskInputs", "maskText", "_this$config", "c", "elementAttributeIgnorelist", "element_attribute_ignorelist", "attributeName", "nthChild", "nthOfType", "currentElem", "_getDefaultProperties", "eventType", "$event_type", "$ce_version", "_extractCustomPropertyValue", "customProperty", "propValues", "matchedElem", "_getCustomProperties", "targetElementList", "_this", "_customProperties", "eventSelector", "eventElement", "_getEventTarget", "srcElement", "_e$target", "shadowRoot", "composedPath", "_captureEvent", "_this$rageclicks", "_this2", "eventName", "MouseEvent", "rageclicks", "isRageClick", "clientX", "clientY", "getTime", "autocaptureConfig", "url_allowlist", "url", "location", "allowlist", "some", "regex", "match", "dom_event_allowlist", "element_allowlist", "elementType", "css_selector_allowlist", "selector", "matches", "parentIsUsefulElement", "host", "compStyles", "getComputedStyle", "getPropertyValue", "_elementsJson$", "_elementsJson$2", "elementsJson", "autocaptureAugmentProperties", "explicitNoCapture", "shouldCaptureEl", "mask_all_element_attributes", "mask_all_text", "augmentProperties", "elementsChainAsString", "$elements_chain", "$elements", "$el_text", "capture", "_navigate", "_addDomEventHandlers", "_this3", "init", "_this$config2", "__autocapture", "RegExp", "rageclick", "afterDecideResponse", "token", "register", "enabledForProject", "numBuckets", "numEnabledBuckets", "charCodeSum", "isBrowserSupported", "func", "bind", "PERSISTENCE_ACTIVE_FEATURE_FLAGS", "PERSISTENCE_OVERRIDE_FEATURE_FLAGS", "PERSISTENCE_FEATURE_FLAG_PAYLOADS", "filterActiveFeatureFlags", "featureFlags", "activeFeatureFlags", "_createForOfIteratorHelper", "_step$value", "PostHogFeatureFlags", "_override_warning", "featureFlagEventHandlers", "reloadFeatureFlagsQueued", "reloadFeatureFlagsInAction", "_createClass", "getFlagVariants", "enabledFlags", "get_property", "overriddenFlags", "finalFlags", "overriddenKeys", "_startReloadTimer", "anon_distinct_id", "$anon_distinct_id", "isPaused", "setTimeout", "_reloadFeatureFlagsRequest", "advanced_disable_feature_flags", "setReloadingPaused", "personProperties", "groupProperties", "encoded_data", "JSON", "stringify", "distinct_id", "get_distinct_id", "groups", "getGroups", "person_properties", "group_properties", "disable_flags", "undefined", "_send_request", "api_host", "method", "_prepare_callback", "receivedFeatureFlags", "options", "decideEndpointWasHit", "getFlags", "_this$instance$persis", "flagValue", "flagReportValue", "flagCallReported", "send_event", "$feature_flag", "$feature_flag_response", "getFlagPayloads", "getFeatureFlag", "h", "currentFlags", "currentFlagPayloads", "flags", "flagPayloads", "_persistence$register", "$enabled_feature_flags", "_persistence$register2", "newFeatureFlags", "newFeatureFlagPayloads", "errorsWhileComputingFlags", "_fireFeatureFlagsCallbacks", "__loaded", "unregister", "flagsObj", "addFeatureFlagsHandler", "_this$_prepareFeature", "_prepareFeatureFlagsForCallbacks", "flagVariants", "removeFeatureFlagsHandler", "isEnrolled", "_this$instance$persis5", "_this$instance$persis6", "enrollmentPersonProp", "_defineProperty", "$feature_enrollment", "$set", "setPersonPropertiesForFlags", "newFlags", "_this4", "force_reload", "existing_early_access_features", "_this4$instance$persi", "earlyAccessFeatures", "flag", "variantKey", "reduce", "res", "_this$_prepareFeature2", "properties", "reloadFeatureFlags", "existingProperties", "groupType", "group_type", "trunc", "ceil", "floor", "Number", "isInteger", "isFinite", "DIGITS", "UUID", "bytes", "TypeError", "Error", "other", "compareTo", "diff", "sign", "unixTsMs", "randA", "randBHi", "randBLo", "RangeError", "Uint8Array", "pow", "V7Generator", "DefaultRandom", "generateOrAbort", "valueAfterReset", "ts", "resetCounter", "counter", "fromFieldsV7", "random", "nextUint32", "getRandomValues", "buffer", "UUIDV7_DENY_WEAK_RNG", "crypto", "defaultGenerator", "Uint32Array", "Infinity", "cursor", "uuidv7", "uuidv7obj", "generate", "Y1970", "firstNonPublicSubDomain", "DOMAIN_MATCH_REGEX", "originalCookieDomainFn", "hostname", "chooseCookieDomain", "cross_subdomain", "matchedSubDomain", "cookieJar", "list", "len", "min", "R", "candidate", "candidateCookieValue", "cookie", "originalMatch", "cookieStore", "is_supported", "msg", "get", "nameEQ", "ca", "decodeURIComponent", "parse", "set", "days", "is_secure", "expires", "secure", "cdomain", "date", "setTime", "toUTCString", "new_cookie_val", "encodeURIComponent", "remove", "_localStorage_supported", "localStore", "supported", "localStorage", "getItem", "setItem", "removeItem", "COOKIE_PERSISTED_PROPERTIES", "localPlusCookieStore", "extend", "cookiePersistedProperties", "memoryStorage", "memoryStore", "sessionStorageSupported", "sessionStore", "sessionStorage", "localDomains", "convertToURL", "_isUrlMatchingRegex", "pattern", "_getQueryParam", "param", "keyValuePair", "queryParts", "parts", "_getHashParam", "hash", "_info", "campaignParams", "customParams", "campaign_keywords", "params", "kwkey", "kw", "URL", "searchEngine", "referrer", "search", "searchInfo", "keyword", "browser", "user_agent", "vendor", "opera", "browserVersion", "regexes", "Chrome", "Safari", "Opera", "Firefox", "Konqueror", "BlackBerry", "Mozilla", "parseFloat", "browserLanguage", "language", "userLanguage", "os", "os_name", "os_version", "exec", "device", "deviceType", "referringDomain", "_convertToURL", "_info$os", "$os", "$os_version", "$browser", "$device", "$device_type", "$current_url", "$host", "$pathname", "pathname", "$raw_user_agent", "$browser_version", "$browser_language", "$screen_height", "screen", "height", "$screen_width", "width", "$viewport_height", "innerHeight", "$viewport_width", "innerWidth", "$lib", "$lib_version", "$insert_id", "$time", "people_properties", "_info$os2", "CASE_INSENSITIVE_PERSISTENCE_TYPES", "PostHogPersistence", "campaign_params_saved", "custom_campaign_params", "storage_type", "storage", "user_state", "load", "update_config", "save", "found", "disabled", "entry", "expire_days", "default_value", "default_expiry", "hasChanges", "$referrer", "$referring_domain", "set_disabled", "set_cross_subdomain", "set_secure", "event_name", "timers", "state", "FULL_SNAPSHOT_EVENT_TYPE", "META_EVENT_TYPE", "INCREMENTAL_SNAPSHOT_EVENT_TYPE", "PLUGIN_EVENT_TYPE", "MUTATION_SOURCE_TYPE", "CONSOLE_LOG_PLUGIN_NAME", "MutationRateLimiter", "rrweb", "_this$options$refillR", "_this$options$bucketS", "mutationBuckets", "refillRate", "bucketSize", "node", "mirror", "getNode", "nodeName", "Element", "closestSVG", "closest", "getId", "_data$removes$length", "_data$removes", "_data$attributes$leng", "_data$attributes", "_data$texts$length", "_data$texts", "_data$adds$length", "_data$adds", "t", "removes", "texts", "adds", "initialMutationCount", "numberOfChanges", "_this$mutationBuckets", "_this$options$onBlock", "_this$options", "_this$getNodeOrReleva2", "getNodeOrRelevantParent", "nodeId", "max", "loggedTracker", "onBlockedNode", "mutationCount", "setInterval", "refillBuckets", "EventType", "EventType2", "defaultNetworkOptions", "initiatorTypes", "maskRequestFn", "recordHeaders", "recordBody", "recordInitialRequests", "recordPerformance", "performanceEntryTypeToObserve", "payloadSizeLimitBytes", "HEADER_DENYLIST", "POSTHOG_PATHS_TO_IGNORE", "redactPayload", "payload", "headers", "limit", "description", "requestContentLength", "parseInt", "IncrementalSource", "buildNetworkRequestOptions", "instanceConfig", "remoteNetworkOptions", "_options$payloadSizeL", "session_recording", "canRecordHeaders", "canRecordBody", "canRecordPerformance", "payloadLimiter", "requestBody", "requestHeaders", "responseBody", "responseHeaders", "enforcedCleaningFn", "d", "_data$requestHeaders", "header", "_data$requestHeaders2", "hasDeprecatedMaskFunction", "maskNetworkRequestFn", "maskCapturedNetworkRequestFn", "cleanedURL", "_instanceConfig$sessi", "_instanceConfig$sessi2", "_instanceConfig$sessi3", "cleanedRequest", "BASE_ENDPOINT", "RECORDING_IDLE_ACTIVITY_TIMEOUT_MS", "ACTIVE_SOURCES", "MouseMove", "MouseInteraction", "Scroll", "ViewportResize", "Input", "TouchMove", "MediaInteraction", "Drag", "SessionRecording", "_captureStarted", "_endpoint", "stopRrweb", "receivedDecide", "_flushBuffer", "sessionManager", "clearBuffer", "_sampleRate", "_this$buffer", "_this$buffer2", "mostRecentSnapshot", "sessionStartTimestamp", "checkAndGetSessionAndWindowId", "enabled_server_side", "disable_session_recording", "enable_recording_console_log", "_this$instance$config", "recordingVersion_server_side", "recorderVersion", "_this$instance$config2", "_this$instance$config3", "networkPayloadCapture_server_side", "networkPayloadCapture_client_side", "headersEnabled", "bodyEnabled", "performanceEnabled", "capture_performance", "capturePerformance", "isRecordingEnabled", "_linkedFlag", "_linkedFlagSeen", "isSampled", "startCaptureAndTrySendingQueuedSnapshots", "stopRecording", "sessionId", "_this$instance$persis3", "sessionIdChanged", "shouldSample", "storedIsSampled", "_response$sessionReco4", "_response$sessionReco5", "_response$sessionReco6", "_response$sessionReco7", "_response$sessionReco", "_response$sessionReco2", "_response$sessionReco3", "sessionRecording", "consoleLogRecordingEnabled", "networkPayloadCapture", "receivedSampleRate", "sampleRate", "_response$sessionReco8", "receivedMinimumDuration", "minimumDurationMilliseconds", "_minimumDuration", "linkedFlag", "endpoint", "onSessionId", "makeSamplingDecision", "onFeatureFlags", "startRecordingIfEnabled", "message", "_this$instance$sessio", "onRRwebEmit", "plugin", "trace", "_startCapture", "assign", "recorderJS", "recordingVersion", "__loaded_recorder_version", "_onScriptLoaded", "_event$data", "isUserInteraction", "_isInteractiveEvent", "isIdle", "_lastActivityTimestamp", "_tryAddCustomEvent", "reason", "timeSinceLastActive", "threshold", "_tryTakeFullSnapshot", "_this$sessionManager$2", "windowId", "windowIdChanged", "rrwebMethod", "_tryRRwebMethod", "_this4$rrwebRecord", "rrwebRecord", "addCustomEvent", "_this5", "_this5$rrwebRecord", "takeFullSnapshot", "_this$mutationRateLim", "_this6", "sessionRecordingOptions", "blockClass", "blockSelector", "ignoreClass", "maskTextClass", "maskTextSelector", "maskTextFn", "maskAllInputs", "maskInputOptions", "maskInputFn", "slimDOMOptions", "collectFonts", "inlineStylesheet", "recordCrossOriginIframes", "record", "userSessionRecordingOptions", "entries", "_i", "_Object$entries", "_Object$entries$_i", "mutationRateLimiter", "log", "emit", "plugins", "_gatherRRWebPlugins", "_addCaptureHook", "_maskUrl", "rrwebConsoleRecord", "isConsoleLogCaptureEnabled", "getRecordConsolePlugin", "getRecordNetworkPlugin", "_forceAllowLocalhostNetworkCapture", "rawEvent", "Meta", "throttledEvent", "throttleMutations", "_event", "updatedPayload", "size", "_updateWindowAndSessionIds", "$snapshot_bytes", "$snapshot_data", "$session_id", "$window_id", "status", "_captureSnapshotBuffered", "_networkRequest", "networkRequest", "_this7", "flushBufferTimer", "clearTimeout", "minimumDuration", "sessionDuration", "isPositiveSessionDuration", "isBelowMinimumDuration", "_captureSnapshot", "_this$buffer3", "_this8", "additionalBytes", "transport", "_noTruncate", "_batchKey", "_metrics", "rrweb_full_snapshot", "Decide", "_hasBootstrappedFeatureFlags", "advanced_disable_feature_flags_on_first_load", "verbose", "parseDecideResponse", "toolbar", "_afterDecideResponse", "surveysGenerator", "extendPostHogWithSurveys", "exceptionAutoCaptureAddedToWindow", "extendPostHogWithExceptionAutoCapture", "extendPostHogWithExceptionAutocapture", "opt_in_site_apps", "apiHost", "_loop", "scriptUrl", "POSTHOG_MANAGED_HOSTS", "STATE_FROM_WINDOW", "Toolbar", "toolbarParams", "toolbarVersion", "loadToolbar", "_location", "_history", "history", "stateHash", "atob", "replaceState", "title", "userIntent", "fiveMinutesInMillis", "timestampToNearestFiveMinutes", "toolbarUrl", "endsWith", "disableToolbarMetrics", "advanced_disable_toolbar_metrics", "apiURL", "instrument", "paramsToPersist", "_objectWithoutProperties", "_excluded", "maybeLoadToolbar", "GDPR_DEFAULT_PERSISTENCE_PREFIX", "optIn", "_optInOut", "optOut", "hasOptedIn", "_getStorageValue", "hasOptedOut", "respectDnt", "nav", "hasDntOn", "doNotTrack", "dntValue", "clearOptInOut", "_getStorage", "_getStorageKey", "crossSubdomainCookie", "persistenceType", "persistencePrefix", "optValue", "cookieExpiration", "secureCookie", "captureEventName", "captureProperties", "send_instantly", "RequestQueueScaffold", "pollInterval", "isPolling", "_event_queue", "_empty_queue_count", "_poller", "_pollInterval", "interval", "poll", "RequestQueue", "_RequestQueueScaffold", "_inherits", "_super", "_createSuper", "handlePollRequest", "requests", "formatQueue", "_", "dataKey", "requestValues", "values", "r", "request", "u8", "u16", "Uint16Array", "u32", "fleb", "fdeb", "clim", "freb", "eb", "j", "_a", "fl", "revfl", "revfd", "rev", "hMap", "cd", "mb", "co", "le", "rvb", "sv", "r_1", "m", "flt", "fdt", "flm", "Compression", "fdm", "shft", "slc", "subarray", "wbits", "o", "wbits16", "hTree", "t2", "i0", "i1", "i2", "maxSym", "tr", "mbt", "ln", "dt", "lft", "cst", "i2_1", "i2_2", "i2_3", "lc", "cl", "cli", "cln", "cls", "w", "clen", "cf", "wfblk", "out", "pos", "dat", "wblk", "final", "syms", "lf", "df", "li", "bs", "bl", "dlt", "mlb", "_b", "ddt", "mdb", "_c", "lclt", "nlc", "_d", "lcdt", "ndc", "lcfreq", "_e", "lct", "mlcb", "nlcc", "lm", "ll", "dm", "dl", "flen", "ftlen", "dtlen", "llm", "lcts", "clct", "dst", "deo", "et", "crct", "crc", "cr", "dopt", "opt", "pre", "post", "st", "lvl", "plvl", "lst", "msk_1", "prev", "head", "bs1_1", "bs2_1", "hsh", "lc_1", "wi", "hv", "imod", "pimod", "rem", "ch_1", "dif", "maxn", "maxd", "ml", "nl", "mmd", "md", "ti", "lin", "din", "mem", "wbytes", "gzh", "filename", "mtime", "gzhl", "gzipSync", "opts", "strToU8", "latin1", "TextEncoder", "encode", "ar", "ai", "addParamsToURL", "urlQueryArgs", "parameterOptions", "halves", "argSeparator", "formdata", "use_val", "use_key", "arg_separator", "tph_arr", "encodePostData", "blob", "Blob", "sendBeacon", "body_data", "compression", "xhr", "retriesPerformedSoFar", "retryQueue", "onXHRError", "_ref$timeout", "timeout", "onResponse", "retry_count", "req", "XMLHttpRequest", "open", "headerValue", "headerName", "setRequestHeader", "withCredentials", "onreadystatechange", "readyState", "responseText", "enqueue", "send", "thirtyMinutes", "RetryQueue", "rateLimiter", "queue", "areWeOnline", "onLine", "_handleWeAreNowOnline", "requestData", "msToNextRetry", "rawBackoffTime", "minBackoff", "cappedBackoffTime", "jitter", "retryAt", "logMessage", "flush", "toFlush", "_executeXhrRequest", "_step2", "_iterator2", "isRateLimited", "_ref3", "checkForLimiting", "MAX_SESSION_IDLE_TIMEOUT", "MIN_SESSION_IDLE_TIMEOUT", "SESSION_LENGTH_LIMIT", "SessionIdManager", "sessionIdGenerator", "windowIdGenerator", "_windowId", "_sessionId", "_sessionStartTimestamp", "_sessionActivityTimestamp", "_sessionIdGenerator", "_windowIdGenerator", "persistenceName", "desiredTimeout", "_sessionTimeoutMs", "_window_id_storage_key", "_primary_window_exists_storage_key", "_canUseSessionStorage", "lastWindowId", "primaryWindowExists", "_listenToReloadWindow", "_sessionIdChangedHandlers", "sessionActivityTimestamp", "_setSessionId", "readOnly", "_this$_getSessionId2", "_getSessionId", "lastTimestamp", "startTimestamp", "_getWindowId", "sessionPastMaximumLength", "valuesChanged", "noSessionId", "activityTimeout", "newTimestamp", "_setWindowId", "SentryIntegration", "_posthog", "organization", "projectId", "prefix", "setupOnce", "addGlobalEventProcessor", "_event$exception", "_exceptions$", "_exceptions$2", "_exceptions$3", "_exceptions$4", "tags", "ui_host", "sessionRecordingStarted", "get_session_replay_url", "withTimestamp", "exceptions", "exception", "$exception_message", "$exception_type", "$exception_personURL", "$sentry_event_id", "event_id", "$sentry_exception", "$sentry_exception_message", "u", "$sentry_exception_type", "$sentry_tags", "createSegmentIntegration", "posthog", "Promise", "resolve", "enrichEvent", "ctx", "userId", "anonymousId", "reset", "additionalProperties", "_calculate_event_properties", "version", "isLoaded", "track", "page", "identify", "PageViewManager", "_pageViewData$maxScro", "_pageViewData$maxScro2", "_pageViewData$maxCont", "_pageViewData$maxCont2", "_pageViewData", "_createPageViewData", "pageViewData", "scrollY", "_scrollY", "scrollHeight", "_scrollHeight", "contentY", "_contentY", "contentHeight", "_contentHeight", "lastScrollY", "maxScrollY", "maxScrollHeight", "lastContentY", "maxContentY", "maxContentHeight", "_window$location$path", "_prevPageViewData", "prevPageViewData", "_hasSeenPageView", "_updateScrollData", "$prev_pageview_pathname", "_calculatePrevPageScrollProperties", "$prev_pageview_last_scroll", "$prev_pageview_last_scroll_percentage", "clamp", "$prev_pageview_max_scroll", "$prev_pageview_max_scroll_percentage", "$prev_pageview_last_content", "$prev_pageview_last_content_percentage", "$prev_pageview_max_content", "$prev_pageview_max_content_percentage", "removeEventListener", "documentElement", "clientHeight", "pageYOffset", "scrollTop", "InitType", "init_type", "posthog_master", "surveyUrlValidationMap", "icontains", "conditionsUrl", "exact", "PostHogSurveys", "forceReload", "existingSurveys", "surveys", "getSurveys", "targetingMatchedSurveys", "survey", "start_date", "end_date", "_survey$conditions", "_survey$conditions$ur", "_survey$conditions2", "_survey$conditions3", "conditions", "urlCheck", "urlMatchType", "selectorCheck", "querySelector", "linked_flag_key", "targeting_flag_key", "linkedFlagCheck", "isFeatureEnabled", "targetingFlagCheck", "oneMinuteInMilliseconds", "RateLimiter", "xmlHttpRequest", "quota_limited", "batchKey", "limits", "retryAfter", "generateSessionSourceParams", "initialPathName", "SessionPropsManager", "sessionIdManager", "sessionSourceParamGenerator", "stored", "_getStoredProps", "newProps", "_sessionSourceParamGenerator", "_persistence", "_sessionIdManager", "_onSessionIdCallback", "_this$_getStoredProps", "$client_session_initial_referring_host", "$client_session_initial_pathname", "$client_session_initial_utm_source", "utm_source", "$client_session_initial_utm_campaign", "utm_campaign", "$client_session_initial_utm_medium", "utm_medium", "$client_session_initial_utm_content", "utm_content", "$client_session_initial_utm_term", "utm_term", "DEFAULT_BLOCKED_UA_STRS", "_isBlockedUA", "ua", "customBlockedUserAgents", "uaLower", "blockedUA", "blockedUaLower", "__NOOP", "__NOOPTIONS", "PRIMARY_INSTANCE_NAME", "USE_XHR", "ENQUEUE_REQUESTS", "defaultConfig", "_window$location", "documentLocation", "api_method", "api_transport", "cross_subdomain_cookie", "persistence_name", "cookie_name", "loaded", "store_google", "custom_blocked_useragents", "save_referrer", "capture_pageview", "capture_pageleave", "debug", "cookie_expiration", "upgrade", "disable_persistence", "disable_cookie", "secure_cookie", "protocol", "ip", "opt_out_capturing_by_default", "opt_out_persistence_by_default", "opt_out_capturing_persistence_type", "opt_out_capturing_cookie_prefix", "property_blacklist", "respect_dnt", "sanitize_properties", "xhr_headers", "inapp_protocol", "inapp_link_new_window", "request_batching", "properties_string_max_length", "advanced_disable_decide", "on_xhr_error", "statusText", "get_device_id", "uuid", "_onCapture", "callback_fn", "bootstrap", "disable_compression", "session_idle_timeout_seconds", "create_phlib", "createComplete", "callbacksHandled", "initComplete", "syncCode", "handleCallback", "callbackName", "INIT_MODULE", "PostHog", "_init", "__preview_measure_pageview_stats", "pageViewManager", "startMeasuringScrollPosition", "_execute_array", "people", "DeprecatedWebPerformanceObserver", "__forceAllowLocalhost", "segmentIntegration", "__captureHooks", "__request_queue", "_jsc", "analyticsDefaultEndpoint", "to", "setProps", "setPersonProperties", "set_once", "_loaded", "_window$rrweb", "_config$bootstrap", "_window$addEventListe", "_triggered_notifs", "_window$rrweb2", "segmentRegister", "updateInitComplete", "set_config", "_requestQueue", "_handle_queued_event", "_retryQueue", "sessionPropsManager", "sessionPersistence", "_gdpr_init", "segment", "user", "set_user_state", "then", "distinctID", "_config$bootstrap2", "_config$bootstrap3", "deviceID", "isIdentifiedID", "$device_id", "_config$bootstrap4", "_config$bootstrap7", "activeFlags", "g", "_config$bootstrap5", "_config$bootstrap5$fe", "_config$bootstrap6", "_config$bootstrap6$fe", "featureFlagPayloads", "_config$bootstrap8", "_config$bootstrap8$fe", "_config$bootstrap9", "_config$bootstrap9$fe", "register_once", "self", "_handle_unload", "_response$analytics", "supportedCompression", "analytics", "disableDecide", "_start_queue_if_opted_in", "resetRequestQueue", "_this$_requestQueue", "has_opted_out_capturing", "item", "_toConsumableArray", "jsc", "randomized_cb", "callback_string", "_this$_requestQueue2", "_this$_retryQueue", "unload", "jsonData", "__compress_and_send_json_request", "compressData", "GZipJS", "Base64", "_compressData2", "_compressData", "_options", "DEFAULT_OPTIONS", "useSendBeacon", "_s$parentNode", "script", "async", "defer", "getElementsByTagName", "array", "fn_name", "alias_calls", "other_calls", "capturing_calls", "execute", "calls", "caller", "_this$config$bootstra", "_this$config$bootstra2", "optedOut", "update_search_keyword", "update_campaign_params", "update_referrer_info", "finalSet", "has_unique_traits", "_invokeCaptureHooks", "eventData", "event_properties", "start_timestamp", "remove_event_timer", "persistenceProps", "infoProperties", "_this$sessionManager$", "__preview_send_client_session_params", "sessionProps", "getSessionProps", "performanceProperties", "doPageView", "doPageLeave", "duration_in_ms", "toFixed", "blacklisted_prop", "_this$persistence", "_this$persistence2", "_this$sessionPersiste", "property", "_this$persistence3", "_this$sessionPersiste2", "getFeatureFlagPayload", "_unused", "updateEarlyAccessFeatureEnrollment", "getEarlyAccessFeatures", "_this$sessionManager", "getActiveMatchingSurveys", "new_distinct_id", "userPropertiesToSet", "userPropertiesToSetOnce", "previous_distinct_id", "$user_id", "device_id", "$had_persisted_distinct_id", "isKnownAnonymous", "get_user_state", "$set_once", "setAnonymousDistinctId", "groupKey", "groupPropertiesToSet", "existingGroups", "resetGroupPropertiesForFlags", "$groups", "$group_type", "$group_key", "$group_set", "setGroupPropertiesForFlags", "resetPersonPropertiesForFlags", "reset_device_id", "_this$persistence4", "_this$sessionPersiste3", "_this$persistence5", "_this$sessionManager2", "clear", "resetSessionId", "_this$sessionManager$3", "_this$sessionManager3", "_this$sessionManager$4", "_options$timestampLoo", "LOOK_BACK", "timestampLookBack", "recordingStartTime", "alias", "original", "_register_single", "_this$persistence6", "_this$sessionPersiste4", "oldConfig", "_this$sessionRecordin", "started", "property_name", "_this$persistence7", "_this$sessionPersiste5", "_this$config$name", "has_opted_in_capturing", "persistence_type", "opt_in_capturing", "enable_persistence", "opt_out_capturing", "clear_persistence", "clear_opt_in_out_capturing", "_gdpr_update_persistence", "_this$persistence8", "_this$sessionPersiste6", "_this$persistence9", "_this$sessionPersiste7", "cookie_prefix", "_gdpr_call_func", "klass", "functions", "SurveyType", "SurveyQuestionType", "instances", "override_ph_init_func", "INIT_SNIPPET", "add_dom_loaded_handler", "dom_loaded_handler", "inst", "_dom_loaded"]
}
